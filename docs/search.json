[{"path":"/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2022 Bristol Vaccine Institute Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"/articles/avoncap.html","id":"input-data-location","dir":"Articles","previous_headings":"","what":"Input data location","title":"Getting started","text":"first level directories. Filenames need indication database year (either 20-21,21-22,… y1,y2,…)","code":"# The data input directory on my development machine: options(\"avoncap.input\" = \"~/Data/avoncap/\")  # The directory structure: fs::dir_tree(path = avoncap::input(),glob=\"*/cache/*\",invert=TRUE) #> /home/vp22681/Data/avoncap #> ├── avoncap-export #> │   ├── 2022-03-22 #> │   │   ├── central_y1.csv #> │   │   └── central_y2.csv #> │   ├── 2022-06-20 #> │   │   ├── central_y1.csv #> │   │   └── central_y2.csv #> │   ├── 2022-07-11 #> │   │   ├── central_y1.csv #> │   │   └── central_y2.csv #> │   ├── 2022-09-21 #> │   │   ├── central_y1.csv #> │   │   └── central_y2.csv #> │   ├── 2022-10-07 #> │   │   └── uad-controls.csv #> │   ├── 2022-11-09 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   └── uad-controls.csv #> │   ├── 2023-03-02 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   └── central_y3.csv #> │   ├── 2023-05-02 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   └── central_y3.csv #> │   ├── 2023-06-12 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   └── central_y3.csv #> │   ├── 2023-06-16 #> │   │   └── uad-controls.csv #> │   ├── 2023-06-28 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   ├── central_y3.csv #> │   │   └── gp.csv #> │   ├── 2023-07-24 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   └── central_y3.csv #> │   ├── 22-23 codebook NBT.pdf #> │   ├── 22-23 codebook UHBW.pdf #> │   ├── Avon CAP - LRTD Patients 21-22 _ REDCap codebook.pdf #> │   ├── Avon CAP - LRTD central database 20-21 _ REDCap.pdf #> │   ├── AvonCAP Pneumococcus Codebook.pdf #> │   ├── AvonCAP field validity.xlsx #> │   └── README.md #> ├── avoncap.yaml #> ├── cache #> ├── downloads #> │   └── README.md #> ├── ethnicity #> │   ├── 2022-07-12 #> │   │   ├── y1.csv #> │   │   └── y2.csv #> │   ├── 2022-10-27 #> │   │   ├── y1.csv #> │   │   └── y2.csv #> │   ├── 2023-06-07 #> │   │   ├── y1.csv #> │   │   ├── y2.csv #> │   │   └── y3.csv #> │   └── README.md #> ├── google-mobility #> │   └── Global_Mobility_Report.csv #> ├── ltla-incidence #> │   ├── ltla_2022-02-28.csv #> │   └── ltla_2022-03-18.csv #> ├── maybe_some_useful_files_data.zip #> ├── metadata #> │   ├── 2022-10-24 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   ├── central_y3.csv #> │   │   └── uad-controls.csv #> │   ├── 2022-11-29 #> │   │   └── pneumococcal.csv #> │   └── README.md #> ├── metadata-review #> │   ├── 2022-10-25 #> │   │   └── metadata-review.csv #> │   ├── AvonCAP 21-22 markred.xlsx #> │   └── AvonCAP data dictionary - fields.csv #> ├── nhs-extract #> │   ├── 2022-07-11 #> │   │   ├── deltave_BRI_y1.csv #> │   │   ├── deltave_BRI_y2.csv #> │   │   ├── deltave_NBT_y1.csv #> │   │   └── deltave_NBT_y2.csv #> │   ├── 2022-09-20 #> │   │   ├── deltave_BRI_y1.csv #> │   │   ├── deltave_BRI_y2.csv #> │   │   ├── deltave_BRI_y3.csv #> │   │   ├── deltave_NBT_y1.csv #> │   │   ├── deltave_NBT_y2.csv #> │   │   └── deltave_NBT_y3.csv #> │   ├── 2022-11-16 #> │   │   ├── deltave_BRI_y1.csv #> │   │   ├── deltave_BRI_y2.csv #> │   │   ├── deltave_BRI_y3.csv #> │   │   ├── deltave_NBT_y1.csv #> │   │   ├── deltave_NBT_y2.csv #> │   │   └── deltave_NBT_y3.csv #> │   ├── 2022-11-29 #> │   │   └── pneumococcal.csv #> │   ├── 2022-11-30 #> │   │   ├── deltave_BRI_y1.csv #> │   │   ├── deltave_BRI_y2.csv #> │   │   ├── deltave_BRI_y3.csv #> │   │   ├── deltave_NBT_y1.csv #> │   │   ├── deltave_NBT_y2.csv #> │   │   └── deltave_NBT_y3.csv #> │   ├── 2022-12-07 #> │   │   ├── deltave_BRI_y1.csv #> │   │   ├── deltave_BRI_y2.csv #> │   │   ├── deltave_BRI_y3.csv #> │   │   ├── deltave_NBT_y1.csv #> │   │   ├── deltave_NBT_y2.csv #> │   │   └── deltave_NBT_y3.csv #> │   ├── 2022-12-20 #> │   │   └── ipd_avoncap_linkage.csv #> │   ├── 2023-02-07 #> │   │   └── pneumococcal.csv #> │   ├── README.md #> │   └── old #> │       ├── AdmissionDateByStudyNumber_2022-07-12.csv #> │       └── DeltaVE_04042022.csv #> ├── spim-seroprevalence #> │   └── week15_2022_seroprev_modellers.csv #> └── urine-antigens #>     ├── 2022-09-15 #>     │   └── uad-cases.csv #>     ├── 2023-05-15 #>     │   ├── gp-cases.csv #>     │   └── uad-cases.csv #>     ├── B1851202_SAP V1.0-27Sep2021_Final.pdf #>     ├── README.md #>     └── Table Template Serotype Distribution Scientific Affairs Proposal_FINAL.docx # get the most recent files avoncap::most_recent_files(\"ethnicity\") #> # A tibble: 3 × 7 #>   filename directory path                date       hospital study_year filetype #>   <chr>    <chr>     <fs::path>          <date>     <chr>         <int> <chr>    #> 1 y1       ethnicity …/2023-06-07/y1.csv 2023-06-07 NA               NA csv      #> 2 y2       ethnicity …/2023-06-07/y2.csv 2023-06-07 NA               NA csv      #> 3 y3       ethnicity …/2023-06-07/y3.csv 2023-06-07 NA               NA csv # devtools::load_all() try(avoncap::load_data(\"missing\")) #> No suitable files matching \"missing\", before date: 2023-09-04. Try one of:  #> as an input to 'type' #> Error in avoncap::load_data(\"missing\") : aborting."},{"path":"/articles/avoncap.html","id":"load-data-sources-and-recording-provenance","dir":"Articles","previous_headings":"","what":"Load data sources and recording provenance","title":"Getting started","text":"","code":"ethn = avoncap::load_data(\"ethnicity\") #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-9e78c8c6974b935c1f39481c79dad211.rda avoncap::most_recent_files(\"nhs-extract\",\"deltave\") #> # A tibble: 6 × 7 #>   filename       directory   path        date       hospital study_year filetype #>   <chr>          <chr>       <fs::path>  <date>     <chr>         <int> <chr>    #> 1 deltave_BRI_y1 nhs-extract …BRI_y1.csv 2022-12-07 BRI               1 csv      #> 2 deltave_BRI_y2 nhs-extract …BRI_y2.csv 2022-12-07 BRI               2 csv      #> 3 deltave_BRI_y3 nhs-extract …BRI_y3.csv 2022-12-07 BRI               3 csv      #> 4 deltave_NBT_y1 nhs-extract …NBT_y1.csv 2022-12-07 NBT               1 csv      #> 5 deltave_NBT_y2 nhs-extract …NBT_y2.csv 2022-12-07 NBT               2 csv      #> 6 deltave_NBT_y3 nhs-extract …NBT_y3.csv 2022-12-07 NBT               3 csv rawData = avoncap::load_data(\"nhs-extract\",\"deltave\") #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-efc310106a2b36fab3e67f93fe2c9461.rda # rawData = avoncap::load_data(\"nhs-extract\",\"deltave\",merge = FALSE) avoncap::save_data_source_info(ethn, rawData, .file = tempfile(\"file-info\",fileext = \".txt\")) #> # A tibble: 9 × 2 #>   path                                                                 md5       #>   <chr>                                                                <chr>     #> 1 /home/vp22681/Data/avoncap/ethnicity/2023-06-07/y1.csv               270d33ea… #> 2 /home/vp22681/Data/avoncap/ethnicity/2023-06-07/y2.csv               0a9ee3dc… #> 3 /home/vp22681/Data/avoncap/ethnicity/2023-06-07/y3.csv               3a4a048f… #> 4 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_BRI_y1.csv 66825a94… #> 5 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_BRI_y2.csv cbd04cf3… #> 6 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_BRI_y3.csv b2fd0723… #> 7 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_NBT_y1.csv f61195e9… #> 8 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_NBT_y2.csv be0456bb… #> 9 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_NBT_y3.csv 49d5d4ed…"},{"path":"/articles/avoncap.html","id":"normalising-data","dir":"Articles","previous_headings":"","what":"Normalising data","title":"Getting started","text":"","code":"# devtools::install_local(force=TRUE) normData = rawData %>%    avoncap::validate_data() %T>%   # note the magrittr `T` pipe above to drop the output of write issues   avoncap::write_issues(\"issues.csv\") %>%   avoncap::normalise_data() #> validate data using: validate.nhs_extract.deltave #> Normalising data using: normalise.nhs_extract.deltave #> Some columns expected in the mappings were not present: consent_urine, consent_blood, consent_resp_samples1, what_was_the_first_surveil, np_swab, adm_np_type, np_date, days_adm_npswab, np_swab_2, adm_np_type_2, np_date_2, np_swab_3, adm_np_type_3, np_date_3, saliva, saliva_date, days_adm_saliva, sputum, sputum_date, days_adm_sputum, pt_ad_ur, adm_ur_taken, nourine_reason, adm_np_type_2, adm_ur_date, days_adm_urine, adm_serum_tak, adm_seru_date, days_adm_serum, adm_diagnosis #> using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-d1c7dea8d8da0abfcccfeb6ece1389d0.rda"},{"path":"/articles/avoncap.html","id":"mapping-columns","dir":"Articles","previous_headings":"","what":"Mapping columns","title":"Getting started","text":"","code":"# Successfully mapped columns # attr(normData,\"mapped\")  # Columns that are present in the normData but not mapped attr(normData,\"unmapped\") #> [1] \".spec_other_resp\"    \".spec_other_cardiac\" \".batch_code1\"        #> [4] \".batch_code2\"        \".c19_compother\"      \".batch_code3\"        #> [7] \".batch_code4\"        \".batch_code5\"  # Columns not present in the normData for which mapping rules were supplied attr(normData,\"missing\") #>  [1] \"consent_urine\"              \"consent_blood\"              #>  [3] \"consent_resp_samples1\"      \"what_was_the_first_surveil\" #>  [5] \"np_swab\"                    \"adm_np_type\"                #>  [7] \"np_date\"                    \"days_adm_npswab\"            #>  [9] \"np_swab_2\"                  \"adm_np_type_2\"              #> [11] \"np_date_2\"                  \"np_swab_3\"                  #> [13] \"adm_np_type_3\"              \"np_date_3\"                  #> [15] \"saliva\"                     \"saliva_date\"                #> [17] \"days_adm_saliva\"            \"sputum\"                     #> [19] \"sputum_date\"                \"days_adm_sputum\"            #> [21] \"pt_ad_ur\"                   \"adm_ur_taken\"               #> [23] \"nourine_reason\"             \"adm_np_type_2\"              #> [25] \"adm_ur_date\"                \"days_adm_urine\"             #> [27] \"adm_serum_tak\"              \"adm_seru_date\"              #> [29] \"days_adm_serum\"             \"adm_diagnosis\""},{"path":"/articles/avoncap.html","id":"original-field-names-and-labels-","dir":"Articles","previous_headings":"","what":"Original field names, and labels.","title":"Getting started","text":"","code":"# devtools::load_all()  # generate a set of readable label mappings from column to printable name for the whole normData set # overriding a particular label # readable_label_mapping(normData, demog.age=\"TEST\")  # Map a single column name as a string to a readable label readable_label(\"comorbid.previous_MI\") #> [1] \"Previous MI\"  # get mapping from original field names pre-normalisation to # post normalisation fields original_field_names(normData) #>                                              consented  #>                                      \"admin.consented\"  #>                                                    ppc  #>                                   \"admin.pp_consented\"  #>                                             withdrawal  #>                                     \"admin.withdrawal\"  #>                                          record_number  #>                                  \"admin.record_number\"  #>                                        ac_study_number  #>                        \"admin.consented_record_number\"  #>                                             nhs_number  #>                             \"admin.patient_identifier\"  #>                                              duplicate  #>                                      \"admin.duplicate\"  #>                                        enrollment_date  #>                                \"admin.enrollment_date\"  #>                                             study_year  #>                                     \"admin.study_year\"  #>                                                   file  #>                                      \"admin.data_file\"  #>                                            week_number  #>                                    \"admin.week_number\"  #>                                          c19_diagnosis  #>           \"diagnosis.standard_of_care_COVID_diagnosis\"  #>                               clinical_radio_diagnosis  #> \"diagnosis.clinical_or_radiological_LRTI_or_pneumonia\"  #>                                           c19_adm_swab  #>                             \"diagnosis.admission_swab\"  #>                                          c19_test_type  #>                                  \"diagnosis.test_type\"  #>                              qualifying_symptoms_signs  #>                  \"diagnosis.qualifying_symptoms_signs\"  #>                                           cc_critieria  #>                \"diagnosis.meets_case_control_criteria\"  #>                                            cc_pos_date  #>             \"diagnosis.first_COVID_positive_swab_date\"  #>                                                 gender  #>                                         \"demog.gender\"  #>                                       age_at_admission  #>                                            \"demog.age\"  #>                                              age_march  #>                              \"demog.age_in_march_2021\"  #>                                                    imd  #>                                     \"demog.imd_decile\"  #>                                                smoking  #>                                         \"demog.smoker\"  #>                                             ethnicity2  #>                                      \"demog.ethnicity\"  #>                                              care_home  #>                             \"demog.care_home_resident\"  #>                                              drugs___1  #>                                  \"demog.no_drug_abuse\"  #>                                              drugs___2  #>                                  \"demog.alcohol_abuse\"  #>                                              drugs___3  #>                                     \"demog.ivdu_abuse\"  #>                                              drugs___4  #>                                \"demog.marijuana_abuse\"  #>                                              drugs___5  #>                       \"demog.other_inhaled_drug_abuse\"  #>                                                 vaping  #>                                         \"demog.vaping\"  #>                                              alc_units  #>                               \"demog.units_of_alcohol\"  #>                                       contraindication  #>            \"vaccination.covid_vaccine_contraindicated\"  #>                                            covid19_vax  #>                        \"vaccination.covid_vaccination\"  #>                                          covidvax_date  #>                          \"vaccination.first_dose_date\"  #>                                        covidvax_dose_2  #>                         \"vaccination.second_dose_date\"  #>                                        covidvax_dose_3  #>                          \"vaccination.third_dose_date\"  #>                                        covidvax_dose_4  #>                         \"vaccination.fourth_dose_date\"  #>                                        covidvax_dose_5  #>                          \"vaccination.fifth_dose_date\"  #>                                        covidvax_dose_6  #>                          \"vaccination.sixth_dose_date\"  #>                             brand_of_covid19_vaccinati  #>                         \"vaccination.first_dose_brand\"  #>                                     covid19vax_brand_2  #>                        \"vaccination.second_dose_brand\"  #>                                     covid19vax_brand_3  #>                         \"vaccination.third_dose_brand\"  #>                                     covid19vax_brand_4  #>                        \"vaccination.fourth_dose_brand\"  #>                                     covid19vax_brand_5  #>                         \"vaccination.fifth_dose_brand\"  #>                                     covid19vax_brand_6  #>                         \"vaccination.sixth_dose_brand\"  #>                                           c19vaxd1_adm  #>              \"admission.time_since_first_vaccine_dose\"  #>                                           c19vaxd2_adm  #>             \"admission.time_since_second_vaccine_dose\"  #>                                           c19vaxd3_adm  #>              \"admission.time_since_third_vaccine_dose\"  #>                                           c19vaxd4_adm  #>             \"admission.time_since_fourth_vaccine_dose\"  #>                                            c19vax5_adm  #>              \"admission.time_since_fifth_vaccine_dose\"  #>                                            c19vax6_adm  #>              \"admission.time_since_sixth_vaccine_dose\"  #>                                               flu_date  #>                       \"vaccination.last_flu_dose_date\"  #>                                          fluvax_adm_d1  #>           \"admission.time_since_last_flu_vaccine_dose\"  #>                                             ppv23_date  #>              \"vaccination.last_pneumococcal_dose_date\"  #>                                         ppv23vax_adm_d  #>  \"admission.time_since_last_pneumococcal_vaccine_dose\"  #>                                            c19_variant  #>                                      \"genomic.variant\"  #>                                                   year  #>                                       \"admission.year\"  #>                                             study_week  #>                                 \"admission.study_week\"  #>                                         admission_date  #>                                       \"admission.date\"  #>                                               hospital  #>                                       \"admin.hospital\"  #>                                                    ics  #>                 \"admission.on_inhaled_corticosteroids\"  #>                                                 immsup  #>                       \"admission.on_immunosuppression\"  #>                                              psi_class  #>             \"admission.pneumonia_severity_index_class\"  #>                                           crb_test_mai  #>                     \"admission.curb_65_severity_score\"  #>                                           news_2_total  #>                                \"admission.news2_score\"  #>                                               pulse_ox  #>                                   \"admission.oximetry\"  #>                                                     rr  #>                           \"admission.respiratory_rate\"  #>                                                   fio2  #>                                 \"admission.max_oxygen\"  #>                                            systolic_bp  #>                                \"admission.systolic_bp\"  #>                                           diastolic_bp  #>                               \"admission.diastolic_bp\"  #>                                                     hr  #>                                 \"admission.heart_rate\"  #>                                            temperature  #>                                \"admission.temperature\"  #>                                  symptom_days_preadmit  #>                          \"admission.duration_symptoms\"  #>                                     previous_infection  #>                   \"admission.previous_covid_infection\"  #>                                 previousinfection_date  #>              \"admission.previous_covid_infection_date\"  #>                                            c19d_preadm  #>                 \"admission.time_since_covid_diagnosis\"  #>                                               rockwood  #>                             \"admission.rockwood_score\"  #>                                        cci_total_score  #>                 \"admission.charlson_comorbidity_index\"  #>                                                 height  #>                                     \"admission.height\"  #>                                                 weight  #>                                     \"admission.weight\"  #>                                                    bmi  #>                                        \"admission.BMI\"  #>                                        first_radio___1  #>                                 \"admission.cxr_normal\"  #>                                        first_radio___2  #>                              \"admission.cxr_pneumonia\"  #>                                        first_radio___3  #>                          \"admission.cxr_heart_failure\"  #>                                        first_radio___4  #>                       \"admission.cxr_pleural_effusion\"  #>                                        first_radio___5  #>                          \"admission.cxr_covid_changes\"  #>                                        first_radio___6  #>                                  \"admission.cxr_other\"  #>                                               c19_peep  #>                                       \"day_7.max_peep\"  #>                                            c19_hospadm  #>                                 \"day_7.length_of_stay\"  #>                                               c17_high  #>                                 \"day_7.max_care_level\"  #>                                               c19icuon  #>                                   \"day_7.still_on_icu\"  #>                                            c19_icudays  #>                             \"day_7.icu_length_of_stay\"  #>                                               c19_vent  #>                          \"day_7.max_ventilation_level\"  #>                                                 c19_ox  #>                                   \"day_7.max_o2_level\"  #>                                         c19_ionotropes  #>                              \"day_7.ionotropes_needed\"  #>                                   c19_complication___1  #>                                             \"day_7.PE\"  #>                                   c19_complication___2  #>                                            \"day_7.DVT\"  #>                                   c19_complication___3  #>                                            \"day_7.ARF\"  #>                                   c19_complication___4  #>                                         \"day_7.NSTEMI\"  #>                                   c19_complication___5  #>                                          \"day_7.STEMI\"  #>                                   c19_complication___6  #>                                \"day_7.cardiac_failure\"  #>                                   c19_complication___7  #>                                         \"day_7.new_AF\"  #>                                   c19_complication___8  #>                            \"day_7.new_other_arrythmia\"  #>                                   c19_complication___9  #>                                 \"day_7.inpatient_fall\"  #>                                  c19_complication___10  #>                             \"day_7.other_complication\"  #>                                  c19_complication___11  #>                                \"day_7.no_complication\"  #>                                            c19_death7d  #>                                          \"day_7.death\"  #>                                           c19_meds___1  #>                              \"treatment.dexamethasone\"  #>                                           c19_meds___2  #>                                 \"treatment.remdesevir\"  #>                                           c19_meds___3  #>                                \"treatment.tocilizumab\"  #>                                           c19_meds___4  #>                                  \"treatment.sarilumab\"  #>                                           c19_meds___5  #>                              \"treatment.in_drug_trial\"  #>                                           c19_meds___6  #>                          \"treatment.no_drug_treatment\"  #>                                           c19_meds___7  #>                                 \"treatment.sotrovimab\"  #>                                hospital_length_of_stay  #>                               \"outcome.length_of_stay\"  #>                                          survival_days  #>                            \"outcome.survival_duration\"  #>                                               ip_death  #>                              \"outcome.inpatient_death\"  #>                                            days_in_icu  #>                                 \"outcome.icu_duration\"  #>                             did_the_patient_have_respi  #>                   \"outcome.respiratory_support_needed\"  #>                             number_of_days_of_ventilat  #>                          \"outcome.ventilator_duration\"  #>                                               ett_days  #>                   \"outcome.endotracheal_tube_duration\"  #>                              renal_replacement_therapy  #>                       \"outcome.renal_support_duration\"  #>                                      complications___1  #>                          \"outcome.acute_renal_failure\"  #>                                      complications___2  #>                            \"outcome.liver_dysfunction\"  #>                                      complications___3  #>                  \"outcome.hospital_acquired_infection\"  #>                                      complications___4  #>          \"outcome.acute_respiratory_distress_syndrome\"  #>                                      complications___5  #>                                       \"outcome.NSTEMI\"  #>                                      complications___6  #>                                        \"outcome.STEMI\"  #>                                      complications___7  #>                                       \"outcome.new_AF\"  #>                                      complications___8  #>                          \"outcome.new_other_arrhthmia\"  #>                                      complications___9  #>                                       \"outcome.stroke\"  #>                                     complications___10  #>                                          \"outcome.DVT\"  #>                                     complications___11  #>                                           \"outcome.PE\"  #>                                     complications___12  #>                                \"outcome.heart_failure\"  #>                                     complications___13  #>                             \"outcome.fall_in_hospital\"  #>                                     complications___14  #>                             \"outcome.reduced_mobility\"  #>                                     complications___15  #>                  \"outcome.increasing_care_requirement\"  #>                                     complications___16  #>                             \"outcome.no_complications\"  #>                                    ventilatory_support  #>            \"outcome.highest_level_ventilatory_support\"  #>                             did_the_patient_receive_ec  #>                                \"outcome.received_ecmo\"  #>                             inotropic_support_required  #>                          \"outcome.received_ionotropes\"  #>                                       lrtd_30d_outcome  #>                            \"outcome.functional_status\"  #>                                                 fever2  #>                         \"symptom.abnormal_temperature\"  #>                                            pleurtic_cp  #>                         \"symptom.pleuritic_chest_pain\"  #>                                                 cough2  #>                                        \"symptom.cough\"  #>                                              sput_prod  #>                            \"symptom.productive_sputum\"  #>                                               dyspnoea  #>                                     \"symptom.dyspnoea\"  #>                                            tachypnoea2  #>                                   \"symptom.tachypnoea\"  #>                                                anosmia  #>                                      \"symptom.anosmia\"  #>                                                ageusia  #>                                      \"symptom.ageusia\"  #>                                              dysgeusia  #>                                    \"symptom.dysguesia\"  #>                                                  fever  #>                                        \"symptom.fever\"  #>                                            hypothermia  #>                                  \"symptom.hypothermia\"  #>                                                 chills  #>                                       \"symptom.chills\"  #>                                               headache  #>                                     \"symptom.headache\"  #>                                                malaise  #>                                      \"symptom.malaise\"  #>                                                 wheeze  #>                                       \"symptom.wheeze\"  #>                                                myalgia  #>                                      \"symptom.myalgia\"  #>                                        worse_confusion  #>                          \"symptom.worsening_confusion\"  #>                                            general_det  #>                        \"symptom.general_deterioration\"  #>                                        ox_on_admission  #>                 \"symptom.oxygen_required_on_admission\"  #>                                       resp_disease___1  #>                                  \"comorbid.no_resp_dx\"  #>                                       resp_disease___2  #>                                        \"comorbid.copd\"  #>                                       resp_disease___3  #>                                      \"comorbid.asthma\"  #>                                       resp_disease___4  #>                                  \"comorbid.resp_other\"  #>                          other_respiratory_disease___1  #>                              \"comorbid.bronchiectasis\"  #>                          other_respiratory_disease___2  #>                        \"comorbid.interstitial_lung_dx\"  #>                          other_respiratory_disease___3  #>                             \"comorbid.cystic_fibrosis\"  #>                          other_respiratory_disease___4  #>                      \"comorbid.pulmonary_hypertension\"  #>                          other_respiratory_disease___5  #>                          \"comorbid.chronic_pleural_dx\"  #>                          other_respiratory_disease___6  #>                       \"comorbid.other_chronic_resp_dx\"  #>                                                chd___1  #>                                 \"comorbid.no_heart_dx\"  #>                                                chd___2  #>                                         \"comorbid.ccf\"  #>                                                chd___3  #>                                         \"comorbid.ihd\"  #>                                                chd___4  #>                                \"comorbid.hypertension\"  #>                                                chd___5  #>                              \"comorbid.other_heart_dx\"  #>                                                     mi  #>                                 \"comorbid.previous_mi\"  #>                                          other_chd___1  #>                         \"comorbid.congenital_heart_dx\"  #>                                          other_chd___2  #>                                          \"comorbid.af\"  #>                                          other_chd___3  #>                             \"comorbid.other_arrythmia\"  #>                                          other_chd___4  #>                                   \"comorbid.pacemaker\"  #>                                          other_chd___5  #>                           \"comorbid.valvular_heart_dx\"  #>                                          other_chd___6  #>                        \"comorbid.other_other_heart_dx\"  #>                                               diabetes  #>                                    \"comorbid.diabetes\"  #>                                                dm_meds  #>                        \"comorbid.diabetes_medications\"  #>                               neurological_disease___1  #>                                 \"comorbid.neuro_other\"  #>                               neurological_disease___2  #>                                         \"comorbid.cva\"  #>                               neurological_disease___3  #>                                         \"comorbid.tia\"  #>                               neurological_disease___4  #>                                  \"comorbid.hemiplegia\"  #>                               neurological_disease___5  #>                                  \"comorbid.paraplegia\"  #>                               neurological_disease___6  #>                                 \"comorbid.no_neuro_dx\"  #>                                           dementia___1  #>                                 \"comorbid.no_dementia\"  #>                                           dementia___2  #>                                    \"comorbid.dementia\"  #>                                           dementia___3  #>                        \"comorbid.cognitive_impairment\"  #>                                                 cancer  #>                                \"comorbid.solid_cancer\"  #>                                         haem_malig___1  #>                    \"comorbid.no_haemotological_cancer\"  #>                                         haem_malig___2  #>                                   \"comorbid.leukaemia\"  #>                                         haem_malig___3  #>                                    \"comorbid.lymphoma\"  #>                                                    ckd  #>                                         \"comorbid.ckd\"  #>                                          liver_disease  #>                               \"comorbid.liver_disease\"  #>                                         gastric_ulcers  #>                              \"comorbid.gastric_ulcers\"  #>                                                    pvd  #>                              \"comorbid.periph_vasc_dx\"  #>                                                    ctd  #>                        \"comorbid.connective_tissue_dx\"  #>                                       immunodeficiency  #>                            \"comorbid.immunodeficiency\"  #>                                       other_pn_disease  #>                    \"comorbid.other_pneumococcal_risks\"  #>                                             transplant  #>                        \"comorbid.transplant_recipient\"  #>                                              pregnancy  #>                                   \"comorbid.pregnancy\"  #>                                                hiv___1  #>                                      \"comorbid.no_HIV\"  #>                                                hiv___2  #>                                         \"comorbid.HIV\"  #>                                                hiv___3  #>                                        \"comorbid.AIDS\"  #>                           final_soc_lrtd_diagnosis___1  #>           \"diagnosis.SOC_CAP_radiologically_confirmed\"  #>                           final_soc_lrtd_diagnosis___2  #>               \"diagnosis.SOC_CAP_clinically_confirmed\"  #>                           final_soc_lrtd_diagnosis___3  #>                       \"diagnosis.SOC_CAP_no_radiology\"  #>                           final_soc_lrtd_diagnosis___4  #>                                   \"diagnosis.SOC_LRTI\"  #>                           final_soc_lrtd_diagnosis___5  #>                     \"diagnosis.SOC_Empyema_or_abscess\"  #>                           final_soc_lrtd_diagnosis___6  #>                      \"diagnosis.SOC_exacerbation_COPD\"  #>                           final_soc_lrtd_diagnosis___7  #>                  \"diagnosis.SOC_exacerbation_non_COPD\"  #>                           final_soc_lrtd_diagnosis___8  #>               \"diagnosis.SOC_congestive_heart_failure\"  #>                           final_soc_lrtd_diagnosis___9  #>                 \"diagnosis.SOC_non_infectious_process\"  #>                          final_soc_lrtd_diagnosis___10  #>                               \"diagnosis.SOC_non_LRTI\"  #>                                     covid_19_diagnosis  #>                         \"diagnosis.covid_19_diagnosis\"  #>                                                  ppv23  #>                                \"vaccination.pneumovax\"  #>                                            flu_vaccine  #>                    \"vaccination.influenza_vaccination\" # unname(readable_label_mapping(normData))"},{"path":"/articles/avoncap.html","id":"augmenting-the-ve-extract-data","dir":"Articles","previous_headings":"","what":"Augmenting the VE extract data","title":"Getting started","text":"","code":"# devtools::load_all() augData = normData %>% avoncap::augment_data() #> Augmenting data using: augment.nhs_extract.deltave #> using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-a4b069e88b29953c5c577ae794dddb46.rda"},{"path":"/articles/avoncap.html","id":"loading-and-normalising-the-central-database","dir":"Articles","previous_headings":"","what":"loading and normalising the central database","title":"Getting started","text":"","code":"rawData2 = avoncap::load_data(\"avoncap-export\",\"central\", merge=TRUE) #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-fdb2cb11473acaa313a2e09bec23b8af.rda # without merge: currently: INCONSISTENT COLUMN(S) IN FILES: sars_cov2_antigen # due to the fact it is mostly a numeric but some values \">250\"  # devtools::load_all() normData2 = rawData2 %>% avoncap::validate_data() %>% avoncap::normalise_data() #> validate data using: validate.avoncap_export.central #> missing value in consented in 32 rows #> missing value in ppc in 32 rows #> missing value in include_patient in 35 rows #> missing value in hosp in 31 rows #> missing columns: ethnicity in 1 rows #> missing value in hr in 60 rows #> missing value in systolic_bp in 73 rows #> missing value in diastolic_bp in 76 rows #> missing value in temperature in 50 rows #> missing value in rr in 61 rows #> missing value in pulse_ox in 58 rows #> missing value in fio2 in 61 rows #> missing value in news_2_total in 32 rows #> missing value in crb_test_mai in 32 rows #> missing value in care_home in 32 rows #> missing value in ckd in 32 rows #> missing value in liver_disease in 32 rows #> missing value in diabetes in 32 rows #> missing value in gastric_ulcers in 32 rows #> missing value in pvd in 32 rows #> missing value in ctd in 32 rows #> missing value in immunodeficiency in 32 rows #> missing value in other_pn_disease in 37 rows #> missing value in cancer in 32 rows #> missing value in transplant in 32 rows #> missing value in smoking in 33 rows #> missing value in gender in 31 rows #> missing value in hospital_length_of_stay in 33 rows #> missing value in covid_19_diagnosis in 32 rows #> missing value in lrtd_30d_outcome in 32 rows #> missing value in week_number in 32 rows #> missing value in year in 136 rows #> missing value in highest_level_care_require in 33 rows #> missing value in ventilatory_support in 33 rows #> missing value in psi_class in 32 rows #> missing value in imd in 35 rows #> missing value in age_at_admission in 31 rows #> missing value in acute_illness in 31 rows #> missing value in covid19 in 31 rows #> missing value in clinical_radio_diagnosis in 31 rows #> missing value in fever2 in 31 rows #> missing value in pleurtic_cp in 32 rows #> missing value in cough2 in 31 rows #> missing value in sput_prod in 31 rows #> missing value in dyspnoea in 31 rows #> missing value in tachypnoea2 in 31 rows #> missing value in ausc_find in 31 rows #> missing value in radiologic in 31 rows #> missing value in symptom_days_preadmit in 45 rows #> missing value in resp_disease in 32 rows #> missing value in chd in 32 rows #> missing value in neurological_disease in 32 rows #> missing value in haem_malig in 32 rows #> missing value in final_soc_lrtd_diagnosis in 32 rows #> both pneumonia and NP-LRTI in final SOC dx in 4 rows #> missing value in dm_meds in 2 rows #> missing value in current in 3 rows #> Normalising data using: normalise.avoncap_export.central #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-9e78c8c6974b935c1f39481c79dad211.rda #> Admission date is derived from study week and hence approximate. #> Some columns expected in the mappings were not present: nhs_number, np_swab_3, adm_np_type_3, covidvax_date, covidvax_dose_2, covidvax_dose_3, covidvax_dose_4, covidvax_dose_5, covidvax_dose_6, flu_date, ppv23_date, previousinfection_date #> using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-d213773967e9e74bcb6577765d31e56a.rda failures = normData2 %>% avoncap::write_issues(\"~/avoncap-issues\")  tmp = failures %>%      filter(.error_type %in% c(\"none checked in checkbox\",\"missing value\")) %>%      inner_join(rawData2, by=\"record_number\", suffix=c(\"\",\".raw\")) %>%   group_by(.variable) %>%   filter(n()>20)         ggplot(tmp, aes(x=enrollment_date, fill=as.factor(hosp)))+   geom_histogram(binwidth = 7)+   scale_x_date(date_breaks = \"1 month\", date_labels = \"%m-%Y\")+   theme(axis.text.x.bottom = element_text(angle = 90, vjust=0.5, hjust=1))+   facet_wrap(~.variable,scales = \"free_y\") #> Warning: Removed 1643 rows containing non-finite values (`stat_bin()`). normMicro = rawData2 %>% normalise_data(instrument = \"micro\") #> Normalising data using: normalise.avoncap_export.central.micro #> using cached item: ~/.cache/avoncap/norm-b1452b07c5b368fef65b90881bbe0087-65996dd6886c9e5b1d979e11e427e856.rda  normMicro %>% filter(micro.test_performed==\"yes\") %>% select(micro.pathogen) %>% unnest(micro.pathogen) %>% with(table(pathogen,detected,  useNA = \"always\")) #>                                   detected #> pathogen                              no   yes  <NA> #>   Aspergillus                      26717    18     0 #>   Streptococcus Agalactiae         26725    10     0 #>   Candida                          26094   641     0 #>   Achromobacter Xylosoxidans       26722    13     0 #>   Bacteroides                      26731     4     0 #>   Bacteroides fragilis             26727     8     0 #>   Bacteroides ovatus               26735     0     0 #>   Bacteroides uniformis            26735     0     0 #>   Burholderia cepacia              26732     3     0 #>   Citrobacter freundii complex     26710    25     0 #>   Citrobacter koseri               26698    37     0 #>   Clostridium perfringens          26726     9     0 #>   Eggerthella lenta                26735     0     0 #>   Enterobacter aerogenes           26729     6     0 #>   Enterobacter cloacae             26632   103     0 #>   Enterococcus faecalis            26675    60     0 #>   Enterococcus faecium             26702    33     0 #>   Escherichia coli                 26276   459     0 #>   Haemophilus influenzae           26416   319     0 #>   Haemophilus parainfluenzae       26733     2     0 #>   Klebsiella oxytoca               26673    62     0 #>   Klebsiella pneumoniae            26571   164     0 #>   Morganella morganii              26730     5     0 #>   Peptostreptococcus anaerobius    26734     1     0 #>   Proteus mirabilis                26676    59     0 #>   Pseudomonas aeruginosa           26374   361     0 #>   Serratia marcescens              26693    42     0 #>   Staphylcoccus aureus             26365   370     0 #>   Streptococcus anginosus          26728     7     0 #>   Streptococcus pneumoniae         26582   153     0 #>   Streptococcus salivarius group   26730     5     0 #>   Stenotrophomonas maltophilia     26685    50     0 #>   Acinetobacter                    26720    15     0 #>   Aspergillus niger                26735     0     0 #>   Bacillus                         26729     6     0 #>   Candida albicans                 26705    30     0 #>   Candida glabrata                 26729     6     0 #>   Candida tropicalis               26729     6     0 #>   Coagulase negative staphylcoccus 26722    13     0 #>   Corynebacterium                  26713    22     0 #>   Enterococcus                     26730     5     0 #>   Gram positive coccus             26713    22     0 #>   Klebsiella                       26712    23     0 #>   Legionella pneumoniae            26733     2     0 #>   MRSA                             26728     7     0 #>   MSSA                             26734     1     0 #>   Moraxella catarrhalis            26673    62     0 #>   Mycobacterium tuberculosis       26728     7     0 #>   Pneumocytis jirovecii            26733     2     0 #>   Pseudomonas                      26656    79     0 #>   Pseudomonas fluorescens          26734     1     0 #>   Staphylcoccus                    26715    20     0 #>   Staphylococcus capitis           26687    48     0 #>   Staphylococcus epidermidis       26469   266     0 #>   Staphylococcus hominis           26578   157     0 #>   Streptococcus                    26716    19     0 #>   Streptococcus beta-hemolytic     26669    66     0 #>   Streptococcus pyogenes           26724    11     0 #>   Streptococcus viridans           26735     0     0 #>   Yeast                            26696    39     0 #>   Other                            26153   582     0 #>   <NA>                                 0     0     0 normMicro %>% filter(micro.test_performed==\"yes\") %>% select(micro.test_type, micro.pathogen) %>% unnest(micro.pathogen) %>% filter(detected==\"yes\") %>% group_by(pathogen, micro.test_type) %>%   count() %>% arrange(desc(n)) #> # A tibble: 193 × 3 #> # Groups:   pathogen, micro.test_type [193] #>    pathogen                   micro.test_type      n #>    <fct>                      <fct>            <int> #>  1 Candida                    Sputum             400 #>  2 Escherichia coli           Blood culture      325 #>  3 Other                      Blood culture      317 #>  4 Staphylococcus epidermidis Blood culture      257 #>  5 Haemophilus influenzae     Sputum             243 #>  6 Pseudomonas aeruginosa     Sputum             224 #>  7 Other                      Sputum             173 #>  8 Staphylcoccus aureus       Blood culture      167 #>  9 Staphylococcus hominis     Blood culture      155 #> 10 Candida                    Respiratory swab   130 #> # ℹ 183 more rows normVirol = rawData2 %>% normalise_data(instrument = \"virol\") #> Normalising data using: normalise.avoncap_export.central.virol #> using cached item: ~/.cache/avoncap/norm-b6f8ed1851f16d8282d50544e149e955-65996dd6886c9e5b1d979e11e427e856.rda  normVirol  %>% filter(virol.test_performed==\"yes\") %>% select(virol.pathogen) %>% unnest(virol.pathogen) %>% with(table(pathogen,detected,  useNA = \"always\")) #>                                          detected #> pathogen                                     no   yes  <NA> #>   Influenza A                             65749   632     0 #>   Influenza B                             66366    15     0 #>   RSV                                     66080   301     0 #>   Adenovirus                              66361    20     0 #>   Human Metapneumovirus                   66173   208     0 #>   Human Rhinovirus/Enterovirus            66030   351     0 #>   Parainfluenza Type 1                    66366    15     0 #>   Parainfluenza Type 2                    66372     9     0 #>   Parainfluenza Type 3                    66277   104     0 #>   Parainfluenza Type 4                    66357    24     0 #>   Covid-19                                52313 14068     0 #>   Other                                   66336    45     0 #>   Coronavirus 229E                        66380     1     0 #>   Coronavirus HKU1                        66379     2     0 #>   Coronavirus NL63                        66379     2     0 #>   Coronavirus OC43                        66377     4     0 #>   Middle East Respiratory Syndrome (MERS) 66381     0     0 #>   Bordetella parapertussis (IS1001)       66379     2     0 #>   Bordetella pertussis (ptxP)             66381     0     0 #>   Chlamydia pneumoniae                    66379     2     0 #>   Mycoplasma pneumoniae                   66381     0     0 #>   <NA>                                        0     0     0 normVirol %>% filter(virol.test_performed==\"yes\") %>% select(virol.test_type, virol.pathogen) %>% unnest(virol.pathogen) %>% filter(detected==\"yes\") %>%    # with(table(pathogen, virol.test_type,  useNA = \"always\")) %>%    group_by(pathogen, virol.test_type) %>%   count() %>% arrange(desc(n)) #> # A tibble: 50 × 3 #> # Groups:   pathogen, virol.test_type [50] #>    pathogen                     virol.test_type               n #>    <fct>                        <fct>                     <int> #>  1 Covid-19                     PCR - COVID only           8966 #>  2 Covid-19                     POCT Test (Abbott)         3818 #>  3 Covid-19                     Lateral Flow - COVID only   686 #>  4 Covid-19                     NA                          366 #>  5 Influenza A                  PCR - Respiratory panel     250 #>  6 Human Rhinovirus/Enterovirus PCR - Respiratory panel     235 #>  7 Influenza A                  Lateral Flow - COVID only   229 #>  8 RSV                          PCR - Respiratory panel     157 #>  9 Covid-19                     Viral Culture               147 #> 10 Influenza A                  NA                          143 #> # ℹ 40 more rows normRadio = rawData2 %>% normalise_data(instrument = \"radio\") #> Normalising data using: normalise.avoncap_export.central.radio #> using cached item: ~/.cache/avoncap/norm-ebbd016b214d0a4b408623ae4e2c8e3c-65996dd6886c9e5b1d979e11e427e856.rda  # old format tmp3  %>% filter(radio.test_performed==\"yes\") %>% with(table(radio.test_type, radio.lung_malignancy)) normRadio %>% filter(radio.test_performed==\"yes\") %>% select(radio.alrtd_finding) %>% unnest(radio.alrtd_finding) %>% with(table(finding,present,  useNA = \"always\")) #>                                   present #> finding                               no   yes  <NA> #>   Normal                           30521 22902     4 #>   Consistent with pneumonia        36505 16918     4 #>   Consistent with heart failure    48714  4709     4 #>   Consistent with pleural effusion 43089 10334     4 #>   Consistent with COVID-19         47232  6191     4 #>   Other abnormal finding           49727  3696     4 #>   <NA>                                 0     0     0 normRadio %>% filter(radio.test_performed==\"yes\") %>% select(radio.test_type, radio.non_alrtd_finding) %>% unnest(radio.non_alrtd_finding) %>% filter(present==\"yes\") %>% with(table(finding, radio.test_type,  useNA = \"always\")) #>                                        radio.test_type #> finding                                 CXR CT scan (CT thorax, CTPA, HRCT) #>   Pulmonary embolus                     178                             748 #>   Pneumothorax and/or pneumomediastinum 958                             179 #>   Cavity including abscesses             46                              34 #>   Aspergillioma                           1                               2 #>   Lung malignancy                       388                             327 #>   Lung nodules                          374                             474 #>   Tuberculosis (old or new)              11                               2 #>   Empyema                               132                             115 #>   <NA>                                    0                               0 #>                                        radio.test_type #> finding                                 US thorax MRI Other <NA> #>   Pulmonary embolus                             5   0    17    0 #>   Pneumothorax and/or pneumomediastinum         4   0     0    0 #>   Cavity including abscesses                    4   0     0    0 #>   Aspergillioma                                 0   0     0    0 #>   Lung malignancy                               1   0     2    0 #>   Lung nodules                                  2   0     1    0 #>   Tuberculosis (old or new)                     0   0     0    0 #>   Empyema                                       2   0     3    0 #>   <NA>                                          0   0     0    0 normHaem = rawData2 %>% normalise_data(instrument = \"haem\")  #> Normalising data using: normalise.avoncap_export.central.haem #> using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-bac1ba0bf95954527c63ff4673e6ef5a.rda augHaem = normHaem %>% augment_data() #> Augmenting data using: augment.avoncap_export.central.haem #> using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-9092aeb9b611bf6b30c9d87b89cab8f1.rda  augHaem %>% xglimpse(haem.troponin_level, haem.d_dimer_level) #>                   haem.troponin_level #> haem.d_dimer_level   ≤18   >18 Unknown #>            ≤0.5      351    64     319 #>            >0.5      951   621    1125 #>            Unknown  4056  5390   18083 augHaem %>% xglimpse(haem.crp_level, haem.white_cell_count_level) #>                            haem.crp_level #> haem.white_cell_count_level  <10 10-50  >50 Unknown #>                     ≤10     5009  6034 4905     318 #>                     >10     2586  4131 7521     139 #>                     Unknown   17    20   19     261  # x = augHaem %>% summary() # t(x)"},{"path":"/articles/avoncap.html","id":"augmenting-the-central-database","dir":"Articles","previous_headings":"","what":"Augmenting the central database","title":"Getting started","text":"","code":"# devtools::load_all() augData2 = normData2 %>% avoncap::augment_data() #> Augmenting data using: augment.avoncap_export.central #> using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-9cb725818945944b37ce926cd15deed0.rda  augData2 %>% xglimpse(admission.category,  admission.presentation_3_class) #>                               admission.category #> admission.presentation_3_class Confirmed SARS-CoV-2 No evidence SARS-CoV-2 #>               Pneumonia                        5187                   9580 #>               NP-LRTI                          4493                   6636 #>               No evidence LRTI                   67                      0 #>               <NA>                                0                      0 #>                               admission.category #> admission.presentation_3_class Non-infective <NA> #>               Pneumonia                    0    0 #>               NP-LRTI                      0    0 #>               No evidence LRTI          4997    0 #>               <NA>                         0 1164 augData2 %>% xglimpse(admission.covid_pcr_result,  admission.presentation_3_class) #>                               admission.covid_pcr_result #> admission.presentation_3_class SARS-CoV-2 PCR negative SARS-CoV-2 PCR positive #>               Pneumonia                           8933                    5126 #>               NP-LRTI                             6013                    4415 #>               No evidence LRTI                    4285                      51 #>               <NA>                                   0                       0 #>                               admission.covid_pcr_result #> admission.presentation_3_class <NA> #>               Pneumonia         708 #>               NP-LRTI           701 #>               No evidence LRTI  728 #>               <NA>             1164 augData2 %>% xglimpse(admission.infective_cause,  admission.presentation_3_class) #>                               admission.infective_cause #> admission.presentation_3_class Non-infective Infective  <NA> #>               Pneumonia                    0     14767     0 #>               NP-LRTI                      0     11129     0 #>               No evidence LRTI          4997        67     0 #>               <NA>                         0         0  1164 augData2 %>% xglimpse(admission.infective_cause,  admission.is_covid) #>                         admission.infective_cause #> admission.is_covid       Non-infective Infective  <NA> #>   Confirmed SARS-CoV-2               0      9747     0 #>   No evidence SARS-CoV-2          4997     16216     0 #>   <NA>                               0         0  1164  augData2 %>% xglimpse(admin.consent_withheld, admission.presentation_3_class) #>                               admin.consent_withheld #> admission.presentation_3_class    no   yes #>               Pneumonia        14767     0 #>               NP-LRTI          11129     0 #>               No evidence LRTI  5064     0 #>               <NA>                 0  1164"},{"path":"/articles/gp-data.html","id":"input-data-location","dir":"Articles","previous_headings":"","what":"Input data location","title":"The primary care data set","text":"first level directories. Filenames need indication database year (either 20-21,21-22,… y1,y2,…)","code":"# The data input directory on my development machine: options(\"avoncap.input\" = \"~/Data/avoncap/\") avoncap::most_recent_files(\"avoncap-export\",\"gp\") #> # A tibble: 1 × 7 #>   filename directory      path           date       hospital study_year filetype #>   <chr>    <chr>          <fs::path>     <date>     <chr>         <int> <chr>    #> 1 gp       avoncap-export …-06-28/gp.csv 2023-06-28 NA               NA csv rawData = avoncap::load_data(\"avoncap-export\",\"gp\") #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-af71346b3abc76f77c18c3b9100f55f3.rda"},{"path":"/articles/longitudinal-pneumo.html","id":"data-loading","dir":"Articles","previous_headings":"","what":"Data loading","title":"Pneumococcus longitudinal serotype data","text":"raw data expected nhs-extract subfolder","code":"rawPn = avoncap::load_data(\"nhs-extract\",\"pneumococcal\") #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-e7f5def26af13823d6fa3194a5398ec4.rda"},{"path":"/articles/longitudinal-pneumo.html","id":"data-normalisation","dir":"Articles","previous_headings":"","what":"Data normalisation","title":"Pneumococcus longitudinal serotype data","text":"","code":"normPn = rawPn %>% normalise_data() #> Normalising data using: normalise.nhs_extract.pneumococcal #> Some columns expected in the mappings were not present: hb #> using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-061bef6892ac5e394efabaf301b1cadb.rda"},{"path":"/articles/longitudinal-pneumo.html","id":"augment-the-data","dir":"Articles","previous_headings":"","what":"Augment the data","title":"Pneumococcus longitudinal serotype data","text":"Augmented IPD dataset format: admin.record_number: numeric admin.hospital: factor admin.patient_identifier: character demog.age: numeric demog.gender: factor pneumo.test_date: Date pneumo.test_type: factor pneumo.phe_serotype: factor demog.smoker: factor comorbid.no_resp_dx: factor comorbid.copd: factor comorbid.asthma: factor comorbid.bronchiectasis: factor comorbid.pulmonary_fibrosis: factor comorbid.resp_other: factor comorbid.no_heart_dx: factor comorbid.ccf: factor comorbid.ihd: factor comorbid.hypertension: factor comorbid.af: factor comorbid.other_heart_dx: factor comorbid.previous_mi: factor comorbid.ckd: factor comorbid.liver_disease: factor comorbid.diabetes: factor comorbid.diabetes_medications: factor comorbid.no_dementia: factor comorbid.dementia: factor comorbid.cognitive_impairment: factor comorbid.neuro_other: factor comorbid.cva: factor comorbid.tia: factor comorbid.hemiplegia: factor comorbid.paraplegia: factor comorbid.no_neuro_dx: factor comorbid.gastric_ulcers: factor comorbid.dysphagia: factor comorbid.periph_vasc_dx: factor comorbid.connective_tissue_dx: factor comorbid.immunodeficiency: factor comorbid.other_pneumococcal_risks: factor comorbid.no_HIV: factor comorbid.HIV: factor comorbid.AIDS: factor comorbid.solid_cancer: factor comorbid.no_haemotological_cancer: factor comorbid.leukaemia: factor comorbid.lymphoma: factor comorbid.recent_chemotherapy: factor comorbid.recent_radiotherapy: factor comorbid.transplant_recipient: factor comorbid.pregnancy: factor demog.no_drug_abuse: factor demog.alcohol_abuse: factor demog.ivdu_abuse: factor demog.marijuana_abuse: factor demog.other_inhaled_drug_abuse: factor admission.on_immunosuppression: factor comorbid.bmi_status: factor comorbid.influenza_infection: factor comorbid.hepatitis_c: factor vaccination.ppv23_vaccination: factor vaccination.flu: factor admission.charlson_comorbidity_index: numeric outcome.length_of_stay: numeric admission.triage_score: factor admission.respiratory_rate: numeric admission.saturations_on_room_air: numeric admission.systolic_bp: numeric admission.diastolic_bp: numeric admission.crb65: numeric admission.curb65: numeric outcome.antibiotic_route: factor outcome.antibiotic_duration: numeric admission.infection_site: factor outcome.abnormal_lft: factor outcome.acute_kidney_injury: factor outcome.pleural_effusion: factor outcome.empyema: factor outcome.discharge_to: factor outcome.admitted_icu: factor outcome.non_invasive_ventilation: factor outcome.intubation: factor outcome.recurrent_pneumonia: factor outcome.received_ecmo: factor outcome.received_ionotropes: factor outcome.tracheostomy: factor outcome.inpatient_death: factor outcome.death_within_30_days: factor outcome.death_within_1_year: factor outcome.survival_duration: numeric haem.albumin: numeric haem.white_cell_count: numeric haem.neutrophils: numeric haem.lymphocytes: numeric haem.crp: numeric haem.sodium: numeric haem.urea: numeric haem.egfr: numeric haem.creatinine: numeric radio.cxr_infection: factor radio.cxr_lobar_changes: factor outcome.death_within_5_years: factor outcome.5_yr_survival_duration: numeric demog.imd_decile: character key.admit: character","code":"augPn = normPn %>% augment_data() #> Augmenting data using: augment.nhs_extract.pneumococcal #> using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-6400b885f07f2a6e47574983965bb885.rda augPn %>% with(table(admission.infection_site, pneumo.test_type,useNA = \"always\")) #>                         pneumo.test_type #> admission.infection_site Blood culture only Binax only Blood culture and Binax #>         Lung                           6316       2017                    1458 #>         Meningitis                      443         46                      94 #>         Septic arthritis                129          5                      34 #>         ENT                              81          2                       0 #>         Myositis                          4          0                       0 #>         Otitis externa                    8          0                       0 #>         Abdominal                        16          1                       5 #>         Unclear/unknown                  19          0                       0 #>         Other                           136         13                       4 #>         <NA>                              0          0                       0 #>                         pneumo.test_type #> admission.infection_site CSF PCR Blood PCR <NA> #>         Lung                   0         0    0 #>         Meningitis             8         9    0 #>         Septic arthritis       0         0    0 #>         ENT                    0         0    0 #>         Myositis               0         0    0 #>         Otitis externa         0         0    0 #>         Abdominal              0         0    0 #>         Unclear/unknown        0         0    0 #>         Other                  0         2    0 #>         <NA>                   0         0    0"},{"path":"/articles/quality-assurance.html","id":"loading-and-normalising-the-central-database","dir":"Articles","previous_headings":"","what":"loading and normalising the central database","title":"Quality assurance","text":"","code":"rawData2 = avoncap::load_data(\"avoncap-export\",\"central\", merge=TRUE) #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-fdb2cb11473acaa313a2e09bec23b8af.rda # without merge: currently: INCONSISTENT COLUMN(S) IN FILES: sars_cov2_antigen # due to the fact it is mostly a numeric but some values \">250\"  # devtools::load_all() normData2 = rawData2 %>% avoncap::validate_data() %>% avoncap::normalise_data() #> validate data using: validate.avoncap_export.central #> missing value in consented in 32 rows #> missing value in ppc in 32 rows #> missing value in include_patient in 35 rows #> missing value in hosp in 31 rows #> missing columns: ethnicity in 1 rows #> missing value in hr in 60 rows #> missing value in systolic_bp in 73 rows #> missing value in diastolic_bp in 76 rows #> missing value in temperature in 50 rows #> missing value in rr in 61 rows #> missing value in pulse_ox in 58 rows #> missing value in fio2 in 61 rows #> missing value in news_2_total in 32 rows #> missing value in crb_test_mai in 32 rows #> missing value in care_home in 32 rows #> missing value in ckd in 32 rows #> missing value in liver_disease in 32 rows #> missing value in diabetes in 32 rows #> missing value in gastric_ulcers in 32 rows #> missing value in pvd in 32 rows #> missing value in ctd in 32 rows #> missing value in immunodeficiency in 32 rows #> missing value in other_pn_disease in 37 rows #> missing value in cancer in 32 rows #> missing value in transplant in 32 rows #> missing value in smoking in 33 rows #> missing value in gender in 31 rows #> missing value in hospital_length_of_stay in 33 rows #> missing value in covid_19_diagnosis in 32 rows #> missing value in lrtd_30d_outcome in 32 rows #> missing value in week_number in 32 rows #> missing value in year in 136 rows #> missing value in highest_level_care_require in 33 rows #> missing value in ventilatory_support in 33 rows #> missing value in psi_class in 32 rows #> missing value in imd in 35 rows #> missing value in age_at_admission in 31 rows #> missing value in acute_illness in 31 rows #> missing value in covid19 in 31 rows #> missing value in clinical_radio_diagnosis in 31 rows #> missing value in fever2 in 31 rows #> missing value in pleurtic_cp in 32 rows #> missing value in cough2 in 31 rows #> missing value in sput_prod in 31 rows #> missing value in dyspnoea in 31 rows #> missing value in tachypnoea2 in 31 rows #> missing value in ausc_find in 31 rows #> missing value in radiologic in 31 rows #> missing value in symptom_days_preadmit in 45 rows #> missing value in resp_disease in 32 rows #> missing value in chd in 32 rows #> missing value in neurological_disease in 32 rows #> missing value in haem_malig in 32 rows #> missing value in final_soc_lrtd_diagnosis in 32 rows #> both pneumonia and NP-LRTI in final SOC dx in 4 rows #> missing value in dm_meds in 2 rows #> missing value in current in 3 rows #> Normalising data using: normalise.avoncap_export.central #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-9e78c8c6974b935c1f39481c79dad211.rda #> Admission date is derived from study week and hence approximate. #> Some columns expected in the mappings were not present: nhs_number, np_swab_3, adm_np_type_3, covidvax_date, covidvax_dose_2, covidvax_dose_3, covidvax_dose_4, covidvax_dose_5, covidvax_dose_6, flu_date, ppv23_date, previousinfection_date #> using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-d213773967e9e74bcb6577765d31e56a.rda failures = normData2 %>% avoncap::write_issues(\"~/avoncap-issues\") tmp = failures %>%      filter(.error_type %in% c(\"none checked in checkbox\",\"missing value\")) %>%      inner_join(rawData2, by=\"record_number\", suffix=c(\"\",\".raw\")) %>%     group_by(.variable) %>%     filter(       !is.na(enrollment_date) &       !is.na(hosp)     ) %>%     filter(       n()>20     )    ggplot(tmp, aes(x=enrollment_date, fill=as.factor(hosp)))+   geom_histogram(binwidth = 7)+   scale_x_date(date_breaks = \"1 month\", date_labels = \"%m-%Y\")+   theme(axis.text.x.bottom = element_text(angle = 90, vjust=0.5, hjust=1))+   facet_wrap(~.variable,scales = \"free_y\") normData2 = rawData2 %>%    avoncap::normalise_data(.nocache = TRUE) #> Normalising data using: normalise.avoncap_export.central #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-9e78c8c6974b935c1f39481c79dad211.rda #> Admission date is derived from study week and hence approximate. #> Some columns expected in the mappings were not present: nhs_number, np_swab_3, adm_np_type_3, covidvax_date, covidvax_dose_2, covidvax_dose_3, covidvax_dose_4, covidvax_dose_5, covidvax_dose_6, flu_date, ppv23_date, previousinfection_date #> caching item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-b34b6c3c49c213e41779c264053d07ca.rda #> mapping .consented to admin.consented #> mapping .ppc to admin.pp_consented #> mapping .withdrawal to admin.withdrawal #> mapping .consent_urine to admin.consent_for_urine #> mapping .consent_blood to admin.consent_for_blood #> mapping .consent_resp_samples1 to admin.consent_for_respiratory_samples #> mapping .record_number to admin.record_number #> mapping .what_was_the_first_surveil to admin.first_record_number #> mapping .ac_study_number to admin.consented_record_number #> the input data set does not have a nhs_number column (or column set) #> mapping .duplicate to admin.duplicate #> mapping .enrollment_date to admin.enrollment_date #> mapping .study_year to admin.study_year #> mapping .file to admin.data_file #> mapping .week_number to admin.week_number #> mapping .c19_diagnosis to diagnosis.standard_of_care_COVID_diagnosis #> mapping .clinical_radio_diagnosis to diagnosis.clinical_or_radiological_LRTI_or_pneumonia #> mapping .c19_adm_swab to diagnosis.admission_swab #> mapping .c19_test_type to diagnosis.test_type #> mapping .qualifying_symptoms_signs to diagnosis.qualifying_symptoms_signs #> mapping .cc_critieria to diagnosis.meets_case_control_criteria #> mapping .cc_pos_date to diagnosis.first_COVID_positive_swab_date #> mapping .gender to demog.gender #> mapping .age_at_admission to demog.age #> mapping .age_march to demog.age_in_march_2021 #> mapping .imd to demog.imd_decile #> mapping .smoking to demog.smoker #> mapping .ethnicity2 to demog.ethnicity #> mapping .care_home to demog.care_home_resident #> mapping .drugs___1 to demog.no_drug_abuse #> mapping .drugs___2 to demog.alcohol_abuse #> mapping .drugs___3 to demog.ivdu_abuse #> mapping .drugs___4 to demog.marijuana_abuse #> mapping .drugs___5 to demog.other_inhaled_drug_abuse #> mapping .vaping to demog.vaping #> mapping .alc_units to demog.units_of_alcohol #> mapping .np_swab to admin.np_swab_taken_1 #> mapping .adm_np_type to admin.np_swab_site_1 #> mapping .np_date to admin.np_swab_date_1 #> mapping .days_adm_npswab to admin.np_swab_day_since_admission #> mapping .np_swab_2 to admin.np_swab_taken_2 #> mapping .adm_np_type_2 to admin.np_swab_site_2 #> mapping .np_date_2 to admin.np_swab_date_2 #> the input data set does not have a np_swab_3 column (or column set) #> the input data set does not have a adm_np_type_3 column (or column set) #> mapping .np_date_3 to admin.np_swab_date_3 #> mapping .saliva to admin.saliva_sample_taken #> mapping .saliva_date to admin.saliva_sample_date #> mapping .days_adm_saliva to admin.saliva_sample_day_since_admission #> mapping .sputum to admin.sputum_sample_taken #> mapping .sputum_date to admin.sputum_sample_date #> mapping .days_adm_sputum to admin.sputum_sample_day_since_admission #> mapping .pt_ad_ur to admin.urine_sample_needed #> mapping .adm_ur_taken to admin.urine_sample_taken #> mapping .nourine_reason to admin.urine_sample_failure_reason #> the input data set does not have a adm_np_type_2 column (or column set) #> mapping .adm_ur_date to admin.urine_sample_date #> mapping .days_adm_urine to admin.urine_sample_day_since_admission #> mapping .adm_serum_tak to admin.serum_sample_taken #> mapping .adm_seru_date to admin.serum_sample_date #> mapping .days_adm_serum to admin.serum_sample_day_since_admission #> mapping .contraindication to vaccination.covid_vaccine_contraindicated #> mapping .covid19_vax to vaccination.covid_vaccination #> the input data set does not have a covidvax_date column (or column set) #> the input data set does not have a covidvax_dose_2 column (or column set) #> the input data set does not have a covidvax_dose_3 column (or column set) #> the input data set does not have a covidvax_dose_4 column (or column set) #> the input data set does not have a covidvax_dose_5 column (or column set) #> the input data set does not have a covidvax_dose_6 column (or column set) #> mapping .brand_of_covid19_vaccinati to vaccination.first_dose_brand #> mapping .covid19vax_brand_2 to vaccination.second_dose_brand #> mapping .covid19vax_brand_3 to vaccination.third_dose_brand #> mapping .covid19vax_brand_4 to vaccination.fourth_dose_brand #> mapping .covid19vax_brand_5 to vaccination.fifth_dose_brand #> mapping .covid19vax_brand_6 to vaccination.sixth_dose_brand #> mapping .c19vaxd1_adm to admission.time_since_first_vaccine_dose #> mapping .c19vaxd2_adm to admission.time_since_second_vaccine_dose #> mapping .c19vaxd3_adm to admission.time_since_third_vaccine_dose #> mapping .c19vaxd4_adm to admission.time_since_fourth_vaccine_dose #> mapping .c19vax5_adm to admission.time_since_fifth_vaccine_dose #> mapping .c19vax6_adm to admission.time_since_sixth_vaccine_dose #> the input data set does not have a flu_date column (or column set) #> mapping .fluvax_adm_d1 to admission.time_since_last_flu_vaccine_dose #> the input data set does not have a ppv23_date column (or column set) #> mapping .ppv23vax_adm_d to admission.time_since_last_pneumococcal_vaccine_dose #> mapping .c19_variant to genomic.variant #> mapping .year to admission.year #> mapping .study_week to admission.study_week #> mapping .admission_date to admission.date #> mapping .hospital to admin.hospital #> mapping .adm_diagnosis___1 to admission.presumed_CAP_radiologically_confirmed #> mapping .adm_diagnosis___2 to admission.presumed_CAP_clinically_confirmed #> mapping .adm_diagnosis___3 to admission.presumed_CAP_no_radiology #> mapping .adm_diagnosis___4 to admission.presumed_LRTI #> mapping .adm_diagnosis___5 to admission.presumed_Empyema_or_abscess #> mapping .adm_diagnosis___6 to admission.presumed_exacerbation_COPD #> mapping .adm_diagnosis___7 to admission.presumed_exacerbation_non_COPD #> mapping .adm_diagnosis___8 to admission.presumed_congestive_heart_failure #> mapping .adm_diagnosis___9 to admission.presumed_non_infectious_process #> mapping .adm_diagnosis___10 to admission.presumed_non_LRTI #> mapping .ics to admission.on_inhaled_corticosteroids #> mapping .immsup to admission.on_immunosuppression #> mapping .psi_class to admission.pneumonia_severity_index_class #> mapping .crb_test_mai to admission.curb_65_severity_score #> mapping .news_2_total to admission.news2_score #> mapping .pulse_ox to admission.oximetry #> mapping .rr to admission.respiratory_rate #> mapping .fio2 to admission.max_oxygen #> mapping .systolic_bp to admission.systolic_bp #> mapping .diastolic_bp to admission.diastolic_bp #> mapping .hr to admission.heart_rate #> mapping .temperature to admission.temperature #> mapping .symptom_days_preadmit to admission.duration_symptoms #> mapping .previous_infection to admission.previous_covid_infection #> the input data set does not have a previousinfection_date column (or column set) #> mapping .c19d_preadm to admission.time_since_covid_diagnosis #> mapping .rockwood to admission.rockwood_score #> mapping .cci_total_score to admission.charlson_comorbidity_index #> mapping .height to admission.height #> mapping .weight to admission.weight #> mapping .bmi to admission.BMI #> mapping .first_radio___1 to admission.cxr_normal #> mapping .first_radio___2 to admission.cxr_pneumonia #> mapping .first_radio___3 to admission.cxr_heart_failure #> mapping .first_radio___4 to admission.cxr_pleural_effusion #> mapping .first_radio___5 to admission.cxr_covid_changes #> mapping .first_radio___6 to admission.cxr_other #> mapping .c19_peep to day_7.max_peep #> mapping .c19_hospadm to day_7.length_of_stay #> mapping .c17_high to day_7.max_care_level #> mapping .c19icuon to day_7.still_on_icu #> mapping .c19_icudays to day_7.icu_length_of_stay #> mapping .c19_vent to day_7.max_ventilation_level #> mapping .c19_ox to day_7.max_o2_level #> mapping .c19_ionotropes to day_7.ionotropes_needed #> mapping .c19_complication___1 to day_7.PE #> mapping .c19_complication___2 to day_7.DVT #> mapping .c19_complication___3 to day_7.ARF #> mapping .c19_complication___4 to day_7.NSTEMI #> mapping .c19_complication___5 to day_7.STEMI #> mapping .c19_complication___6 to day_7.cardiac_failure #> mapping .c19_complication___7 to day_7.new_AF #> mapping .c19_complication___8 to day_7.new_other_arrythmia #> mapping .c19_complication___9 to day_7.inpatient_fall #> mapping .c19_complication___10 to day_7.other_complication #> mapping .c19_complication___11 to day_7.no_complication #> mapping .c19_death7d to day_7.death #> mapping .c19_meds___1 to treatment.dexamethasone #> mapping .c19_meds___2 to treatment.remdesevir #> mapping .c19_meds___3 to treatment.tocilizumab #> mapping .c19_meds___4 to treatment.sarilumab #> mapping .c19_meds___5 to treatment.in_drug_trial #> mapping .c19_meds___6 to treatment.no_drug_treatment #> mapping .c19_meds___7 to treatment.sotrovimab #> mapping .hospital_length_of_stay to outcome.length_of_stay #> mapping .survival_days to outcome.survival_duration #> mapping .ip_death to outcome.inpatient_death #> mapping .days_in_icu to outcome.icu_duration #> mapping .did_the_patient_have_respi to outcome.respiratory_support_needed #> mapping .number_of_days_of_ventilat to outcome.ventilator_duration #> mapping .ett_days to outcome.endotracheal_tube_duration #> mapping .renal_replacement_therapy to outcome.renal_support_duration #> mapping .complications___1 to outcome.acute_renal_failure #> mapping .complications___2 to outcome.liver_dysfunction #> mapping .complications___3 to outcome.hospital_acquired_infection #> mapping .complications___4 to outcome.acute_respiratory_distress_syndrome #> mapping .complications___5 to outcome.NSTEMI #> mapping .complications___6 to outcome.STEMI #> mapping .complications___7 to outcome.new_AF #> mapping .complications___8 to outcome.new_other_arrhthmia #> mapping .complications___9 to outcome.stroke #> mapping .complications___10 to outcome.DVT #> mapping .complications___11 to outcome.PE #> mapping .complications___12 to outcome.heart_failure #> mapping .complications___13 to outcome.fall_in_hospital #> mapping .complications___14 to outcome.reduced_mobility #> mapping .complications___15 to outcome.increasing_care_requirement #> mapping .complications___16 to outcome.no_complications #> mapping .ventilatory_support to outcome.highest_level_ventilatory_support #> mapping .did_the_patient_receive_ec to outcome.received_ecmo #> mapping .inotropic_support_required to outcome.received_ionotropes #> mapping .lrtd_30d_outcome to outcome.functional_status #> mapping .fever2 to symptom.abnormal_temperature #> mapping .pleurtic_cp to symptom.pleuritic_chest_pain #> mapping .cough2 to symptom.cough #> mapping .sput_prod to symptom.productive_sputum #> mapping .dyspnoea to symptom.dyspnoea #> mapping .tachypnoea2 to symptom.tachypnoea #> mapping .anosmia to symptom.anosmia #> mapping .ageusia to symptom.ageusia #> mapping .dysgeusia to symptom.dysguesia #> mapping .fever to symptom.fever #> mapping .hypothermia to symptom.hypothermia #> mapping .chills to symptom.chills #> mapping .headache to symptom.headache #> mapping .malaise to symptom.malaise #> mapping .wheeze to symptom.wheeze #> mapping .myalgia to symptom.myalgia #> mapping .worse_confusion to symptom.worsening_confusion #> mapping .general_det to symptom.general_deterioration #> mapping .ox_on_admission to symptom.oxygen_required_on_admission #> mapping .resp_disease___1 to comorbid.no_resp_dx #> mapping .resp_disease___2 to comorbid.copd #> mapping .resp_disease___3 to comorbid.asthma #> mapping .resp_disease___4 to comorbid.resp_other #> mapping .other_respiratory_disease___1 to comorbid.bronchiectasis #> mapping .other_respiratory_disease___2 to comorbid.interstitial_lung_dx #> mapping .other_respiratory_disease___3 to comorbid.cystic_fibrosis #> mapping .other_respiratory_disease___4 to comorbid.pulmonary_hypertension #> mapping .other_respiratory_disease___5 to comorbid.chronic_pleural_dx #> mapping .other_respiratory_disease___6 to comorbid.other_chronic_resp_dx #> mapping .chd___1 to comorbid.no_heart_dx #> mapping .chd___2 to comorbid.ccf #> mapping .chd___3 to comorbid.ihd #> mapping .chd___4 to comorbid.hypertension #> mapping .chd___5 to comorbid.other_heart_dx #> mapping .mi to comorbid.previous_mi #> mapping .other_chd___1 to comorbid.congenital_heart_dx #> mapping .other_chd___2 to comorbid.af #> mapping .other_chd___3 to comorbid.other_arrythmia #> mapping .other_chd___4 to comorbid.pacemaker #> mapping .other_chd___5 to comorbid.valvular_heart_dx #> mapping .other_chd___6 to comorbid.other_other_heart_dx #> mapping .diabetes to comorbid.diabetes #> mapping .dm_meds to comorbid.diabetes_medications #> mapping .neurological_disease___1 to comorbid.neuro_other #> mapping .neurological_disease___2 to comorbid.cva #> mapping .neurological_disease___3 to comorbid.tia #> mapping .neurological_disease___4 to comorbid.hemiplegia #> mapping .neurological_disease___5 to comorbid.paraplegia #> mapping .neurological_disease___6 to comorbid.no_neuro_dx #> mapping .dementia___1 to comorbid.no_dementia #> mapping .dementia___2 to comorbid.dementia #> mapping .dementia___3 to comorbid.cognitive_impairment #> mapping .cancer to comorbid.solid_cancer #> mapping .haem_malig___1 to comorbid.no_haemotological_cancer #> mapping .haem_malig___2 to comorbid.leukaemia #> mapping .haem_malig___3 to comorbid.lymphoma #> mapping .ckd to comorbid.ckd #> mapping .liver_disease to comorbid.liver_disease #> mapping .gastric_ulcers to comorbid.gastric_ulcers #> mapping .pvd to comorbid.periph_vasc_dx #> mapping .ctd to comorbid.connective_tissue_dx #> mapping .immunodeficiency to comorbid.immunodeficiency #> mapping .other_pn_disease to comorbid.other_pneumococcal_risks #> mapping .transplant to comorbid.transplant_recipient #> mapping .pregnancy to comorbid.pregnancy #> mapping .hiv___1 to comorbid.no_HIV #> mapping .hiv___2 to comorbid.HIV #> mapping .hiv___3 to comorbid.AIDS #> mapping .final_soc_lrtd_diagnosis___1 to diagnosis.SOC_CAP_radiologically_confirmed #> mapping .final_soc_lrtd_diagnosis___2 to diagnosis.SOC_CAP_clinically_confirmed #> mapping .final_soc_lrtd_diagnosis___3 to diagnosis.SOC_CAP_no_radiology #> mapping .final_soc_lrtd_diagnosis___4 to diagnosis.SOC_LRTI #> mapping .final_soc_lrtd_diagnosis___5 to diagnosis.SOC_Empyema_or_abscess #> mapping .final_soc_lrtd_diagnosis___6 to diagnosis.SOC_exacerbation_COPD #> mapping .final_soc_lrtd_diagnosis___7 to diagnosis.SOC_exacerbation_non_COPD #> mapping .final_soc_lrtd_diagnosis___8 to diagnosis.SOC_congestive_heart_failure #> mapping .final_soc_lrtd_diagnosis___9 to diagnosis.SOC_non_infectious_process #> mapping .final_soc_lrtd_diagnosis___10 to diagnosis.SOC_non_LRTI #> mapping .covid_19_diagnosis to diagnosis.covid_19_diagnosis #> mapping .ppv23 to vaccination.pneumovax #> mapping .flu_vaccine to vaccination.influenza_vaccination #> Mapped 265 columns #> Did not map 3483 columns  augData2 = normData2 %>% avoncap::augment_data(.nocache = TRUE) #> Augmenting data using: augment.avoncap_export.central #> caching item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-eb1302342275d6bd14eb6ccb1c4cf7bf.rda #> Created demog.age_category, demog.age_eligible, admission.cci_category, admission.rockwood_category, admission.curb_65_category using: demog.age, admission.charlson_comorbidity_index, admission.rockwood_score, admission.curb_65_severity_score #> Created admin.patient_identifier using: admin.first_record_number, admin.record_number #> Created admission.episode, admission.interval using: admission.date #> Created comorbid.diabetes_type, comorbid.solid_cancer_present, comorbid.haemotological_cancer_present, comorbid.any_cancer_present, comorbid.any_chronic_lung_disease, comorbid.any_chronic_heart_disease, comorbid.cva_or_tia using: comorbid.diabetes, comorbid.solid_cancer, comorbid.leukaemia, comorbid.lymphoma, comorbid.no_haemotological_cancer, comorbid.asthma, comorbid.bronchiectasis, comorbid.chronic_pleural_dx, comorbid.copd, comorbid.interstitial_lung_dx, comorbid.cystic_fibrosis, comorbid.other_chronic_resp_dx, comorbid.pulmonary_hypertension, comorbid.ccf, comorbid.ihd, comorbid.previous_mi, comorbid.congenital_heart_dx, comorbid.hypertension, comorbid.af, comorbid.other_arrythmia, comorbid.other_heart_dx, comorbid.other_other_heart_dx, comorbid.cva, comorbid.tia #> Created admission.covid_pcr_result, admission.is_covid using: diagnosis.covid_19_diagnosis, diagnosis.admission_swab, diagnosis.test_type #> Created admission.initial_presentation_3_class using: admission.presumed_CAP_clinically_confirmed, admission.presumed_CAP_radiologically_confirmed, admission.presumed_CAP_no_radiology, admission.presumed_Empyema_or_abscess, admission.presumed_LRTI, admission.presumed_exacerbation_COPD, admission.presumed_exacerbation_non_COPD, admission.presumed_congestive_heart_failure #> Created diagnosis.pneumonia, diagnosis.LRTI, diagnosis.exacerbation_of_chronic_respiratory_disease, diagnosis.heart_failure using: diagnosis.SOC_CAP_clinically_confirmed, diagnosis.SOC_CAP_radiologically_confirmed, diagnosis.SOC_CAP_no_radiology, diagnosis.SOC_Empyema_or_abscess, admission.cxr_pneumonia, diagnosis.SOC_LRTI, diagnosis.SOC_exacerbation_COPD, diagnosis.SOC_exacerbation_non_COPD, diagnosis.SOC_congestive_heart_failure #> Created admission.infective_cause using: diagnosis.SOC_non_infectious_process, diagnosis.SOC_non_LRTI #> Created admission.category, admission.presentation_3_class using: #> Created diagnosis.infection_context using: diagnosis.first_COVID_positive_swab_date, admission.date #> Created genomic.variant_inferred using: genomic.variant, admission.date #> Created symptom_onset.date_of_symptoms, symptom_onset.time_of_symptoms_since_first_vaccine_dose, symptom_onset.time_of_symptoms_since_second_vaccine_dose, symptom_onset.time_of_symptoms_since_third_vaccine_dose, symptom_onset.time_of_symptoms_since_fourth_vaccine_dose, vaccination.dose_interval, vaccination.booster_interval, vaccination.second_booster_interval using: admission.date, admission.duration_symptoms, admission.time_since_first_vaccine_dose, admission.time_since_second_vaccine_dose, admission.time_since_third_vaccine_dose, admission.time_since_fourth_vaccine_dose #> Created vaccination.protection using: vaccination.covid_vaccination, admission.time_since_fourth_vaccine_dose, admission.duration_symptoms, admission.time_since_third_vaccine_dose, admission.time_since_second_vaccine_dose, admission.time_since_first_vaccine_dose, admission.previous_covid_infection #> Created vaccination.vaccination using: vaccination.covid_vaccination, admission.time_since_sixth_vaccine_dose, admission.duration_symptoms, admission.time_since_fifth_vaccine_dose, admission.time_since_fourth_vaccine_dose, admission.time_since_third_vaccine_dose, admission.time_since_second_vaccine_dose, admission.time_since_first_vaccine_dose #> Created vaccination.brand_combination using: vaccination.first_dose_brand, vaccination.second_dose_brand, vaccination.third_dose_brand #> Created pneumo.presentation_CAP, pneumo.presentation_RAD, pneumo.presentation_class using: diagnosis.SOC_CAP_radiologically_confirmed #> Created admission.pneumococcal_high_risk using: demog.age, comorbid.other_pneumococcal_risks, comorbid.copd, comorbid.interstitial_lung_dx, comorbid.cystic_fibrosis, comorbid.hypertension, comorbid.ccf, comorbid.ihd, comorbid.ckd, comorbid.liver_disease, comorbid.diabetes, comorbid.immunodeficiency, comorbid.asthma, admission.on_immunosuppression #> Created admission.pneumococcal_risk_classification using: comorbid.cva, comorbid.immunodeficiency, comorbid.leukaemia, comorbid.lymphoma, comorbid.no_haemotological_cancer, admission.on_immunosuppression, comorbid.transplant_recipient, comorbid.ckd, comorbid.HIV, comorbid.solid_cancer, demog.care_home_resident, demog.smoker, demog.age, demog.alcohol_abuse, comorbid.diabetes, comorbid.diabetes_medications, comorbid.paraplegia, comorbid.copd, comorbid.interstitial_lung_dx, comorbid.cystic_fibrosis, comorbid.asthma, comorbid.liver_disease, comorbid.ccf, comorbid.ihd, comorbid.other_pneumococcal_risks #> Created day_7.WHO_clinical_progression, outcome.WHO_clinical_progression using: day_7.death, day_7.max_ventilation_level, day_7.ionotropes_needed, day_7.max_o2_level, outcome.survival_duration, outcome.functional_status, outcome.highest_level_ventilatory_support, outcome.received_ionotropes, outcome.respiratory_support_needed #> Created outcome.icu_admission, outcome.death_within_30_days, outcome.death_during_follow_up using: outcome.icu_duration, day_7.death, outcome.survival_duration, outcome.inpatient_death, outcome.functional_status #> Created day_7.max_o2_gt_28, day_7.max_o2_gt_35, day_7.max_o2_gt_50, day_7.WHO_score_gt_6, day_7.WHO_score_gt_5, day_7.los_gt_3, day_7.los_gt_5, day_7.los_gt_7 using: day_7.max_o2_level, day_7.length_of_stay, outcome.survival_duration avoncap::find_new_field_names(normData2, \"adm_diagnosis\") #>                                 adm_diagnosis___1  #> \"admission.presumed_CAP_radiologically_confirmed\"  #>                                 adm_diagnosis___2  #>     \"admission.presumed_CAP_clinically_confirmed\"  #>                                 adm_diagnosis___3  #>             \"admission.presumed_CAP_no_radiology\"  #>                                 adm_diagnosis___4  #>                         \"admission.presumed_LRTI\"  #>                                 adm_diagnosis___5  #>           \"admission.presumed_Empyema_or_abscess\"  #>                                 adm_diagnosis___6  #>            \"admission.presumed_exacerbation_COPD\"  #>                                 adm_diagnosis___7  #>        \"admission.presumed_exacerbation_non_COPD\"  #>                                 adm_diagnosis___8  #>     \"admission.presumed_congestive_heart_failure\"  #>                                 adm_diagnosis___9  #>       \"admission.presumed_non_infectious_process\"  #>                                adm_diagnosis___10  #>                     \"admission.presumed_non_LRTI\""},{"path":"/articles/uad-data.html","id":"data-loading","dir":"Articles","previous_headings":"","what":"Data loading","title":"Pneumococcus urinary antigen data","text":"raw data expected urine-antigens subfolder data distributed single file cases controls together without distinguishing features. BinaxNOW serotype specific UAD tests results. tests run every person.","code":"fs::dir_tree(path = avoncap::input(\"urine-antigens\")) #> /home/vp22681/Data/avoncap/urine-antigens #> ├── 2022-09-15 #> │   └── uad-cases.csv #> ├── 2023-05-15 #> │   ├── gp-cases.csv #> │   └── uad-cases.csv #> ├── B1851202_SAP V1.0-27Sep2021_Final.pdf #> ├── README.md #> └── Table Template Serotype Distribution Scientific Affairs Proposal_FINAL.docx most_recent_files(\"urine-antigens\") #> # A tibble: 2 × 7 #>   filename  directory      path          date       hospital study_year filetype #>   <chr>     <chr>          <fs::path>    <date>     <chr>         <int> <chr>    #> 1 gp-cases  urine-antigens …gp-cases.csv 2023-05-15 NA               NA csv      #> 2 uad-cases urine-antigens …ad-cases.csv 2023-05-15 NA               NA csv rawUA = load_data(\"urine-antigens\") #> caching item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-a34df7f73813316db44634d7c8101b95.rda #> Loaded 101647 rows from 2 files, (7925+93722=101647)"},{"path":"/articles/uad-data.html","id":"data-normalisation","dir":"Articles","previous_headings":"","what":"Data normalisation","title":"Pneumococcus urinary antigen data","text":"data can subdivided serotype versus binax groups normalisation handles processing serotype format ^[0-9]+[-Z]$, aligning format patient identifier match [0-9]{4}-[0-9]+. processing test dates (supplied %e-%b-%y format). normalised UAD data individual serotype specific tests results nested column. single BinaxNOW result nested. Results keyed surveillance number (admission episode identifier) test data. UAD format: admin.consented_record_number: character pneumo.test_date: Date key.consent: character key.sample: character pneumo.urine_antigen: list BinaxNOW format: pneumo.binax_result: factor pneumo.test_date: Date admin.consented_record_number: character pneumo.urine_antigen_sample_id: character key.consent: character key.sample: character","code":"normUA = rawUA %>% normalise_data(instrument = \"serotype\", .nocache=TRUE) #> Normalising data using: normalise.urine_antigens.serotype #> caching item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-47db867bf7ce62827001276c41513ee8.rda #> mapping .RESULT to pneumo.urine_antigen_result #> mapping .EVENT_DATE to pneumo.test_date #> mapping .ANALYSIS to pneumo.urine_antigen_test #> mapping .SUBJECT to admin.consented_record_number #> mapping .BARCODE to pneumo.urine_antigen_sample_id #> Mapped 5 columns #> Did not map 23 columns normBinax = rawUA %>% normalise_data(instrument = \"binax\", .nocache=TRUE) #> Normalising data using: normalise.urine_antigens.binax #> caching item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-980aa36f9ff48c370b7f834c5f4955bc.rda #> mapping .RESULT to pneumo.binax_result #> mapping .EVENT_DATE to pneumo.test_date #> mapping .SUBJECT to admin.consented_record_number #> mapping .BARCODE to pneumo.urine_antigen_sample_id #> Mapped 4 columns #> Did not map 24 columns"},{"path":"/articles/uad-data.html","id":"data-augmentation","dir":"Articles","previous_headings":"","what":"Data augmentation","title":"Pneumococcus urinary antigen data","text":"UAD results commonly want know following: serotype testing complete serotypes? whole UAD panel positive serotype, many? UAD1 panel positive? UAD2? UAD positive PCV vaccine covered serotype? BINAX results real addition qeustions relevant","code":"augUA = normUA %>% augment_data() #> Augmenting data using: augment.urine_antigens.serotype #> caching item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-6e6fd7c403bfa3774af1a9a6712c5f13.rda #> Created pneumo.pcv_group using: key.sample, pneumo.urine_antigen #> Created pneumo.non_uad_panel_result, pneumo.uad1_panel_result, pneumo.uad2_panel_result, pneumo.serotype_summary_result, pneumo.serotype_positive_count, pneumo.serotype_results_complete using: key.sample, pneumo.urine_antigen   # augUA %>% filter(pneumo.serotype_results_complete) %>%  #   group_by(pneumo.serotype_summary_result) %>%  #   count() #  # augUA %>% unnest(pneumo.pcv_group) %>% with(table(group,result)) #  # ggplot( #   augUA %>% unnest(pneumo.pcv_group) %>%  #     inner_join(avoncap::serotype_data$names, by=c(\"group\"=\"label\")) %>% #     filter(indent==2, result == \"Positive\"), aes(x=group))+ #   geom_histogram(stat=\"count\")"},{"path":"/articles/uad-data.html","id":"common-operations","dir":"Articles","previous_headings":"","what":"Common operations","title":"Pneumococcus urinary antigen data","text":"Find ","code":"# normUA %>% unnest(pneumo.urine_antigen) %>% group_by(result) %>% count() # ggplot(normUA %>% unnest(pneumo.urine_antigen) %>% filter(result == \"Positive\"), aes(x=test))+geom_histogram(stat=\"count\") # normBinax %>% group_by(pneumo.binax_result) %>% count() tmp = augUA %>% derive_pcv_groupings(pcv_map = avoncap::uad_pcv_map, col_name = pcv_custom) %>% glimpse() #> Rows: 4,077 #> Columns: 13 #> $ admin.consented_record_number    <chr> \"1001-00045\", \"1001-00057\", \"1001-000… #> $ pneumo.test_date                 <date> 2020-11-06, 2021-02-04, 2021-02-04, … #> $ key.consent                      <chr> \"1001-00045\", \"1001-00057\", \"1001-000… #> $ key.sample                       <chr> \"1001-00045-2020-11-06\", \"1001-00057-… #> $ pneumo.urine_antigen             <list> [<tbl_df[24 x 3]>], [<tbl_df[24 x 3]… #> $ pneumo.pcv_group                 <list> [<tbl_df[38 x 2]>], [<tbl_df[38 x 2]… #> $ pneumo.non_uad_panel_result      <fct> Unknown, Unknown, Unknown, Unknown, U… #> $ pneumo.uad1_panel_result         <fct> Negative, Negative, Negative, Negativ… #> $ pneumo.uad2_panel_result         <fct> Negative, Negative, Negative, Negativ… #> $ pneumo.serotype_summary_result   <fct> Negative, Negative, Negative, Negativ… #> $ pneumo.serotype_positive_count   <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0… #> $ pneumo.serotype_results_complete <lgl> TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T… #> $ pcv_custom                       <list> [<tbl_df[38 x 2]>], [<tbl_df[38 x 2]… tmp %>% unnest(pcv_custom) %>% with(table(group,result)) #>                                     result #> group                                Negative Positive Other Unknown #>   PCV7 (plus 9A,18A/B/F,23B)             4002       43    26       6 #>   PCV13 (plus 9A,18A/B/F,23B,6C)         3907      131    33       6 #>   PCV15 (plus 9A,18A/B/F,23B,6C)         3864      153    44      16 #>   PCV20 (plus 9A,18A/B/F,23B,6C,15C)     3740      268    53      16 #>   PPV23 (plus 9A,18A/B/F,23B,15C)        3727      280    54      16 #>   PCV10 (Serum Study Institute)          3953       85    33       6 #>   PCV10 (GSK)                            3953       85    33       6 #>   PCV15 (Zhifei)                         3896      132    33      16 #>   PCV24 (Vaxcyte)                        3711      296    54      16 #>   PCV24 (Affinivax)                      3711      296    54      16 #>   Additional PCV13 on 7 (plus 6C)        3949       89    33       6 #>   Additional PCV15 on 13                 4008       24    33      12 #>   Additional PCV20 on 15 (plus 15C)      3895      124    46      12 #>   Additional PPV23 on PCV20              4028       29     8      12 #>   4                                      4040       11    20       6 #>   6B                                     4051        0    20       6 #>   9V+A                                   4050        1    20       6 #>   14                                     4037       11    23       6 #>   18C+A/B/F                              4048        1    23       5 #>   19F                                    4048        3    20       6 #>   23F+B                                  4031       17    23       6 #>   1                                      4037        9    25       6 #>   3                                      4025       26    20       6 #>   5                                      4046        3    22       6 #>   6A+C                                   4032       17    22       6 #>   7F                                     4011       33    28       5 #>   19A                                    4044        6    21       6 #>   22F                                    4029       13    23      12 #>   33F                                    4030       11    24      12 #>   8                                      3931       97    37      12 #>   10A                                    4021       16    28      12 #>   11A                                    4053        9     3      12 #>   12F                                    4061        0     4      12 #>   15B+C                                  4058        3     4      12 #>   2                                      4060        1     4      12 #>   9N                                     4050       11     4      12 #>   17F                                    4048       12     5      12 #>   20                                     4056        5     4      12 #>   Other                                     0        0     0       0"},{"path":"/articles/web/avoncap.html","id":"input-data-location","dir":"Articles > Web","previous_headings":"","what":"Input data location","title":"Getting started","text":"first level directories. Filenames need indication database year (either 20-21,21-22,… y1,y2,…)","code":"# The data input directory on my development machine: options(\"avoncap.input\" = \"~/Data/avoncap/\")  # The directory structure: fs::dir_tree(path = avoncap::input(),glob=\"*/cache/*\",invert=TRUE) #> /home/vp22681/Data/avoncap #> ├── avoncap-export #> │   ├── 2022-03-22 #> │   │   ├── central_y1.csv #> │   │   └── central_y2.csv #> │   ├── 2022-06-20 #> │   │   ├── central_y1.csv #> │   │   └── central_y2.csv #> │   ├── 2022-07-11 #> │   │   ├── central_y1.csv #> │   │   └── central_y2.csv #> │   ├── 2022-09-21 #> │   │   ├── central_y1.csv #> │   │   └── central_y2.csv #> │   ├── 2022-10-07 #> │   │   └── uad-controls.csv #> │   ├── 2022-11-09 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   └── uad-controls.csv #> │   ├── 2023-03-02 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   └── central_y3.csv #> │   ├── 2023-05-02 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   └── central_y3.csv #> │   ├── 2023-06-12 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   └── central_y3.csv #> │   ├── 2023-06-16 #> │   │   └── uad-controls.csv #> │   ├── 2023-06-28 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   ├── central_y3.csv #> │   │   └── gp.csv #> │   ├── 2023-07-24 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   └── central_y3.csv #> │   ├── 22-23 codebook NBT.pdf #> │   ├── 22-23 codebook UHBW.pdf #> │   ├── Avon CAP - LRTD Patients 21-22 _ REDCap codebook.pdf #> │   ├── Avon CAP - LRTD central database 20-21 _ REDCap.pdf #> │   ├── AvonCAP Pneumococcus Codebook.pdf #> │   ├── AvonCAP field validity.xlsx #> │   └── README.md #> ├── avoncap.yaml #> ├── cache #> ├── downloads #> │   └── README.md #> ├── ethnicity #> │   ├── 2022-07-12 #> │   │   ├── y1.csv #> │   │   └── y2.csv #> │   ├── 2022-10-27 #> │   │   ├── y1.csv #> │   │   └── y2.csv #> │   ├── 2023-06-07 #> │   │   ├── y1.csv #> │   │   ├── y2.csv #> │   │   └── y3.csv #> │   └── README.md #> ├── google-mobility #> │   └── Global_Mobility_Report.csv #> ├── ltla-incidence #> │   ├── ltla_2022-02-28.csv #> │   └── ltla_2022-03-18.csv #> ├── maybe_some_useful_files_data.zip #> ├── metadata #> │   ├── 2022-10-24 #> │   │   ├── central_y1.csv #> │   │   ├── central_y2.csv #> │   │   ├── central_y3.csv #> │   │   └── uad-controls.csv #> │   ├── 2022-11-29 #> │   │   └── pneumococcal.csv #> │   └── README.md #> ├── metadata-review #> │   ├── 2022-10-25 #> │   │   └── metadata-review.csv #> │   ├── AvonCAP 21-22 markred.xlsx #> │   └── AvonCAP data dictionary - fields.csv #> ├── nhs-extract #> │   ├── 2022-07-11 #> │   │   ├── deltave_BRI_y1.csv #> │   │   ├── deltave_BRI_y2.csv #> │   │   ├── deltave_NBT_y1.csv #> │   │   └── deltave_NBT_y2.csv #> │   ├── 2022-09-20 #> │   │   ├── deltave_BRI_y1.csv #> │   │   ├── deltave_BRI_y2.csv #> │   │   ├── deltave_BRI_y3.csv #> │   │   ├── deltave_NBT_y1.csv #> │   │   ├── deltave_NBT_y2.csv #> │   │   └── deltave_NBT_y3.csv #> │   ├── 2022-11-16 #> │   │   ├── deltave_BRI_y1.csv #> │   │   ├── deltave_BRI_y2.csv #> │   │   ├── deltave_BRI_y3.csv #> │   │   ├── deltave_NBT_y1.csv #> │   │   ├── deltave_NBT_y2.csv #> │   │   └── deltave_NBT_y3.csv #> │   ├── 2022-11-29 #> │   │   └── pneumococcal.csv #> │   ├── 2022-11-30 #> │   │   ├── deltave_BRI_y1.csv #> │   │   ├── deltave_BRI_y2.csv #> │   │   ├── deltave_BRI_y3.csv #> │   │   ├── deltave_NBT_y1.csv #> │   │   ├── deltave_NBT_y2.csv #> │   │   └── deltave_NBT_y3.csv #> │   ├── 2022-12-07 #> │   │   ├── deltave_BRI_y1.csv #> │   │   ├── deltave_BRI_y2.csv #> │   │   ├── deltave_BRI_y3.csv #> │   │   ├── deltave_NBT_y1.csv #> │   │   ├── deltave_NBT_y2.csv #> │   │   └── deltave_NBT_y3.csv #> │   ├── 2022-12-20 #> │   │   └── ipd_avoncap_linkage.csv #> │   ├── 2023-02-07 #> │   │   └── pneumococcal.csv #> │   ├── README.md #> │   └── old #> │       ├── AdmissionDateByStudyNumber_2022-07-12.csv #> │       └── DeltaVE_04042022.csv #> ├── spim-seroprevalence #> │   └── week15_2022_seroprev_modellers.csv #> └── urine-antigens #>     ├── 2022-09-15 #>     │   └── uad-cases.csv #>     ├── 2023-05-15 #>     │   ├── gp-cases.csv #>     │   └── uad-cases.csv #>     ├── B1851202_SAP V1.0-27Sep2021_Final.pdf #>     ├── README.md #>     └── Table Template Serotype Distribution Scientific Affairs Proposal_FINAL.docx # get the most recent files avoncap::most_recent_files(\"ethnicity\") #> # A tibble: 3 × 7 #>   filename directory path                date       hospital study_year filetype #>   <chr>    <chr>     <fs::path>          <date>     <chr>         <int> <chr>    #> 1 y1       ethnicity …/2023-06-07/y1.csv 2023-06-07 NA               NA csv      #> 2 y2       ethnicity …/2023-06-07/y2.csv 2023-06-07 NA               NA csv      #> 3 y3       ethnicity …/2023-06-07/y3.csv 2023-06-07 NA               NA csv # devtools::load_all() try(avoncap::load_data(\"missing\")) #> No suitable files matching \"missing\", before date: 2023-09-05. Try one of:  #> as an input to 'type' #> Error in avoncap::load_data(\"missing\") : aborting."},{"path":"/articles/web/avoncap.html","id":"load-data-sources-and-recording-provenance","dir":"Articles > Web","previous_headings":"","what":"Load data sources and recording provenance","title":"Getting started","text":"","code":"ethn = avoncap::load_data(\"ethnicity\") #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-9e78c8c6974b935c1f39481c79dad211.rda avoncap::most_recent_files(\"nhs-extract\",\"deltave\") #> # A tibble: 6 × 7 #>   filename       directory   path        date       hospital study_year filetype #>   <chr>          <chr>       <fs::path>  <date>     <chr>         <int> <chr>    #> 1 deltave_BRI_y1 nhs-extract …BRI_y1.csv 2022-12-07 BRI               1 csv      #> 2 deltave_BRI_y2 nhs-extract …BRI_y2.csv 2022-12-07 BRI               2 csv      #> 3 deltave_BRI_y3 nhs-extract …BRI_y3.csv 2022-12-07 BRI               3 csv      #> 4 deltave_NBT_y1 nhs-extract …NBT_y1.csv 2022-12-07 NBT               1 csv      #> 5 deltave_NBT_y2 nhs-extract …NBT_y2.csv 2022-12-07 NBT               2 csv      #> 6 deltave_NBT_y3 nhs-extract …NBT_y3.csv 2022-12-07 NBT               3 csv rawData = avoncap::load_data(\"nhs-extract\",\"deltave\") #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-efc310106a2b36fab3e67f93fe2c9461.rda # rawData = avoncap::load_data(\"nhs-extract\",\"deltave\",merge = FALSE) avoncap::save_data_source_info(ethn, rawData, .file = tempfile(\"file-info\",fileext = \".txt\")) #> # A tibble: 9 × 2 #>   path                                                                 md5       #>   <chr>                                                                <chr>     #> 1 /home/vp22681/Data/avoncap/ethnicity/2023-06-07/y1.csv               270d33ea… #> 2 /home/vp22681/Data/avoncap/ethnicity/2023-06-07/y2.csv               0a9ee3dc… #> 3 /home/vp22681/Data/avoncap/ethnicity/2023-06-07/y3.csv               3a4a048f… #> 4 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_BRI_y1.csv 66825a94… #> 5 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_BRI_y2.csv cbd04cf3… #> 6 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_BRI_y3.csv b2fd0723… #> 7 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_NBT_y1.csv f61195e9… #> 8 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_NBT_y2.csv be0456bb… #> 9 /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_NBT_y3.csv 49d5d4ed…"},{"path":"/articles/web/avoncap.html","id":"normalising-data","dir":"Articles > Web","previous_headings":"","what":"Normalising data","title":"Getting started","text":"","code":"# devtools::install_local(force=TRUE) normData = rawData %>%    avoncap::validate_data() %T>%   # note the magrittr `T` pipe above to drop the output of write issues   avoncap::write_issues(\"issues.csv\") %>%   avoncap::normalise_data() #> validate data using: validate.nhs_extract.deltave #> Normalising data using: normalise.nhs_extract.deltave #> Some columns expected in the mappings were not present: consent_urine, consent_blood, consent_resp_samples1, what_was_the_first_surveil, np_swab, adm_np_type, np_date, days_adm_npswab, np_swab_2, adm_np_type_2, np_date_2, np_swab_3, adm_np_type_3, np_date_3, saliva, saliva_date, days_adm_saliva, sputum, sputum_date, days_adm_sputum, pt_ad_ur, adm_ur_taken, nourine_reason, adm_np_type_2, adm_ur_date, days_adm_urine, adm_serum_tak, adm_seru_date, days_adm_serum, adm_diagnosis #> using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-d1c7dea8d8da0abfcccfeb6ece1389d0.rda"},{"path":"/articles/web/avoncap.html","id":"mapping-columns","dir":"Articles > Web","previous_headings":"","what":"Mapping columns","title":"Getting started","text":"","code":"# Successfully mapped columns # attr(normData,\"mapped\")  # Columns that are present in the normData but not mapped attr(normData,\"unmapped\") #> [1] \".spec_other_resp\"    \".spec_other_cardiac\" \".batch_code1\"        #> [4] \".batch_code2\"        \".c19_compother\"      \".batch_code3\"        #> [7] \".batch_code4\"        \".batch_code5\"  # Columns not present in the normData for which mapping rules were supplied attr(normData,\"missing\") #>  [1] \"consent_urine\"              \"consent_blood\"              #>  [3] \"consent_resp_samples1\"      \"what_was_the_first_surveil\" #>  [5] \"np_swab\"                    \"adm_np_type\"                #>  [7] \"np_date\"                    \"days_adm_npswab\"            #>  [9] \"np_swab_2\"                  \"adm_np_type_2\"              #> [11] \"np_date_2\"                  \"np_swab_3\"                  #> [13] \"adm_np_type_3\"              \"np_date_3\"                  #> [15] \"saliva\"                     \"saliva_date\"                #> [17] \"days_adm_saliva\"            \"sputum\"                     #> [19] \"sputum_date\"                \"days_adm_sputum\"            #> [21] \"pt_ad_ur\"                   \"adm_ur_taken\"               #> [23] \"nourine_reason\"             \"adm_np_type_2\"              #> [25] \"adm_ur_date\"                \"days_adm_urine\"             #> [27] \"adm_serum_tak\"              \"adm_seru_date\"              #> [29] \"days_adm_serum\"             \"adm_diagnosis\""},{"path":"/articles/web/avoncap.html","id":"original-field-names-and-labels-","dir":"Articles > Web","previous_headings":"","what":"Original field names, and labels.","title":"Getting started","text":"","code":"# devtools::load_all()  # generate a set of readable label mappings from column to printable name for the whole normData set # overriding a particular label # readable_label_mapping(normData, demog.age=\"TEST\")  # Map a single column name as a string to a readable label readable_label(\"comorbid.previous_MI\") #> [1] \"Previous MI\"  # get mapping from original field names pre-normalisation to # post normalisation fields original_field_names(normData) #>                                              consented  #>                                      \"admin.consented\"  #>                                                    ppc  #>                                   \"admin.pp_consented\"  #>                                             withdrawal  #>                                     \"admin.withdrawal\"  #>                                          record_number  #>                                  \"admin.record_number\"  #>                                        ac_study_number  #>                        \"admin.consented_record_number\"  #>                                             nhs_number  #>                             \"admin.patient_identifier\"  #>                                              duplicate  #>                                      \"admin.duplicate\"  #>                                        enrollment_date  #>                                \"admin.enrollment_date\"  #>                                             study_year  #>                                     \"admin.study_year\"  #>                                                   file  #>                                      \"admin.data_file\"  #>                                            week_number  #>                                    \"admin.week_number\"  #>                                          c19_diagnosis  #>           \"diagnosis.standard_of_care_COVID_diagnosis\"  #>                               clinical_radio_diagnosis  #> \"diagnosis.clinical_or_radiological_LRTI_or_pneumonia\"  #>                                           c19_adm_swab  #>                             \"diagnosis.admission_swab\"  #>                                          c19_test_type  #>                                  \"diagnosis.test_type\"  #>                              qualifying_symptoms_signs  #>                  \"diagnosis.qualifying_symptoms_signs\"  #>                                           cc_critieria  #>                \"diagnosis.meets_case_control_criteria\"  #>                                            cc_pos_date  #>             \"diagnosis.first_COVID_positive_swab_date\"  #>                                                 gender  #>                                         \"demog.gender\"  #>                                       age_at_admission  #>                                            \"demog.age\"  #>                                              age_march  #>                              \"demog.age_in_march_2021\"  #>                                                    imd  #>                                     \"demog.imd_decile\"  #>                                                smoking  #>                                         \"demog.smoker\"  #>                                             ethnicity2  #>                                      \"demog.ethnicity\"  #>                                              care_home  #>                             \"demog.care_home_resident\"  #>                                              drugs___1  #>                                  \"demog.no_drug_abuse\"  #>                                              drugs___2  #>                                  \"demog.alcohol_abuse\"  #>                                              drugs___3  #>                                     \"demog.ivdu_abuse\"  #>                                              drugs___4  #>                                \"demog.marijuana_abuse\"  #>                                              drugs___5  #>                       \"demog.other_inhaled_drug_abuse\"  #>                                                 vaping  #>                                         \"demog.vaping\"  #>                                              alc_units  #>                               \"demog.units_of_alcohol\"  #>                                       contraindication  #>            \"vaccination.covid_vaccine_contraindicated\"  #>                                            covid19_vax  #>                        \"vaccination.covid_vaccination\"  #>                                          covidvax_date  #>                          \"vaccination.first_dose_date\"  #>                                        covidvax_dose_2  #>                         \"vaccination.second_dose_date\"  #>                                        covidvax_dose_3  #>                          \"vaccination.third_dose_date\"  #>                                        covidvax_dose_4  #>                         \"vaccination.fourth_dose_date\"  #>                                        covidvax_dose_5  #>                          \"vaccination.fifth_dose_date\"  #>                                        covidvax_dose_6  #>                          \"vaccination.sixth_dose_date\"  #>                             brand_of_covid19_vaccinati  #>                         \"vaccination.first_dose_brand\"  #>                                     covid19vax_brand_2  #>                        \"vaccination.second_dose_brand\"  #>                                     covid19vax_brand_3  #>                         \"vaccination.third_dose_brand\"  #>                                     covid19vax_brand_4  #>                        \"vaccination.fourth_dose_brand\"  #>                                     covid19vax_brand_5  #>                         \"vaccination.fifth_dose_brand\"  #>                                     covid19vax_brand_6  #>                         \"vaccination.sixth_dose_brand\"  #>                                           c19vaxd1_adm  #>              \"admission.time_since_first_vaccine_dose\"  #>                                           c19vaxd2_adm  #>             \"admission.time_since_second_vaccine_dose\"  #>                                           c19vaxd3_adm  #>              \"admission.time_since_third_vaccine_dose\"  #>                                           c19vaxd4_adm  #>             \"admission.time_since_fourth_vaccine_dose\"  #>                                            c19vax5_adm  #>              \"admission.time_since_fifth_vaccine_dose\"  #>                                            c19vax6_adm  #>              \"admission.time_since_sixth_vaccine_dose\"  #>                                               flu_date  #>                       \"vaccination.last_flu_dose_date\"  #>                                          fluvax_adm_d1  #>           \"admission.time_since_last_flu_vaccine_dose\"  #>                                             ppv23_date  #>              \"vaccination.last_pneumococcal_dose_date\"  #>                                         ppv23vax_adm_d  #>  \"admission.time_since_last_pneumococcal_vaccine_dose\"  #>                                            c19_variant  #>                                      \"genomic.variant\"  #>                                                   year  #>                                       \"admission.year\"  #>                                             study_week  #>                                 \"admission.study_week\"  #>                                         admission_date  #>                                       \"admission.date\"  #>                                               hospital  #>                                       \"admin.hospital\"  #>                                                    ics  #>                 \"admission.on_inhaled_corticosteroids\"  #>                                                 immsup  #>                       \"admission.on_immunosuppression\"  #>                                              psi_class  #>             \"admission.pneumonia_severity_index_class\"  #>                                           crb_test_mai  #>                     \"admission.curb_65_severity_score\"  #>                                           news_2_total  #>                                \"admission.news2_score\"  #>                                               pulse_ox  #>                                   \"admission.oximetry\"  #>                                                     rr  #>                           \"admission.respiratory_rate\"  #>                                                   fio2  #>                                 \"admission.max_oxygen\"  #>                                            systolic_bp  #>                                \"admission.systolic_bp\"  #>                                           diastolic_bp  #>                               \"admission.diastolic_bp\"  #>                                                     hr  #>                                 \"admission.heart_rate\"  #>                                            temperature  #>                                \"admission.temperature\"  #>                                  symptom_days_preadmit  #>                          \"admission.duration_symptoms\"  #>                                     previous_infection  #>                   \"admission.previous_covid_infection\"  #>                                 previousinfection_date  #>              \"admission.previous_covid_infection_date\"  #>                                            c19d_preadm  #>                 \"admission.time_since_covid_diagnosis\"  #>                                               rockwood  #>                             \"admission.rockwood_score\"  #>                                        cci_total_score  #>                 \"admission.charlson_comorbidity_index\"  #>                                                 height  #>                                     \"admission.height\"  #>                                                 weight  #>                                     \"admission.weight\"  #>                                                    bmi  #>                                        \"admission.BMI\"  #>                                        first_radio___1  #>                                 \"admission.cxr_normal\"  #>                                        first_radio___2  #>                              \"admission.cxr_pneumonia\"  #>                                        first_radio___3  #>                          \"admission.cxr_heart_failure\"  #>                                        first_radio___4  #>                       \"admission.cxr_pleural_effusion\"  #>                                        first_radio___5  #>                          \"admission.cxr_covid_changes\"  #>                                        first_radio___6  #>                                  \"admission.cxr_other\"  #>                                               c19_peep  #>                                       \"day_7.max_peep\"  #>                                            c19_hospadm  #>                                 \"day_7.length_of_stay\"  #>                                               c17_high  #>                                 \"day_7.max_care_level\"  #>                                               c19icuon  #>                                   \"day_7.still_on_icu\"  #>                                            c19_icudays  #>                             \"day_7.icu_length_of_stay\"  #>                                               c19_vent  #>                          \"day_7.max_ventilation_level\"  #>                                                 c19_ox  #>                                   \"day_7.max_o2_level\"  #>                                         c19_ionotropes  #>                              \"day_7.ionotropes_needed\"  #>                                   c19_complication___1  #>                                             \"day_7.PE\"  #>                                   c19_complication___2  #>                                            \"day_7.DVT\"  #>                                   c19_complication___3  #>                                            \"day_7.ARF\"  #>                                   c19_complication___4  #>                                         \"day_7.NSTEMI\"  #>                                   c19_complication___5  #>                                          \"day_7.STEMI\"  #>                                   c19_complication___6  #>                                \"day_7.cardiac_failure\"  #>                                   c19_complication___7  #>                                         \"day_7.new_AF\"  #>                                   c19_complication___8  #>                            \"day_7.new_other_arrythmia\"  #>                                   c19_complication___9  #>                                 \"day_7.inpatient_fall\"  #>                                  c19_complication___10  #>                             \"day_7.other_complication\"  #>                                  c19_complication___11  #>                                \"day_7.no_complication\"  #>                                            c19_death7d  #>                                          \"day_7.death\"  #>                                           c19_meds___1  #>                              \"treatment.dexamethasone\"  #>                                           c19_meds___2  #>                                 \"treatment.remdesevir\"  #>                                           c19_meds___3  #>                                \"treatment.tocilizumab\"  #>                                           c19_meds___4  #>                                  \"treatment.sarilumab\"  #>                                           c19_meds___5  #>                              \"treatment.in_drug_trial\"  #>                                           c19_meds___6  #>                          \"treatment.no_drug_treatment\"  #>                                           c19_meds___7  #>                                 \"treatment.sotrovimab\"  #>                                hospital_length_of_stay  #>                               \"outcome.length_of_stay\"  #>                                          survival_days  #>                            \"outcome.survival_duration\"  #>                                               ip_death  #>                              \"outcome.inpatient_death\"  #>                                            days_in_icu  #>                                 \"outcome.icu_duration\"  #>                             did_the_patient_have_respi  #>                   \"outcome.respiratory_support_needed\"  #>                             number_of_days_of_ventilat  #>                          \"outcome.ventilator_duration\"  #>                                               ett_days  #>                   \"outcome.endotracheal_tube_duration\"  #>                              renal_replacement_therapy  #>                       \"outcome.renal_support_duration\"  #>                                      complications___1  #>                          \"outcome.acute_renal_failure\"  #>                                      complications___2  #>                            \"outcome.liver_dysfunction\"  #>                                      complications___3  #>                  \"outcome.hospital_acquired_infection\"  #>                                      complications___4  #>          \"outcome.acute_respiratory_distress_syndrome\"  #>                                      complications___5  #>                                       \"outcome.NSTEMI\"  #>                                      complications___6  #>                                        \"outcome.STEMI\"  #>                                      complications___7  #>                                       \"outcome.new_AF\"  #>                                      complications___8  #>                          \"outcome.new_other_arrhthmia\"  #>                                      complications___9  #>                                       \"outcome.stroke\"  #>                                     complications___10  #>                                          \"outcome.DVT\"  #>                                     complications___11  #>                                           \"outcome.PE\"  #>                                     complications___12  #>                                \"outcome.heart_failure\"  #>                                     complications___13  #>                             \"outcome.fall_in_hospital\"  #>                                     complications___14  #>                             \"outcome.reduced_mobility\"  #>                                     complications___15  #>                  \"outcome.increasing_care_requirement\"  #>                                     complications___16  #>                             \"outcome.no_complications\"  #>                                    ventilatory_support  #>            \"outcome.highest_level_ventilatory_support\"  #>                             did_the_patient_receive_ec  #>                                \"outcome.received_ecmo\"  #>                             inotropic_support_required  #>                          \"outcome.received_ionotropes\"  #>                                       lrtd_30d_outcome  #>                            \"outcome.functional_status\"  #>                                                 fever2  #>                         \"symptom.abnormal_temperature\"  #>                                            pleurtic_cp  #>                         \"symptom.pleuritic_chest_pain\"  #>                                                 cough2  #>                                        \"symptom.cough\"  #>                                              sput_prod  #>                            \"symptom.productive_sputum\"  #>                                               dyspnoea  #>                                     \"symptom.dyspnoea\"  #>                                            tachypnoea2  #>                                   \"symptom.tachypnoea\"  #>                                                anosmia  #>                                      \"symptom.anosmia\"  #>                                                ageusia  #>                                      \"symptom.ageusia\"  #>                                              dysgeusia  #>                                    \"symptom.dysguesia\"  #>                                                  fever  #>                                        \"symptom.fever\"  #>                                            hypothermia  #>                                  \"symptom.hypothermia\"  #>                                                 chills  #>                                       \"symptom.chills\"  #>                                               headache  #>                                     \"symptom.headache\"  #>                                                malaise  #>                                      \"symptom.malaise\"  #>                                                 wheeze  #>                                       \"symptom.wheeze\"  #>                                                myalgia  #>                                      \"symptom.myalgia\"  #>                                        worse_confusion  #>                          \"symptom.worsening_confusion\"  #>                                            general_det  #>                        \"symptom.general_deterioration\"  #>                                        ox_on_admission  #>                 \"symptom.oxygen_required_on_admission\"  #>                                       resp_disease___1  #>                                  \"comorbid.no_resp_dx\"  #>                                       resp_disease___2  #>                                        \"comorbid.copd\"  #>                                       resp_disease___3  #>                                      \"comorbid.asthma\"  #>                                       resp_disease___4  #>                                  \"comorbid.resp_other\"  #>                          other_respiratory_disease___1  #>                              \"comorbid.bronchiectasis\"  #>                          other_respiratory_disease___2  #>                        \"comorbid.interstitial_lung_dx\"  #>                          other_respiratory_disease___3  #>                             \"comorbid.cystic_fibrosis\"  #>                          other_respiratory_disease___4  #>                      \"comorbid.pulmonary_hypertension\"  #>                          other_respiratory_disease___5  #>                          \"comorbid.chronic_pleural_dx\"  #>                          other_respiratory_disease___6  #>                       \"comorbid.other_chronic_resp_dx\"  #>                                                chd___1  #>                                 \"comorbid.no_heart_dx\"  #>                                                chd___2  #>                                         \"comorbid.ccf\"  #>                                                chd___3  #>                                         \"comorbid.ihd\"  #>                                                chd___4  #>                                \"comorbid.hypertension\"  #>                                                chd___5  #>                              \"comorbid.other_heart_dx\"  #>                                                     mi  #>                                 \"comorbid.previous_mi\"  #>                                          other_chd___1  #>                         \"comorbid.congenital_heart_dx\"  #>                                          other_chd___2  #>                                          \"comorbid.af\"  #>                                          other_chd___3  #>                             \"comorbid.other_arrythmia\"  #>                                          other_chd___4  #>                                   \"comorbid.pacemaker\"  #>                                          other_chd___5  #>                           \"comorbid.valvular_heart_dx\"  #>                                          other_chd___6  #>                        \"comorbid.other_other_heart_dx\"  #>                                               diabetes  #>                                    \"comorbid.diabetes\"  #>                                                dm_meds  #>                        \"comorbid.diabetes_medications\"  #>                               neurological_disease___1  #>                                 \"comorbid.neuro_other\"  #>                               neurological_disease___2  #>                                         \"comorbid.cva\"  #>                               neurological_disease___3  #>                                         \"comorbid.tia\"  #>                               neurological_disease___4  #>                                  \"comorbid.hemiplegia\"  #>                               neurological_disease___5  #>                                  \"comorbid.paraplegia\"  #>                               neurological_disease___6  #>                                 \"comorbid.no_neuro_dx\"  #>                                           dementia___1  #>                                 \"comorbid.no_dementia\"  #>                                           dementia___2  #>                                    \"comorbid.dementia\"  #>                                           dementia___3  #>                        \"comorbid.cognitive_impairment\"  #>                                                 cancer  #>                                \"comorbid.solid_cancer\"  #>                                         haem_malig___1  #>                    \"comorbid.no_haemotological_cancer\"  #>                                         haem_malig___2  #>                                   \"comorbid.leukaemia\"  #>                                         haem_malig___3  #>                                    \"comorbid.lymphoma\"  #>                                                    ckd  #>                                         \"comorbid.ckd\"  #>                                          liver_disease  #>                               \"comorbid.liver_disease\"  #>                                         gastric_ulcers  #>                              \"comorbid.gastric_ulcers\"  #>                                                    pvd  #>                              \"comorbid.periph_vasc_dx\"  #>                                                    ctd  #>                        \"comorbid.connective_tissue_dx\"  #>                                       immunodeficiency  #>                            \"comorbid.immunodeficiency\"  #>                                       other_pn_disease  #>                    \"comorbid.other_pneumococcal_risks\"  #>                                             transplant  #>                        \"comorbid.transplant_recipient\"  #>                                              pregnancy  #>                                   \"comorbid.pregnancy\"  #>                                                hiv___1  #>                                      \"comorbid.no_HIV\"  #>                                                hiv___2  #>                                         \"comorbid.HIV\"  #>                                                hiv___3  #>                                        \"comorbid.AIDS\"  #>                           final_soc_lrtd_diagnosis___1  #>           \"diagnosis.SOC_CAP_radiologically_confirmed\"  #>                           final_soc_lrtd_diagnosis___2  #>               \"diagnosis.SOC_CAP_clinically_confirmed\"  #>                           final_soc_lrtd_diagnosis___3  #>                       \"diagnosis.SOC_CAP_no_radiology\"  #>                           final_soc_lrtd_diagnosis___4  #>                                   \"diagnosis.SOC_LRTI\"  #>                           final_soc_lrtd_diagnosis___5  #>                     \"diagnosis.SOC_Empyema_or_abscess\"  #>                           final_soc_lrtd_diagnosis___6  #>                      \"diagnosis.SOC_exacerbation_COPD\"  #>                           final_soc_lrtd_diagnosis___7  #>                  \"diagnosis.SOC_exacerbation_non_COPD\"  #>                           final_soc_lrtd_diagnosis___8  #>               \"diagnosis.SOC_congestive_heart_failure\"  #>                           final_soc_lrtd_diagnosis___9  #>                 \"diagnosis.SOC_non_infectious_process\"  #>                          final_soc_lrtd_diagnosis___10  #>                               \"diagnosis.SOC_non_LRTI\"  #>                                     covid_19_diagnosis  #>                         \"diagnosis.covid_19_diagnosis\"  #>                                                  ppv23  #>                                \"vaccination.pneumovax\"  #>                                            flu_vaccine  #>                    \"vaccination.influenza_vaccination\" # unname(readable_label_mapping(normData))"},{"path":"/articles/web/avoncap.html","id":"augmenting-the-ve-extract-data","dir":"Articles > Web","previous_headings":"","what":"Augmenting the VE extract data","title":"Getting started","text":"","code":"# devtools::load_all() augData = normData %>% avoncap::augment_data() #> Augmenting data using: augment.nhs_extract.deltave #> using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-64df6d7cef407f0fb5a5d3dad5c82dad.rda"},{"path":"/articles/web/avoncap.html","id":"loading-and-normalising-the-central-database","dir":"Articles > Web","previous_headings":"","what":"loading and normalising the central database","title":"Getting started","text":"","code":"rawData2 = avoncap::load_data(\"avoncap-export\",\"central\", merge=TRUE) #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-fdb2cb11473acaa313a2e09bec23b8af.rda # without merge: currently: INCONSISTENT COLUMN(S) IN FILES: sars_cov2_antigen # due to the fact it is mostly a numeric but some values \">250\"  # devtools::load_all() normData2 = rawData2 %>% avoncap::validate_data() %>% avoncap::normalise_data() #> validate data using: validate.avoncap_export.central #> missing value in consented in 32 rows #> missing value in ppc in 32 rows #> missing value in include_patient in 35 rows #> missing value in hosp in 31 rows #> missing columns: ethnicity in 1 rows #> missing value in hr in 60 rows #> missing value in systolic_bp in 73 rows #> missing value in diastolic_bp in 76 rows #> missing value in temperature in 50 rows #> missing value in rr in 61 rows #> missing value in pulse_ox in 58 rows #> missing value in fio2 in 61 rows #> missing value in news_2_total in 32 rows #> missing value in crb_test_mai in 32 rows #> missing value in care_home in 32 rows #> missing value in ckd in 32 rows #> missing value in liver_disease in 32 rows #> missing value in diabetes in 32 rows #> missing value in gastric_ulcers in 32 rows #> missing value in pvd in 32 rows #> missing value in ctd in 32 rows #> missing value in immunodeficiency in 32 rows #> missing value in other_pn_disease in 37 rows #> missing value in cancer in 32 rows #> missing value in transplant in 32 rows #> missing value in smoking in 33 rows #> missing value in gender in 31 rows #> missing value in hospital_length_of_stay in 33 rows #> missing value in covid_19_diagnosis in 32 rows #> missing value in lrtd_30d_outcome in 32 rows #> missing value in week_number in 32 rows #> missing value in year in 136 rows #> missing value in highest_level_care_require in 33 rows #> missing value in ventilatory_support in 33 rows #> missing value in psi_class in 32 rows #> missing value in imd in 35 rows #> missing value in age_at_admission in 31 rows #> missing value in acute_illness in 31 rows #> missing value in covid19 in 31 rows #> missing value in clinical_radio_diagnosis in 31 rows #> missing value in fever2 in 31 rows #> missing value in pleurtic_cp in 32 rows #> missing value in cough2 in 31 rows #> missing value in sput_prod in 31 rows #> missing value in dyspnoea in 31 rows #> missing value in tachypnoea2 in 31 rows #> missing value in ausc_find in 31 rows #> missing value in radiologic in 31 rows #> missing value in symptom_days_preadmit in 45 rows #> missing value in resp_disease in 32 rows #> missing value in chd in 32 rows #> missing value in neurological_disease in 32 rows #> missing value in haem_malig in 32 rows #> missing value in final_soc_lrtd_diagnosis in 32 rows #> both pneumonia and NP-LRTI in final SOC dx in 4 rows #> missing value in dm_meds in 2 rows #> missing value in current in 3 rows #> Normalising data using: normalise.avoncap_export.central #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-9e78c8c6974b935c1f39481c79dad211.rda #> Admission date is derived from study week and hence approximate. #> Some columns expected in the mappings were not present: nhs_number, np_swab_3, adm_np_type_3, covidvax_date, covidvax_dose_2, covidvax_dose_3, covidvax_dose_4, covidvax_dose_5, covidvax_dose_6, flu_date, ppv23_date, previousinfection_date #> using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-d213773967e9e74bcb6577765d31e56a.rda failures = normData2 %>% avoncap::write_issues(\"~/avoncap-issues\")  tmp = failures %>%      filter(.error_type %in% c(\"none checked in checkbox\",\"missing value\")) %>%      inner_join(rawData2, by=\"record_number\", suffix=c(\"\",\".raw\")) %>%   group_by(.variable) %>%   filter(n()>20)         ggplot(tmp, aes(x=enrollment_date, fill=as.factor(hosp)))+   geom_histogram(binwidth = 7)+   scale_x_date(date_breaks = \"1 month\", date_labels = \"%m-%Y\")+   theme(axis.text.x.bottom = element_text(angle = 90, vjust=0.5, hjust=1))+   facet_wrap(~.variable,scales = \"free_y\") #> Warning: Removed 1643 rows containing non-finite values (`stat_bin()`). normMicro = rawData2 %>% normalise_data(instrument = \"micro\") #> Normalising data using: normalise.avoncap_export.central.micro #> using cached item: ~/.cache/avoncap/norm-b1452b07c5b368fef65b90881bbe0087-65996dd6886c9e5b1d979e11e427e856.rda  normMicro %>% filter(micro.test_performed==\"yes\") %>% select(micro.pathogen) %>% unnest(micro.pathogen) %>% with(table(pathogen,detected,  useNA = \"always\")) #>                                   detected #> pathogen                              no   yes  <NA> #>   Aspergillus                      26717    18     0 #>   Streptococcus Agalactiae         26725    10     0 #>   Candida                          26094   641     0 #>   Achromobacter Xylosoxidans       26722    13     0 #>   Bacteroides                      26731     4     0 #>   Bacteroides fragilis             26727     8     0 #>   Bacteroides ovatus               26735     0     0 #>   Bacteroides uniformis            26735     0     0 #>   Burholderia cepacia              26732     3     0 #>   Citrobacter freundii complex     26710    25     0 #>   Citrobacter koseri               26698    37     0 #>   Clostridium perfringens          26726     9     0 #>   Eggerthella lenta                26735     0     0 #>   Enterobacter aerogenes           26729     6     0 #>   Enterobacter cloacae             26632   103     0 #>   Enterococcus faecalis            26675    60     0 #>   Enterococcus faecium             26702    33     0 #>   Escherichia coli                 26276   459     0 #>   Haemophilus influenzae           26416   319     0 #>   Haemophilus parainfluenzae       26733     2     0 #>   Klebsiella oxytoca               26673    62     0 #>   Klebsiella pneumoniae            26571   164     0 #>   Morganella morganii              26730     5     0 #>   Peptostreptococcus anaerobius    26734     1     0 #>   Proteus mirabilis                26676    59     0 #>   Pseudomonas aeruginosa           26374   361     0 #>   Serratia marcescens              26693    42     0 #>   Staphylcoccus aureus             26365   370     0 #>   Streptococcus anginosus          26728     7     0 #>   Streptococcus pneumoniae         26582   153     0 #>   Streptococcus salivarius group   26730     5     0 #>   Stenotrophomonas maltophilia     26685    50     0 #>   Acinetobacter                    26720    15     0 #>   Aspergillus niger                26735     0     0 #>   Bacillus                         26729     6     0 #>   Candida albicans                 26705    30     0 #>   Candida glabrata                 26729     6     0 #>   Candida tropicalis               26729     6     0 #>   Coagulase negative staphylcoccus 26722    13     0 #>   Corynebacterium                  26713    22     0 #>   Enterococcus                     26730     5     0 #>   Gram positive coccus             26713    22     0 #>   Klebsiella                       26712    23     0 #>   Legionella pneumoniae            26733     2     0 #>   MRSA                             26728     7     0 #>   MSSA                             26734     1     0 #>   Moraxella catarrhalis            26673    62     0 #>   Mycobacterium tuberculosis       26728     7     0 #>   Pneumocytis jirovecii            26733     2     0 #>   Pseudomonas                      26656    79     0 #>   Pseudomonas fluorescens          26734     1     0 #>   Staphylcoccus                    26715    20     0 #>   Staphylococcus capitis           26687    48     0 #>   Staphylococcus epidermidis       26469   266     0 #>   Staphylococcus hominis           26578   157     0 #>   Streptococcus                    26716    19     0 #>   Streptococcus beta-hemolytic     26669    66     0 #>   Streptococcus pyogenes           26724    11     0 #>   Streptococcus viridans           26735     0     0 #>   Yeast                            26696    39     0 #>   Other                            26153   582     0 #>   <NA>                                 0     0     0 normMicro %>% filter(micro.test_performed==\"yes\") %>% select(micro.test_type, micro.pathogen) %>% unnest(micro.pathogen) %>% filter(detected==\"yes\") %>% group_by(pathogen, micro.test_type) %>%   count() %>% arrange(desc(n)) #> # A tibble: 193 × 3 #> # Groups:   pathogen, micro.test_type [193] #>    pathogen                   micro.test_type      n #>    <fct>                      <fct>            <int> #>  1 Candida                    Sputum             400 #>  2 Escherichia coli           Blood culture      325 #>  3 Other                      Blood culture      317 #>  4 Staphylococcus epidermidis Blood culture      257 #>  5 Haemophilus influenzae     Sputum             243 #>  6 Pseudomonas aeruginosa     Sputum             224 #>  7 Other                      Sputum             173 #>  8 Staphylcoccus aureus       Blood culture      167 #>  9 Staphylococcus hominis     Blood culture      155 #> 10 Candida                    Respiratory swab   130 #> # ℹ 183 more rows normVirol = rawData2 %>% normalise_data(instrument = \"virol\") #> Normalising data using: normalise.avoncap_export.central.virol #> using cached item: ~/.cache/avoncap/norm-b6f8ed1851f16d8282d50544e149e955-65996dd6886c9e5b1d979e11e427e856.rda  normVirol  %>% filter(virol.test_performed==\"yes\") %>% select(virol.pathogen) %>% unnest(virol.pathogen) %>% with(table(pathogen,detected,  useNA = \"always\")) #>                                          detected #> pathogen                                     no   yes  <NA> #>   Influenza A                             65749   632     0 #>   Influenza B                             66366    15     0 #>   RSV                                     66080   301     0 #>   Adenovirus                              66361    20     0 #>   Human Metapneumovirus                   66173   208     0 #>   Human Rhinovirus/Enterovirus            66030   351     0 #>   Parainfluenza Type 1                    66366    15     0 #>   Parainfluenza Type 2                    66372     9     0 #>   Parainfluenza Type 3                    66277   104     0 #>   Parainfluenza Type 4                    66357    24     0 #>   Covid-19                                52313 14068     0 #>   Other                                   66336    45     0 #>   Coronavirus 229E                        66380     1     0 #>   Coronavirus HKU1                        66379     2     0 #>   Coronavirus NL63                        66379     2     0 #>   Coronavirus OC43                        66377     4     0 #>   Middle East Respiratory Syndrome (MERS) 66381     0     0 #>   Bordetella parapertussis (IS1001)       66379     2     0 #>   Bordetella pertussis (ptxP)             66381     0     0 #>   Chlamydia pneumoniae                    66379     2     0 #>   Mycoplasma pneumoniae                   66381     0     0 #>   <NA>                                        0     0     0 normVirol %>% filter(virol.test_performed==\"yes\") %>% select(virol.test_type, virol.pathogen) %>% unnest(virol.pathogen) %>% filter(detected==\"yes\") %>%    # with(table(pathogen, virol.test_type,  useNA = \"always\")) %>%    group_by(pathogen, virol.test_type) %>%   count() %>% arrange(desc(n)) #> # A tibble: 50 × 3 #> # Groups:   pathogen, virol.test_type [50] #>    pathogen                     virol.test_type               n #>    <fct>                        <fct>                     <int> #>  1 Covid-19                     PCR - COVID only           8966 #>  2 Covid-19                     POCT Test (Abbott)         3818 #>  3 Covid-19                     Lateral Flow - COVID only   686 #>  4 Covid-19                     NA                          366 #>  5 Influenza A                  PCR - Respiratory panel     250 #>  6 Human Rhinovirus/Enterovirus PCR - Respiratory panel     235 #>  7 Influenza A                  Lateral Flow - COVID only   229 #>  8 RSV                          PCR - Respiratory panel     157 #>  9 Covid-19                     Viral Culture               147 #> 10 Influenza A                  NA                          143 #> # ℹ 40 more rows normRadio = rawData2 %>% normalise_data(instrument = \"radio\") #> Normalising data using: normalise.avoncap_export.central.radio #> using cached item: ~/.cache/avoncap/norm-ebbd016b214d0a4b408623ae4e2c8e3c-65996dd6886c9e5b1d979e11e427e856.rda  # old format tmp3  %>% filter(radio.test_performed==\"yes\") %>% with(table(radio.test_type, radio.lung_malignancy)) normRadio %>% filter(radio.test_performed==\"yes\") %>% select(radio.alrtd_finding) %>% unnest(radio.alrtd_finding) %>% with(table(finding,present,  useNA = \"always\")) #>                                   present #> finding                               no   yes  <NA> #>   Normal                           30521 22902     4 #>   Consistent with pneumonia        36505 16918     4 #>   Consistent with heart failure    48714  4709     4 #>   Consistent with pleural effusion 43089 10334     4 #>   Consistent with COVID-19         47232  6191     4 #>   Other abnormal finding           49727  3696     4 #>   <NA>                                 0     0     0 normRadio %>% filter(radio.test_performed==\"yes\") %>% select(radio.test_type, radio.non_alrtd_finding) %>% unnest(radio.non_alrtd_finding) %>% filter(present==\"yes\") %>% with(table(finding, radio.test_type,  useNA = \"always\")) #>                                        radio.test_type #> finding                                 CXR CT scan (CT thorax, CTPA, HRCT) #>   Pulmonary embolus                     178                             748 #>   Pneumothorax and/or pneumomediastinum 958                             179 #>   Cavity including abscesses             46                              34 #>   Aspergillioma                           1                               2 #>   Lung malignancy                       388                             327 #>   Lung nodules                          374                             474 #>   Tuberculosis (old or new)              11                               2 #>   Empyema                               132                             115 #>   <NA>                                    0                               0 #>                                        radio.test_type #> finding                                 US thorax MRI Other <NA> #>   Pulmonary embolus                             5   0    17    0 #>   Pneumothorax and/or pneumomediastinum         4   0     0    0 #>   Cavity including abscesses                    4   0     0    0 #>   Aspergillioma                                 0   0     0    0 #>   Lung malignancy                               1   0     2    0 #>   Lung nodules                                  2   0     1    0 #>   Tuberculosis (old or new)                     0   0     0    0 #>   Empyema                                       2   0     3    0 #>   <NA>                                          0   0     0    0 normHaem = rawData2 %>% normalise_data(instrument = \"haem\")  #> Normalising data using: normalise.avoncap_export.central.haem #> using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-bac1ba0bf95954527c63ff4673e6ef5a.rda augHaem = normHaem %>% augment_data() #> Augmenting data using: augment.avoncap_export.central.haem #> using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-9092aeb9b611bf6b30c9d87b89cab8f1.rda  augHaem %>% xglimpse(haem.troponin_level, haem.d_dimer_level) #>                   haem.troponin_level #> haem.d_dimer_level   ≤18   >18 Unknown #>            ≤0.5      351    64     319 #>            >0.5      951   621    1125 #>            Unknown  4056  5390   18083 augHaem %>% xglimpse(haem.crp_level, haem.white_cell_count_level) #>                            haem.crp_level #> haem.white_cell_count_level  <10 10-50  >50 Unknown #>                     ≤10     5009  6034 4905     318 #>                     >10     2586  4131 7521     139 #>                     Unknown   17    20   19     261  # x = augHaem %>% summary() # t(x)"},{"path":"/articles/web/avoncap.html","id":"augmenting-the-central-database","dir":"Articles > Web","previous_headings":"","what":"Augmenting the central database","title":"Getting started","text":"","code":"# devtools::load_all() augData2 = normData2 %>% avoncap::augment_data() #> Augmenting data using: augment.avoncap_export.central #> using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-12850dd824be250cff85eb25e095a158.rda  augData2 %>% xglimpse(admission.category,  admission.presentation_3_class) #>                               admission.category #> admission.presentation_3_class Confirmed SARS-CoV-2 No evidence SARS-CoV-2 #>               Pneumonia                        5187                   9580 #>               NP-LRTI                          4493                   6636 #>               No evidence LRTI                   67                      0 #>               <NA>                                0                      0 #>                               admission.category #> admission.presentation_3_class Non-infective <NA> #>               Pneumonia                    0    0 #>               NP-LRTI                      0    0 #>               No evidence LRTI          4997    0 #>               <NA>                         0 1164 augData2 %>% xglimpse(admission.covid_pcr_result,  admission.presentation_3_class) #>                               admission.covid_pcr_result #> admission.presentation_3_class SARS-CoV-2 PCR negative SARS-CoV-2 PCR positive #>               Pneumonia                           8933                    5126 #>               NP-LRTI                             6013                    4415 #>               No evidence LRTI                    4285                      51 #>               <NA>                                   0                       0 #>                               admission.covid_pcr_result #> admission.presentation_3_class <NA> #>               Pneumonia         708 #>               NP-LRTI           701 #>               No evidence LRTI  728 #>               <NA>             1164 augData2 %>% xglimpse(admission.infective_cause,  admission.presentation_3_class) #>                               admission.infective_cause #> admission.presentation_3_class Non-infective Infective  <NA> #>               Pneumonia                    0     14767     0 #>               NP-LRTI                      0     11129     0 #>               No evidence LRTI          4997        67     0 #>               <NA>                         0         0  1164 augData2 %>% xglimpse(admission.infective_cause,  admission.is_covid) #>                         admission.infective_cause #> admission.is_covid       Non-infective Infective  <NA> #>   Confirmed SARS-CoV-2               0      9747     0 #>   No evidence SARS-CoV-2          4997     16216     0 #>   <NA>                               0         0  1164  augData2 %>% xglimpse(admin.consent_withheld, admission.presentation_3_class) #>                               admin.consent_withheld #> admission.presentation_3_class    no   yes #>               Pneumonia        14767     0 #>               NP-LRTI          11129     0 #>               No evidence LRTI  5064     0 #>               <NA>                 0  1164"},{"path":"/articles/web/gp-data.html","id":"input-data-location","dir":"Articles > Web","previous_headings":"","what":"Input data location","title":"The primary care data set","text":"first level directories. Filenames need indication database year (either 20-21,21-22,… y1,y2,…)","code":"# The data input directory on my development machine: options(\"avoncap.input\" = \"~/Data/avoncap/\") avoncap::most_recent_files(\"avoncap-export\",\"gp\") #> # A tibble: 1 × 7 #>   filename directory      path           date       hospital study_year filetype #>   <chr>    <chr>          <fs::path>     <date>     <chr>         <int> <chr>    #> 1 gp       avoncap-export …-06-28/gp.csv 2023-06-28 NA               NA csv rawData = avoncap::load_data(\"avoncap-export\",\"gp\") #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-af71346b3abc76f77c18c3b9100f55f3.rda"},{"path":"/articles/web/longitudinal-pneumo.html","id":"data-loading","dir":"Articles > Web","previous_headings":"","what":"Data loading","title":"Pneumococcus longitudinal serotype data","text":"raw data expected nhs-extract subfolder","code":"rawPn = avoncap::load_data(\"nhs-extract\",\"pneumococcal\") #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-e7f5def26af13823d6fa3194a5398ec4.rda"},{"path":"/articles/web/longitudinal-pneumo.html","id":"data-normalisation","dir":"Articles > Web","previous_headings":"","what":"Data normalisation","title":"Pneumococcus longitudinal serotype data","text":"","code":"normPn = rawPn %>% normalise_data() #> Normalising data using: normalise.nhs_extract.pneumococcal #> Some columns expected in the mappings were not present: hb #> using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-061bef6892ac5e394efabaf301b1cadb.rda"},{"path":"/articles/web/longitudinal-pneumo.html","id":"augment-the-data","dir":"Articles > Web","previous_headings":"","what":"Augment the data","title":"Pneumococcus longitudinal serotype data","text":"Augmented IPD dataset format: admin.record_number: numeric admin.hospital: factor admin.patient_identifier: character demog.age: numeric demog.gender: factor pneumo.test_date: Date pneumo.test_type: factor pneumo.phe_serotype: factor demog.smoker: factor comorbid.no_resp_dx: factor comorbid.copd: factor comorbid.asthma: factor comorbid.bronchiectasis: factor comorbid.pulmonary_fibrosis: factor comorbid.resp_other: factor comorbid.no_heart_dx: factor comorbid.ccf: factor comorbid.ihd: factor comorbid.hypertension: factor comorbid.af: factor comorbid.other_heart_dx: factor comorbid.previous_mi: factor comorbid.ckd: factor comorbid.liver_disease: factor comorbid.diabetes: factor comorbid.diabetes_medications: factor comorbid.no_dementia: factor comorbid.dementia: factor comorbid.cognitive_impairment: factor comorbid.neuro_other: factor comorbid.cva: factor comorbid.tia: factor comorbid.hemiplegia: factor comorbid.paraplegia: factor comorbid.no_neuro_dx: factor comorbid.gastric_ulcers: factor comorbid.dysphagia: factor comorbid.periph_vasc_dx: factor comorbid.connective_tissue_dx: factor comorbid.immunodeficiency: factor comorbid.other_pneumococcal_risks: factor comorbid.no_HIV: factor comorbid.HIV: factor comorbid.AIDS: factor comorbid.solid_cancer: factor comorbid.no_haemotological_cancer: factor comorbid.leukaemia: factor comorbid.lymphoma: factor comorbid.recent_chemotherapy: factor comorbid.recent_radiotherapy: factor comorbid.transplant_recipient: factor comorbid.pregnancy: factor demog.no_drug_abuse: factor demog.alcohol_abuse: factor demog.ivdu_abuse: factor demog.marijuana_abuse: factor demog.other_inhaled_drug_abuse: factor admission.on_immunosuppression: factor comorbid.bmi_status: factor comorbid.influenza_infection: factor comorbid.hepatitis_c: factor vaccination.ppv23_vaccination: factor vaccination.flu: factor admission.charlson_comorbidity_index: numeric outcome.length_of_stay: numeric admission.triage_score: factor admission.respiratory_rate: numeric admission.saturations_on_room_air: numeric admission.systolic_bp: numeric admission.diastolic_bp: numeric admission.crb65: numeric admission.curb65: numeric outcome.antibiotic_route: factor outcome.antibiotic_duration: numeric admission.infection_site: factor outcome.abnormal_lft: factor outcome.acute_kidney_injury: factor outcome.pleural_effusion: factor outcome.empyema: factor outcome.discharge_to: factor outcome.admitted_icu: factor outcome.non_invasive_ventilation: factor outcome.intubation: factor outcome.recurrent_pneumonia: factor outcome.received_ecmo: factor outcome.received_ionotropes: factor outcome.tracheostomy: factor outcome.inpatient_death: factor outcome.death_within_30_days: factor outcome.death_within_1_year: factor outcome.survival_duration: numeric haem.albumin: numeric haem.white_cell_count: numeric haem.neutrophils: numeric haem.lymphocytes: numeric haem.crp: numeric haem.sodium: numeric haem.urea: numeric haem.egfr: numeric haem.creatinine: numeric radio.cxr_infection: factor radio.cxr_lobar_changes: factor outcome.death_within_5_years: factor outcome.5_yr_survival_duration: numeric demog.imd_decile: character key.admit: character","code":"augPn = normPn %>% augment_data() #> Augmenting data using: augment.nhs_extract.pneumococcal #> using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-6400b885f07f2a6e47574983965bb885.rda augPn %>% with(table(admission.infection_site, pneumo.test_type,useNA = \"always\")) #>                         pneumo.test_type #> admission.infection_site Blood culture only Binax only Blood culture and Binax #>         Lung                           6316       2017                    1458 #>         Meningitis                      443         46                      94 #>         Septic arthritis                129          5                      34 #>         ENT                              81          2                       0 #>         Myositis                          4          0                       0 #>         Otitis externa                    8          0                       0 #>         Abdominal                        16          1                       5 #>         Unclear/unknown                  19          0                       0 #>         Other                           136         13                       4 #>         <NA>                              0          0                       0 #>                         pneumo.test_type #> admission.infection_site CSF PCR Blood PCR <NA> #>         Lung                   0         0    0 #>         Meningitis             8         9    0 #>         Septic arthritis       0         0    0 #>         ENT                    0         0    0 #>         Myositis               0         0    0 #>         Otitis externa         0         0    0 #>         Abdominal              0         0    0 #>         Unclear/unknown        0         0    0 #>         Other                  0         2    0 #>         <NA>                   0         0    0"},{"path":"/articles/web/quality-assurance.html","id":"loading-and-normalising-the-central-database","dir":"Articles > Web","previous_headings":"","what":"loading and normalising the central database","title":"Quality assurance","text":"","code":"rawData2 = avoncap::load_data(\"avoncap-export\",\"central\", merge=TRUE) #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-fdb2cb11473acaa313a2e09bec23b8af.rda # without merge: currently: INCONSISTENT COLUMN(S) IN FILES: sars_cov2_antigen # due to the fact it is mostly a numeric but some values \">250\"  # devtools::load_all() normData2 = rawData2 %>% avoncap::validate_data() %>% avoncap::normalise_data() #> validate data using: validate.avoncap_export.central #> missing value in consented in 32 rows #> missing value in ppc in 32 rows #> missing value in include_patient in 35 rows #> missing value in hosp in 31 rows #> missing columns: ethnicity in 1 rows #> missing value in hr in 60 rows #> missing value in systolic_bp in 73 rows #> missing value in diastolic_bp in 76 rows #> missing value in temperature in 50 rows #> missing value in rr in 61 rows #> missing value in pulse_ox in 58 rows #> missing value in fio2 in 61 rows #> missing value in news_2_total in 32 rows #> missing value in crb_test_mai in 32 rows #> missing value in care_home in 32 rows #> missing value in ckd in 32 rows #> missing value in liver_disease in 32 rows #> missing value in diabetes in 32 rows #> missing value in gastric_ulcers in 32 rows #> missing value in pvd in 32 rows #> missing value in ctd in 32 rows #> missing value in immunodeficiency in 32 rows #> missing value in other_pn_disease in 37 rows #> missing value in cancer in 32 rows #> missing value in transplant in 32 rows #> missing value in smoking in 33 rows #> missing value in gender in 31 rows #> missing value in hospital_length_of_stay in 33 rows #> missing value in covid_19_diagnosis in 32 rows #> missing value in lrtd_30d_outcome in 32 rows #> missing value in week_number in 32 rows #> missing value in year in 136 rows #> missing value in highest_level_care_require in 33 rows #> missing value in ventilatory_support in 33 rows #> missing value in psi_class in 32 rows #> missing value in imd in 35 rows #> missing value in age_at_admission in 31 rows #> missing value in acute_illness in 31 rows #> missing value in covid19 in 31 rows #> missing value in clinical_radio_diagnosis in 31 rows #> missing value in fever2 in 31 rows #> missing value in pleurtic_cp in 32 rows #> missing value in cough2 in 31 rows #> missing value in sput_prod in 31 rows #> missing value in dyspnoea in 31 rows #> missing value in tachypnoea2 in 31 rows #> missing value in ausc_find in 31 rows #> missing value in radiologic in 31 rows #> missing value in symptom_days_preadmit in 45 rows #> missing value in resp_disease in 32 rows #> missing value in chd in 32 rows #> missing value in neurological_disease in 32 rows #> missing value in haem_malig in 32 rows #> missing value in final_soc_lrtd_diagnosis in 32 rows #> both pneumonia and NP-LRTI in final SOC dx in 4 rows #> missing value in dm_meds in 2 rows #> missing value in current in 3 rows #> Normalising data using: normalise.avoncap_export.central #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-9e78c8c6974b935c1f39481c79dad211.rda #> Admission date is derived from study week and hence approximate. #> Some columns expected in the mappings were not present: nhs_number, np_swab_3, adm_np_type_3, covidvax_date, covidvax_dose_2, covidvax_dose_3, covidvax_dose_4, covidvax_dose_5, covidvax_dose_6, flu_date, ppv23_date, previousinfection_date #> using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-d213773967e9e74bcb6577765d31e56a.rda failures = normData2 %>% avoncap::write_issues(\"~/avoncap-issues\") tmp = failures %>%      filter(.error_type %in% c(\"none checked in checkbox\",\"missing value\")) %>%      inner_join(rawData2, by=\"record_number\", suffix=c(\"\",\".raw\")) %>%     group_by(.variable) %>%     filter(       !is.na(enrollment_date) &       !is.na(hosp)     ) %>%     filter(       n()>20     )    ggplot(tmp, aes(x=enrollment_date, fill=as.factor(hosp)))+   geom_histogram(binwidth = 7)+   scale_x_date(date_breaks = \"1 month\", date_labels = \"%m-%Y\")+   theme(axis.text.x.bottom = element_text(angle = 90, vjust=0.5, hjust=1))+   facet_wrap(~.variable,scales = \"free_y\") normData2 = rawData2 %>%    avoncap::normalise_data(.nocache = TRUE) #> Normalising data using: normalise.avoncap_export.central #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-9e78c8c6974b935c1f39481c79dad211.rda #> Admission date is derived from study week and hence approximate. #> Some columns expected in the mappings were not present: nhs_number, np_swab_3, adm_np_type_3, covidvax_date, covidvax_dose_2, covidvax_dose_3, covidvax_dose_4, covidvax_dose_5, covidvax_dose_6, flu_date, ppv23_date, previousinfection_date #> caching item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-b34b6c3c49c213e41779c264053d07ca.rda #> mapping .consented to admin.consented #> mapping .ppc to admin.pp_consented #> mapping .withdrawal to admin.withdrawal #> mapping .consent_urine to admin.consent_for_urine #> mapping .consent_blood to admin.consent_for_blood #> mapping .consent_resp_samples1 to admin.consent_for_respiratory_samples #> mapping .record_number to admin.record_number #> mapping .what_was_the_first_surveil to admin.first_record_number #> mapping .ac_study_number to admin.consented_record_number #> the input data set does not have a nhs_number column (or column set) #> mapping .duplicate to admin.duplicate #> mapping .enrollment_date to admin.enrollment_date #> mapping .study_year to admin.study_year #> mapping .file to admin.data_file #> mapping .week_number to admin.week_number #> mapping .c19_diagnosis to diagnosis.standard_of_care_COVID_diagnosis #> mapping .clinical_radio_diagnosis to diagnosis.clinical_or_radiological_LRTI_or_pneumonia #> mapping .c19_adm_swab to diagnosis.admission_swab #> mapping .c19_test_type to diagnosis.test_type #> mapping .qualifying_symptoms_signs to diagnosis.qualifying_symptoms_signs #> mapping .cc_critieria to diagnosis.meets_case_control_criteria #> mapping .cc_pos_date to diagnosis.first_COVID_positive_swab_date #> mapping .gender to demog.gender #> mapping .age_at_admission to demog.age #> mapping .age_march to demog.age_in_march_2021 #> mapping .imd to demog.imd_decile #> mapping .smoking to demog.smoker #> mapping .ethnicity2 to demog.ethnicity #> mapping .care_home to demog.care_home_resident #> mapping .drugs___1 to demog.no_drug_abuse #> mapping .drugs___2 to demog.alcohol_abuse #> mapping .drugs___3 to demog.ivdu_abuse #> mapping .drugs___4 to demog.marijuana_abuse #> mapping .drugs___5 to demog.other_inhaled_drug_abuse #> mapping .vaping to demog.vaping #> mapping .alc_units to demog.units_of_alcohol #> mapping .np_swab to admin.np_swab_taken_1 #> mapping .adm_np_type to admin.np_swab_site_1 #> mapping .np_date to admin.np_swab_date_1 #> mapping .days_adm_npswab to admin.np_swab_day_since_admission #> mapping .np_swab_2 to admin.np_swab_taken_2 #> mapping .adm_np_type_2 to admin.np_swab_site_2 #> mapping .np_date_2 to admin.np_swab_date_2 #> the input data set does not have a np_swab_3 column (or column set) #> the input data set does not have a adm_np_type_3 column (or column set) #> mapping .np_date_3 to admin.np_swab_date_3 #> mapping .saliva to admin.saliva_sample_taken #> mapping .saliva_date to admin.saliva_sample_date #> mapping .days_adm_saliva to admin.saliva_sample_day_since_admission #> mapping .sputum to admin.sputum_sample_taken #> mapping .sputum_date to admin.sputum_sample_date #> mapping .days_adm_sputum to admin.sputum_sample_day_since_admission #> mapping .pt_ad_ur to admin.urine_sample_needed #> mapping .adm_ur_taken to admin.urine_sample_taken #> mapping .nourine_reason to admin.urine_sample_failure_reason #> the input data set does not have a adm_np_type_2 column (or column set) #> mapping .adm_ur_date to admin.urine_sample_date #> mapping .days_adm_urine to admin.urine_sample_day_since_admission #> mapping .adm_serum_tak to admin.serum_sample_taken #> mapping .adm_seru_date to admin.serum_sample_date #> mapping .days_adm_serum to admin.serum_sample_day_since_admission #> mapping .contraindication to vaccination.covid_vaccine_contraindicated #> mapping .covid19_vax to vaccination.covid_vaccination #> the input data set does not have a covidvax_date column (or column set) #> the input data set does not have a covidvax_dose_2 column (or column set) #> the input data set does not have a covidvax_dose_3 column (or column set) #> the input data set does not have a covidvax_dose_4 column (or column set) #> the input data set does not have a covidvax_dose_5 column (or column set) #> the input data set does not have a covidvax_dose_6 column (or column set) #> mapping .brand_of_covid19_vaccinati to vaccination.first_dose_brand #> mapping .covid19vax_brand_2 to vaccination.second_dose_brand #> mapping .covid19vax_brand_3 to vaccination.third_dose_brand #> mapping .covid19vax_brand_4 to vaccination.fourth_dose_brand #> mapping .covid19vax_brand_5 to vaccination.fifth_dose_brand #> mapping .covid19vax_brand_6 to vaccination.sixth_dose_brand #> mapping .c19vaxd1_adm to admission.time_since_first_vaccine_dose #> mapping .c19vaxd2_adm to admission.time_since_second_vaccine_dose #> mapping .c19vaxd3_adm to admission.time_since_third_vaccine_dose #> mapping .c19vaxd4_adm to admission.time_since_fourth_vaccine_dose #> mapping .c19vax5_adm to admission.time_since_fifth_vaccine_dose #> mapping .c19vax6_adm to admission.time_since_sixth_vaccine_dose #> the input data set does not have a flu_date column (or column set) #> mapping .fluvax_adm_d1 to admission.time_since_last_flu_vaccine_dose #> the input data set does not have a ppv23_date column (or column set) #> mapping .ppv23vax_adm_d to admission.time_since_last_pneumococcal_vaccine_dose #> mapping .c19_variant to genomic.variant #> mapping .year to admission.year #> mapping .study_week to admission.study_week #> mapping .admission_date to admission.date #> mapping .hospital to admin.hospital #> mapping .adm_diagnosis___1 to admission.presumed_CAP_radiologically_confirmed #> mapping .adm_diagnosis___2 to admission.presumed_CAP_clinically_confirmed #> mapping .adm_diagnosis___3 to admission.presumed_CAP_no_radiology #> mapping .adm_diagnosis___4 to admission.presumed_LRTI #> mapping .adm_diagnosis___5 to admission.presumed_Empyema_or_abscess #> mapping .adm_diagnosis___6 to admission.presumed_exacerbation_COPD #> mapping .adm_diagnosis___7 to admission.presumed_exacerbation_non_COPD #> mapping .adm_diagnosis___8 to admission.presumed_congestive_heart_failure #> mapping .adm_diagnosis___9 to admission.presumed_non_infectious_process #> mapping .adm_diagnosis___10 to admission.presumed_non_LRTI #> mapping .ics to admission.on_inhaled_corticosteroids #> mapping .immsup to admission.on_immunosuppression #> mapping .psi_class to admission.pneumonia_severity_index_class #> mapping .crb_test_mai to admission.curb_65_severity_score #> mapping .news_2_total to admission.news2_score #> mapping .pulse_ox to admission.oximetry #> mapping .rr to admission.respiratory_rate #> mapping .fio2 to admission.max_oxygen #> mapping .systolic_bp to admission.systolic_bp #> mapping .diastolic_bp to admission.diastolic_bp #> mapping .hr to admission.heart_rate #> mapping .temperature to admission.temperature #> mapping .symptom_days_preadmit to admission.duration_symptoms #> mapping .previous_infection to admission.previous_covid_infection #> the input data set does not have a previousinfection_date column (or column set) #> mapping .c19d_preadm to admission.time_since_covid_diagnosis #> mapping .rockwood to admission.rockwood_score #> mapping .cci_total_score to admission.charlson_comorbidity_index #> mapping .height to admission.height #> mapping .weight to admission.weight #> mapping .bmi to admission.BMI #> mapping .first_radio___1 to admission.cxr_normal #> mapping .first_radio___2 to admission.cxr_pneumonia #> mapping .first_radio___3 to admission.cxr_heart_failure #> mapping .first_radio___4 to admission.cxr_pleural_effusion #> mapping .first_radio___5 to admission.cxr_covid_changes #> mapping .first_radio___6 to admission.cxr_other #> mapping .c19_peep to day_7.max_peep #> mapping .c19_hospadm to day_7.length_of_stay #> mapping .c17_high to day_7.max_care_level #> mapping .c19icuon to day_7.still_on_icu #> mapping .c19_icudays to day_7.icu_length_of_stay #> mapping .c19_vent to day_7.max_ventilation_level #> mapping .c19_ox to day_7.max_o2_level #> mapping .c19_ionotropes to day_7.ionotropes_needed #> mapping .c19_complication___1 to day_7.PE #> mapping .c19_complication___2 to day_7.DVT #> mapping .c19_complication___3 to day_7.ARF #> mapping .c19_complication___4 to day_7.NSTEMI #> mapping .c19_complication___5 to day_7.STEMI #> mapping .c19_complication___6 to day_7.cardiac_failure #> mapping .c19_complication___7 to day_7.new_AF #> mapping .c19_complication___8 to day_7.new_other_arrythmia #> mapping .c19_complication___9 to day_7.inpatient_fall #> mapping .c19_complication___10 to day_7.other_complication #> mapping .c19_complication___11 to day_7.no_complication #> mapping .c19_death7d to day_7.death #> mapping .c19_meds___1 to treatment.dexamethasone #> mapping .c19_meds___2 to treatment.remdesevir #> mapping .c19_meds___3 to treatment.tocilizumab #> mapping .c19_meds___4 to treatment.sarilumab #> mapping .c19_meds___5 to treatment.in_drug_trial #> mapping .c19_meds___6 to treatment.no_drug_treatment #> mapping .c19_meds___7 to treatment.sotrovimab #> mapping .hospital_length_of_stay to outcome.length_of_stay #> mapping .survival_days to outcome.survival_duration #> mapping .ip_death to outcome.inpatient_death #> mapping .days_in_icu to outcome.icu_duration #> mapping .did_the_patient_have_respi to outcome.respiratory_support_needed #> mapping .number_of_days_of_ventilat to outcome.ventilator_duration #> mapping .ett_days to outcome.endotracheal_tube_duration #> mapping .renal_replacement_therapy to outcome.renal_support_duration #> mapping .complications___1 to outcome.acute_renal_failure #> mapping .complications___2 to outcome.liver_dysfunction #> mapping .complications___3 to outcome.hospital_acquired_infection #> mapping .complications___4 to outcome.acute_respiratory_distress_syndrome #> mapping .complications___5 to outcome.NSTEMI #> mapping .complications___6 to outcome.STEMI #> mapping .complications___7 to outcome.new_AF #> mapping .complications___8 to outcome.new_other_arrhthmia #> mapping .complications___9 to outcome.stroke #> mapping .complications___10 to outcome.DVT #> mapping .complications___11 to outcome.PE #> mapping .complications___12 to outcome.heart_failure #> mapping .complications___13 to outcome.fall_in_hospital #> mapping .complications___14 to outcome.reduced_mobility #> mapping .complications___15 to outcome.increasing_care_requirement #> mapping .complications___16 to outcome.no_complications #> mapping .ventilatory_support to outcome.highest_level_ventilatory_support #> mapping .did_the_patient_receive_ec to outcome.received_ecmo #> mapping .inotropic_support_required to outcome.received_ionotropes #> mapping .lrtd_30d_outcome to outcome.functional_status #> mapping .fever2 to symptom.abnormal_temperature #> mapping .pleurtic_cp to symptom.pleuritic_chest_pain #> mapping .cough2 to symptom.cough #> mapping .sput_prod to symptom.productive_sputum #> mapping .dyspnoea to symptom.dyspnoea #> mapping .tachypnoea2 to symptom.tachypnoea #> mapping .anosmia to symptom.anosmia #> mapping .ageusia to symptom.ageusia #> mapping .dysgeusia to symptom.dysguesia #> mapping .fever to symptom.fever #> mapping .hypothermia to symptom.hypothermia #> mapping .chills to symptom.chills #> mapping .headache to symptom.headache #> mapping .malaise to symptom.malaise #> mapping .wheeze to symptom.wheeze #> mapping .myalgia to symptom.myalgia #> mapping .worse_confusion to symptom.worsening_confusion #> mapping .general_det to symptom.general_deterioration #> mapping .ox_on_admission to symptom.oxygen_required_on_admission #> mapping .resp_disease___1 to comorbid.no_resp_dx #> mapping .resp_disease___2 to comorbid.copd #> mapping .resp_disease___3 to comorbid.asthma #> mapping .resp_disease___4 to comorbid.resp_other #> mapping .other_respiratory_disease___1 to comorbid.bronchiectasis #> mapping .other_respiratory_disease___2 to comorbid.interstitial_lung_dx #> mapping .other_respiratory_disease___3 to comorbid.cystic_fibrosis #> mapping .other_respiratory_disease___4 to comorbid.pulmonary_hypertension #> mapping .other_respiratory_disease___5 to comorbid.chronic_pleural_dx #> mapping .other_respiratory_disease___6 to comorbid.other_chronic_resp_dx #> mapping .chd___1 to comorbid.no_heart_dx #> mapping .chd___2 to comorbid.ccf #> mapping .chd___3 to comorbid.ihd #> mapping .chd___4 to comorbid.hypertension #> mapping .chd___5 to comorbid.other_heart_dx #> mapping .mi to comorbid.previous_mi #> mapping .other_chd___1 to comorbid.congenital_heart_dx #> mapping .other_chd___2 to comorbid.af #> mapping .other_chd___3 to comorbid.other_arrythmia #> mapping .other_chd___4 to comorbid.pacemaker #> mapping .other_chd___5 to comorbid.valvular_heart_dx #> mapping .other_chd___6 to comorbid.other_other_heart_dx #> mapping .diabetes to comorbid.diabetes #> mapping .dm_meds to comorbid.diabetes_medications #> mapping .neurological_disease___1 to comorbid.neuro_other #> mapping .neurological_disease___2 to comorbid.cva #> mapping .neurological_disease___3 to comorbid.tia #> mapping .neurological_disease___4 to comorbid.hemiplegia #> mapping .neurological_disease___5 to comorbid.paraplegia #> mapping .neurological_disease___6 to comorbid.no_neuro_dx #> mapping .dementia___1 to comorbid.no_dementia #> mapping .dementia___2 to comorbid.dementia #> mapping .dementia___3 to comorbid.cognitive_impairment #> mapping .cancer to comorbid.solid_cancer #> mapping .haem_malig___1 to comorbid.no_haemotological_cancer #> mapping .haem_malig___2 to comorbid.leukaemia #> mapping .haem_malig___3 to comorbid.lymphoma #> mapping .ckd to comorbid.ckd #> mapping .liver_disease to comorbid.liver_disease #> mapping .gastric_ulcers to comorbid.gastric_ulcers #> mapping .pvd to comorbid.periph_vasc_dx #> mapping .ctd to comorbid.connective_tissue_dx #> mapping .immunodeficiency to comorbid.immunodeficiency #> mapping .other_pn_disease to comorbid.other_pneumococcal_risks #> mapping .transplant to comorbid.transplant_recipient #> mapping .pregnancy to comorbid.pregnancy #> mapping .hiv___1 to comorbid.no_HIV #> mapping .hiv___2 to comorbid.HIV #> mapping .hiv___3 to comorbid.AIDS #> mapping .final_soc_lrtd_diagnosis___1 to diagnosis.SOC_CAP_radiologically_confirmed #> mapping .final_soc_lrtd_diagnosis___2 to diagnosis.SOC_CAP_clinically_confirmed #> mapping .final_soc_lrtd_diagnosis___3 to diagnosis.SOC_CAP_no_radiology #> mapping .final_soc_lrtd_diagnosis___4 to diagnosis.SOC_LRTI #> mapping .final_soc_lrtd_diagnosis___5 to diagnosis.SOC_Empyema_or_abscess #> mapping .final_soc_lrtd_diagnosis___6 to diagnosis.SOC_exacerbation_COPD #> mapping .final_soc_lrtd_diagnosis___7 to diagnosis.SOC_exacerbation_non_COPD #> mapping .final_soc_lrtd_diagnosis___8 to diagnosis.SOC_congestive_heart_failure #> mapping .final_soc_lrtd_diagnosis___9 to diagnosis.SOC_non_infectious_process #> mapping .final_soc_lrtd_diagnosis___10 to diagnosis.SOC_non_LRTI #> mapping .covid_19_diagnosis to diagnosis.covid_19_diagnosis #> mapping .ppv23 to vaccination.pneumovax #> mapping .flu_vaccine to vaccination.influenza_vaccination #> Mapped 265 columns #> Did not map 3483 columns  augData2 = normData2 %>% avoncap::augment_data(.nocache = TRUE) #> Augmenting data using: augment.avoncap_export.central #> caching item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-697aa50a7c5fe0221a7e3f289c2664b5.rda #> Created demog.age_category, demog.age_eligible, admission.cci_category, admission.rockwood_category, admission.curb_65_category using: demog.age, admission.charlson_comorbidity_index, admission.rockwood_score, admission.curb_65_severity_score #> Created admin.patient_identifier using: admin.first_record_number, admin.record_number #> Created admission.episode, admission.interval using: admission.date #> Created comorbid.diabetes_type, comorbid.solid_cancer_present, comorbid.haemotological_cancer_present, comorbid.any_cancer_present, comorbid.any_chronic_lung_disease, comorbid.any_chronic_heart_disease, comorbid.cva_or_tia using: comorbid.diabetes, comorbid.solid_cancer, comorbid.leukaemia, comorbid.lymphoma, comorbid.no_haemotological_cancer, comorbid.asthma, comorbid.bronchiectasis, comorbid.chronic_pleural_dx, comorbid.copd, comorbid.interstitial_lung_dx, comorbid.cystic_fibrosis, comorbid.other_chronic_resp_dx, comorbid.pulmonary_hypertension, comorbid.ccf, comorbid.ihd, comorbid.previous_mi, comorbid.congenital_heart_dx, comorbid.hypertension, comorbid.af, comorbid.other_arrythmia, comorbid.other_heart_dx, comorbid.other_other_heart_dx, comorbid.cva, comorbid.tia #> Created admission.covid_pcr_result, admission.is_covid using: diagnosis.covid_19_diagnosis, diagnosis.admission_swab, diagnosis.test_type #> Created admission.initial_presentation_3_class using: admission.presumed_CAP_clinically_confirmed, admission.presumed_CAP_radiologically_confirmed, admission.presumed_CAP_no_radiology, admission.presumed_Empyema_or_abscess, admission.presumed_LRTI, admission.presumed_exacerbation_COPD, admission.presumed_exacerbation_non_COPD, admission.presumed_congestive_heart_failure #> Created diagnosis.pneumonia, diagnosis.LRTI, diagnosis.exacerbation_of_chronic_respiratory_disease, diagnosis.heart_failure using: diagnosis.SOC_CAP_clinically_confirmed, diagnosis.SOC_CAP_radiologically_confirmed, diagnosis.SOC_CAP_no_radiology, diagnosis.SOC_Empyema_or_abscess, admission.cxr_pneumonia, diagnosis.SOC_LRTI, diagnosis.SOC_exacerbation_COPD, diagnosis.SOC_exacerbation_non_COPD, diagnosis.SOC_congestive_heart_failure #> Created admission.infective_cause using: diagnosis.SOC_non_infectious_process, diagnosis.SOC_non_LRTI #> Created admission.category, admission.presentation_3_class using: #> Created diagnosis.infection_context using: diagnosis.first_COVID_positive_swab_date, admission.date #> Created genomic.variant_inferred using: genomic.variant, admission.date #> Created symptom_onset.date_of_symptoms, symptom_onset.time_of_symptoms_since_first_vaccine_dose, symptom_onset.time_of_symptoms_since_second_vaccine_dose, symptom_onset.time_of_symptoms_since_third_vaccine_dose, symptom_onset.time_of_symptoms_since_fourth_vaccine_dose, vaccination.dose_interval, vaccination.booster_interval, vaccination.second_booster_interval using: admission.date, admission.duration_symptoms, admission.time_since_first_vaccine_dose, admission.time_since_second_vaccine_dose, admission.time_since_third_vaccine_dose, admission.time_since_fourth_vaccine_dose #> Created vaccination.protection using: vaccination.covid_vaccination, admission.time_since_fourth_vaccine_dose, admission.duration_symptoms, admission.time_since_third_vaccine_dose, admission.time_since_second_vaccine_dose, admission.time_since_first_vaccine_dose, admission.previous_covid_infection #> Created vaccination.vaccination using: vaccination.covid_vaccination, admission.time_since_sixth_vaccine_dose, admission.duration_symptoms, admission.time_since_fifth_vaccine_dose, admission.time_since_fourth_vaccine_dose, admission.time_since_third_vaccine_dose, admission.time_since_second_vaccine_dose, admission.time_since_first_vaccine_dose #> Created vaccination.brand_combination using: vaccination.first_dose_brand, vaccination.second_dose_brand, vaccination.third_dose_brand #> Created pneumo.presentation_CAP, pneumo.presentation_RAD, pneumo.presentation_class using: diagnosis.SOC_CAP_radiologically_confirmed #> Created admission.pneumococcal_high_risk using: demog.age, comorbid.other_pneumococcal_risks, comorbid.copd, comorbid.interstitial_lung_dx, comorbid.cystic_fibrosis, comorbid.hypertension, comorbid.ccf, comorbid.ihd, comorbid.ckd, comorbid.liver_disease, comorbid.diabetes, comorbid.immunodeficiency, comorbid.asthma, admission.on_immunosuppression #> Created admission.pneumococcal_risk_classification using: comorbid.cva, comorbid.immunodeficiency, comorbid.leukaemia, comorbid.lymphoma, comorbid.no_haemotological_cancer, admission.on_immunosuppression, comorbid.transplant_recipient, comorbid.ckd, comorbid.HIV, comorbid.solid_cancer, demog.care_home_resident, demog.smoker, demog.age, demog.alcohol_abuse, comorbid.diabetes, comorbid.diabetes_medications, comorbid.paraplegia, comorbid.copd, comorbid.interstitial_lung_dx, comorbid.cystic_fibrosis, comorbid.asthma, comorbid.liver_disease, comorbid.ccf, comorbid.ihd, comorbid.other_pneumococcal_risks #> Created day_7.WHO_clinical_progression, outcome.WHO_clinical_progression using: day_7.death, day_7.max_ventilation_level, day_7.ionotropes_needed, day_7.max_o2_level, outcome.survival_duration, outcome.functional_status, outcome.highest_level_ventilatory_support, outcome.received_ionotropes, outcome.respiratory_support_needed #> Created outcome.icu_admission, outcome.death_within_30_days, outcome.death_during_follow_up using: outcome.icu_duration, day_7.death, outcome.survival_duration, outcome.inpatient_death, outcome.functional_status #> Created day_7.max_o2_gt_28, day_7.max_o2_gt_35, day_7.max_o2_gt_50, day_7.WHO_score_gt_6, day_7.WHO_score_gt_5, day_7.los_gt_3, day_7.los_gt_5, day_7.los_gt_7 using: day_7.max_o2_level, day_7.length_of_stay, outcome.survival_duration avoncap::find_new_field_names(normData2, \"adm_diagnosis\") #>                                 adm_diagnosis___1  #> \"admission.presumed_CAP_radiologically_confirmed\"  #>                                 adm_diagnosis___2  #>     \"admission.presumed_CAP_clinically_confirmed\"  #>                                 adm_diagnosis___3  #>             \"admission.presumed_CAP_no_radiology\"  #>                                 adm_diagnosis___4  #>                         \"admission.presumed_LRTI\"  #>                                 adm_diagnosis___5  #>           \"admission.presumed_Empyema_or_abscess\"  #>                                 adm_diagnosis___6  #>            \"admission.presumed_exacerbation_COPD\"  #>                                 adm_diagnosis___7  #>        \"admission.presumed_exacerbation_non_COPD\"  #>                                 adm_diagnosis___8  #>     \"admission.presumed_congestive_heart_failure\"  #>                                 adm_diagnosis___9  #>       \"admission.presumed_non_infectious_process\"  #>                                adm_diagnosis___10  #>                     \"admission.presumed_non_LRTI\""},{"path":"/articles/web/uad-data.html","id":"data-loading","dir":"Articles > Web","previous_headings":"","what":"Data loading","title":"Pneumococcus urinary antigen data","text":"raw data expected urine-antigens subfolder data distributed single file cases controls together without distinguishing features. BinaxNOW serotype specific UAD tests results. tests run every person.","code":"fs::dir_tree(path = avoncap::input(\"urine-antigens\")) #> /home/vp22681/Data/avoncap/urine-antigens #> ├── 2022-09-15 #> │   └── uad-cases.csv #> ├── 2023-05-15 #> │   ├── gp-cases.csv #> │   └── uad-cases.csv #> ├── B1851202_SAP V1.0-27Sep2021_Final.pdf #> ├── README.md #> └── Table Template Serotype Distribution Scientific Affairs Proposal_FINAL.docx most_recent_files(\"urine-antigens\") #> # A tibble: 2 × 7 #>   filename  directory      path          date       hospital study_year filetype #>   <chr>     <chr>          <fs::path>    <date>     <chr>         <int> <chr>    #> 1 gp-cases  urine-antigens …gp-cases.csv 2023-05-15 NA               NA csv      #> 2 uad-cases urine-antigens …ad-cases.csv 2023-05-15 NA               NA csv rawUA = load_data(\"urine-antigens\") #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-a34df7f73813316db44634d7c8101b95.rda"},{"path":"/articles/web/uad-data.html","id":"data-normalisation","dir":"Articles > Web","previous_headings":"","what":"Data normalisation","title":"Pneumococcus urinary antigen data","text":"data can subdivided serotype versus binax groups normalisation handles processing serotype format ^[0-9]+[-Z]$, aligning format patient identifier match [0-9]{4}-[0-9]+. processing test dates (supplied %e-%b-%y format). normalised UAD data individual serotype specific tests results nested column. single BinaxNOW result nested. Results keyed surveillance number (admission episode identifier) test data. UAD format: admin.consented_record_number: character pneumo.test_date: Date key.consent: character key.sample: character pneumo.urine_antigen: list BinaxNOW format: pneumo.binax_result: factor pneumo.test_date: Date admin.consented_record_number: character pneumo.urine_antigen_sample_id: character key.consent: character key.sample: character","code":"normUA = rawUA %>% normalise_data(instrument = \"serotype\", .nocache=TRUE) #> Normalising data using: normalise.urine_antigens.serotype #> caching item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-47db867bf7ce62827001276c41513ee8.rda #> mapping .RESULT to pneumo.urine_antigen_result #> mapping .EVENT_DATE to pneumo.test_date #> mapping .ANALYSIS to pneumo.urine_antigen_test #> mapping .SUBJECT to admin.consented_record_number #> mapping .BARCODE to pneumo.urine_antigen_sample_id #> Mapped 5 columns #> Did not map 23 columns normBinax = rawUA %>% normalise_data(instrument = \"binax\", .nocache=TRUE) #> Normalising data using: normalise.urine_antigens.binax #> caching item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-980aa36f9ff48c370b7f834c5f4955bc.rda #> mapping .RESULT to pneumo.binax_result #> mapping .EVENT_DATE to pneumo.test_date #> mapping .SUBJECT to admin.consented_record_number #> mapping .BARCODE to pneumo.urine_antigen_sample_id #> Mapped 4 columns #> Did not map 24 columns"},{"path":"/articles/web/uad-data.html","id":"data-augmentation","dir":"Articles > Web","previous_headings":"","what":"Data augmentation","title":"Pneumococcus urinary antigen data","text":"UAD results commonly want know following: serotype testing complete serotypes? whole UAD panel positive serotype, many? UAD1 panel positive? UAD2? UAD positive PCV vaccine covered serotype? BINAX results real addition qeustions relevant","code":"augUA = normUA %>% augment_data() #> Augmenting data using: augment.urine_antigens.serotype #> using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-6e6fd7c403bfa3774af1a9a6712c5f13.rda   # augUA %>% filter(pneumo.serotype_results_complete) %>%  #   group_by(pneumo.serotype_summary_result) %>%  #   count() #  # augUA %>% unnest(pneumo.pcv_group) %>% with(table(group,result)) #  # ggplot( #   augUA %>% unnest(pneumo.pcv_group) %>%  #     inner_join(avoncap::serotype_data$names, by=c(\"group\"=\"label\")) %>% #     filter(indent==2, result == \"Positive\"), aes(x=group))+ #   geom_histogram(stat=\"count\")"},{"path":"/articles/web/uad-data.html","id":"common-operations","dir":"Articles > Web","previous_headings":"","what":"Common operations","title":"Pneumococcus urinary antigen data","text":"Find ","code":"# normUA %>% unnest(pneumo.urine_antigen) %>% group_by(result) %>% count() # ggplot(normUA %>% unnest(pneumo.urine_antigen) %>% filter(result == \"Positive\"), aes(x=test))+geom_histogram(stat=\"count\") # normBinax %>% group_by(pneumo.binax_result) %>% count() tmp = augUA %>% derive_pcv_groupings(pcv_map = avoncap::uad_pcv_map, col_name = pcv_custom) %>% glimpse() #> Rows: 4,077 #> Columns: 13 #> $ admin.consented_record_number    <chr> \"1001-00045\", \"1001-00057\", \"1001-000… #> $ pneumo.test_date                 <date> 2020-11-06, 2021-02-04, 2021-02-04, … #> $ key.consent                      <chr> \"1001-00045\", \"1001-00057\", \"1001-000… #> $ key.sample                       <chr> \"1001-00045-2020-11-06\", \"1001-00057-… #> $ pneumo.urine_antigen             <list> [<tbl_df[24 x 3]>], [<tbl_df[24 x 3]… #> $ pneumo.pcv_group                 <list> [<tbl_df[38 x 2]>], [<tbl_df[38 x 2]… #> $ pneumo.non_uad_panel_result      <fct> Unknown, Unknown, Unknown, Unknown, U… #> $ pneumo.uad1_panel_result         <fct> Negative, Negative, Negative, Negativ… #> $ pneumo.uad2_panel_result         <fct> Negative, Negative, Negative, Negativ… #> $ pneumo.serotype_summary_result   <fct> Negative, Negative, Negative, Negativ… #> $ pneumo.serotype_positive_count   <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0… #> $ pneumo.serotype_results_complete <lgl> TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T… #> $ pcv_custom                       <list> [<tbl_df[38 x 2]>], [<tbl_df[38 x 2]… tmp %>% unnest(pcv_custom) %>% with(table(group,result)) #>                                     result #> group                                Negative Positive Other Unknown #>   PCV7 (plus 9A,18A/B/F,23B)             4002       43    26       6 #>   PCV13 (plus 9A,18A/B/F,23B,6C)         3907      131    33       6 #>   PCV15 (plus 9A,18A/B/F,23B,6C)         3864      153    44      16 #>   PCV20 (plus 9A,18A/B/F,23B,6C,15C)     3740      268    53      16 #>   PPV23 (plus 9A,18A/B/F,23B,15C)        3727      280    54      16 #>   PCV10 (Serum Study Institute)          3953       85    33       6 #>   PCV10 (GSK)                            3953       85    33       6 #>   PCV15 (Zhifei)                         3896      132    33      16 #>   PCV24 (Vaxcyte)                        3711      296    54      16 #>   PCV24 (Affinivax)                      3711      296    54      16 #>   Additional PCV13 on 7 (plus 6C)        3949       89    33       6 #>   Additional PCV15 on 13                 4008       24    33      12 #>   Additional PCV20 on 15 (plus 15C)      3895      124    46      12 #>   Additional PPV23 on PCV20              4028       29     8      12 #>   4                                      4040       11    20       6 #>   6B                                     4051        0    20       6 #>   9V+A                                   4050        1    20       6 #>   14                                     4037       11    23       6 #>   18C+A/B/F                              4048        1    23       5 #>   19F                                    4048        3    20       6 #>   23F+B                                  4031       17    23       6 #>   1                                      4037        9    25       6 #>   3                                      4025       26    20       6 #>   5                                      4046        3    22       6 #>   6A+C                                   4032       17    22       6 #>   7F                                     4011       33    28       5 #>   19A                                    4044        6    21       6 #>   22F                                    4029       13    23      12 #>   33F                                    4030       11    24      12 #>   8                                      3931       97    37      12 #>   10A                                    4021       16    28      12 #>   11A                                    4053        9     3      12 #>   12F                                    4061        0     4      12 #>   15B+C                                  4058        3     4      12 #>   2                                      4060        1     4      12 #>   9N                                     4050       11     4      12 #>   17F                                    4048       12     5      12 #>   20                                     4056        5     4      12 #>   Other                                     0        0     0       0"},{"path":"/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Rob Challen. Author, maintainer.","code":""},{"path":"/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Challen R (2023). avoncap: AvonCap Study Analysis. R package version 0.0.0.9004.","code":"@Manual{,   title = {avoncap: AvonCap Study Analysis},   author = {Rob Challen},   year = {2023},   note = {R package version 0.0.0.9004}, }"},{"path":"/index.html","id":"avoncap-functions-for-manipulating-and-analysing-the-avoncap-study-data","dir":"","previous_headings":"","what":"AvonCap Study Analysis","title":"AvonCap Study Analysis","text":"development status package, designed support AvonCap publications never submitted CRAN. continuous revision use stable releases recommended","code":""},{"path":"/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"AvonCap Study Analysis","text":"package hosted Bristol Vaccine Centre r-universe. Installation follows: Installation can performed devtools:","code":"options(repos = c(   \"bristol-vaccine-centre\" = 'https://https://bristol-vaccine-centre.r-universe.dev/',   CRAN = 'https://cloud.r-project.org'))  # Download and install tableone in R install.packages(\"avoncap\") install.packages(\"devtools\") devtools::install_github(\"bristol-vaccine-centre/avoncap\")  # recommended to use a stable release version such as: devtools::install_github(\"bristol-vaccine-centre/avoncap@0.0.0.9000\")"},{"path":"/reference/all_files.html","id":null,"dir":"Reference","previous_headings":"","what":"Scans the input directory and returns csv or xlsx files in that directory — all_files","title":"Scans the input directory and returns csv or xlsx files in that directory — all_files","text":"Extracting metadata filename present - particularly hospital, year number","code":""},{"path":"/reference/all_files.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Scans the input directory and returns csv or xlsx files in that directory — all_files","text":"","code":"all_files()"},{"path":"/reference/all_files.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Scans the input directory and returns csv or xlsx files in that directory — all_files","text":"dataframe containing filename, path, date, hospital, study_year fields","code":""},{"path":"/reference/augment_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Sanitise AvonCap data columns — augment_data","title":"Sanitise AvonCap data columns — augment_data","text":"AvonCap data lots columns named difficult remember fashion, composed data items enumerated values semantics. makes displaying difficult filtering done raw data inscrutable. Depending source data different columns may present due differences NHS UoB data sets. redcap database options may checklists radio buttons, end mysterious names data.","code":""},{"path":"/reference/augment_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sanitise AvonCap data columns — augment_data","text":"","code":"augment_data(x, ...)"},{"path":"/reference/augment_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Sanitise AvonCap data columns — augment_data","text":"x raw data load_data() ... Arguments passed augment_generic df data frame","code":""},{"path":"/reference/augment_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Sanitise AvonCap data columns — augment_data","text":"tracked dataframe ","code":""},{"path":"/reference/augment_data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Sanitise AvonCap data columns — augment_data","text":"function maps data tidy dataframe consistently named columns, named factors appropriate. present data ethnicity files sanitisation code held zzz-avoncap-mappings.R file.","code":""},{"path":"/reference/augment_generic.html","id":null,"dir":"Reference","previous_headings":"","what":"Applies a set of functions to the whole dataframe — augment_generic","title":"Applies a set of functions to the whole dataframe — augment_generic","text":"sequences, catches errors allows parameters passed name","code":""},{"path":"/reference/augment_generic.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Applies a set of functions to the whole dataframe — augment_generic","text":"","code":"augment_generic(df, ...)"},{"path":"/reference/augment_generic.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Applies a set of functions to the whole dataframe — augment_generic","text":"df data frame ... unnamed parameters list functions, named parameters passed functions (match formal arguments).","code":""},{"path":"/reference/augment_generic.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Applies a set of functions to the whole dataframe — augment_generic","text":"altered df","code":""},{"path":"/reference/augment_generic.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Applies a set of functions to the whole dataframe — augment_generic","text":"","code":"fn1 = function(df,v) {df %>% dplyr::filter(cut==\"Fair\") %>% dplyr::mutate(x_col = color)} fn2 = function(df,v) {df %>% dplyr::filter(color==v$color$J)} df = ggplot2::diamonds %>% augment_generic(fn1, fn2) #> using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-3739c218867bc780c3b4c0f7a03dbb8f.rda"},{"path":"/reference/cut_integer.html","id":null,"dir":"Reference","previous_headings":"","what":"Cut and label an integer valued quantity — cut_integer","title":"Cut and label an integer valued quantity — cut_integer","text":"Deals annoying issues classifying integer data sets, ages, groups. want specify just change points integers clearly label resulting ordered factor.","code":""},{"path":"/reference/cut_integer.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Cut and label an integer valued quantity — cut_integer","text":"","code":"cut_integer(   x,   cut_points,   glue = \"{label}\",   lower_limit = -Inf,   upper_limit = Inf,   ... )"},{"path":"/reference/cut_integer.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Cut and label an integer valued quantity — cut_integer","text":"x vector integer valued numbers, e.g. ages, counts cut_points vector integer valued cut points define lower boundaries conditions glue glue spec may used generate label. can use low, high, next_low, label values. lower_limit minimum value include (inclusive bottom category) (default -Inf) upper_limit maximum value include (also inclusive top category) (default Inf) ... used","code":""},{"path":"/reference/cut_integer.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Cut and label an integer valued quantity — cut_integer","text":"ordered factor integer","code":""},{"path":"/reference/cut_integer.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Cut and label an integer valued quantity — cut_integer","text":"","code":"cut_integer(stats::rbinom(20,20,0.5), c(5,10,15)) #>  [1] 10‒14 10‒14 10‒14 10‒14 5‒9   10‒14 10‒14 10‒14 ≥15   5‒9   10‒14 5‒9   #> [13] 10‒14 5‒9   10‒14 10‒14 10‒14 5‒9   5‒9   10‒14 #> Levels: <5 < 5‒9 < 10‒14 < ≥15 cut_integer(floor(stats::runif(100,-10,10)), cut_points = c(2,3,4,6), lower_limit=0, upper_limit=10) #>   [1] 6‒10 <NA> <NA> 6‒10 6‒10 <NA> 0‒1  6‒10 <NA> 4‒5  6‒10 <NA> 6‒10 <NA> 6‒10 #>  [16] 3    6‒10 <NA> 3    <NA> 6‒10 0‒1  4‒5  4‒5  2    <NA> <NA> 6‒10 <NA> 6‒10 #>  [31] 6‒10 <NA> <NA> 4‒5  <NA> 2    2    <NA> 6‒10 <NA> <NA> <NA> 3    <NA> <NA> #>  [46] 3    <NA> <NA> <NA> <NA> 0‒1  0‒1  <NA> <NA> <NA> 6‒10 <NA> 6‒10 3    <NA> #>  [61] <NA> <NA> 2    6‒10 <NA> 6‒10 0‒1  <NA> <NA> <NA> <NA> <NA> <NA> <NA> 0‒1  #>  [76] 3    <NA> <NA> <NA> <NA> 6‒10 0‒1  4‒5  <NA> <NA> 2    <NA> <NA> <NA> 4‒5  #>  [91] <NA> 6‒10 <NA> <NA> 0‒1  6‒10 <NA> <NA> 6‒10 6‒10 #> Levels: 0‒1 < 2 < 3 < 4‒5 < 6‒10"},{"path":"/reference/default_column_names.html","id":null,"dir":"Reference","previous_headings":"","what":"default column naming mappings — default_column_names","title":"default column naming mappings — default_column_names","text":"default column naming mappings","code":""},{"path":"/reference/default_column_names.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"default column naming mappings — default_column_names","text":"","code":"default_column_names(...)"},{"path":"/reference/default_column_names.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"default column naming mappings — default_column_names","text":"... additional named items add","code":""},{"path":"/reference/default_column_names.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"default column naming mappings — default_column_names","text":"set mappings","code":""},{"path":"/reference/derive_WHO_outcome_score.html","id":null,"dir":"Reference","previous_headings":"","what":"determine WHO outcome score — derive_WHO_outcome_score","title":"determine WHO outcome score — derive_WHO_outcome_score","text":"Scores 0-3 community cases.","code":""},{"path":"/reference/derive_WHO_outcome_score.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"determine WHO outcome score — derive_WHO_outcome_score","text":"","code":"derive_WHO_outcome_score(df, v, ...)"},{"path":"/reference/derive_WHO_outcome_score.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"determine WHO outcome score — derive_WHO_outcome_score","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_WHO_outcome_score.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"determine WHO outcome score — derive_WHO_outcome_score","text":"dataframe","code":""},{"path":"/reference/derive_WHO_outcome_score.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"determine WHO outcome score — derive_WHO_outcome_score","text":"generally cant tell difference 7 8. 4: Hospitalised; oxygen therapy 5: Hospitalised; oxygen mask nasal prongs 6: Hospitalised; oxygen NIV high flow 7: Intubation mechanical ventilation, pO2/FiO2 ≥150 SpO2/FiO2 ≥200 8: Mechanical ventilation pO2/FIO2 <150 (SpO2/FiO2 <200) vasopressors 9: Mechanical ventilation pO2/FiO2 <150 vasopressors, dialysis, ECMO 10: Dead","code":""},{"path":"/reference/derive_aLRTD_categories.html","id":null,"dir":"Reference","previous_headings":"","what":"The aLRTD incidence paper classifications — derive_aLRTD_categories","title":"The aLRTD incidence paper classifications — derive_aLRTD_categories","text":"3 category classifications","code":""},{"path":"/reference/derive_aLRTD_categories.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"The aLRTD incidence paper classifications — derive_aLRTD_categories","text":"","code":"derive_aLRTD_categories(df, v, ...)  derive_aLRTD_categories(df, v, ...)"},{"path":"/reference/derive_aLRTD_categories.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"The aLRTD incidence paper classifications — derive_aLRTD_categories","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_aLRTD_categories.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"The aLRTD incidence paper classifications — derive_aLRTD_categories","text":"dataframe","code":""},{"path":"/reference/derive_aLRTD_categories.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"The aLRTD incidence paper classifications — derive_aLRTD_categories","text":"aetiological: Confirmed SARS-CoV-2 - implies Infective evidence SARS-CoV-2 - implies Infective confirmed SARS-CoV-2 Non-infective - presumed non infective clinical presentation: Pneumonia - implies Infective NP-LRTI - implies Infective evidence LRTI (include CRDE HF) cases get clinical presentation . Typically people infective cause, LRTI pneumonia excluded. URTI incidental COVID cases.","code":""},{"path":"/reference/derive_admission_episode.html","id":null,"dir":"Reference","previous_headings":"","what":"Create a counter in the event of repeated admissions — derive_admission_episode","title":"Create a counter in the event of repeated admissions — derive_admission_episode","text":"also calculate time interval admissions. also repeat admission instrument use.","code":""},{"path":"/reference/derive_admission_episode.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create a counter in the event of repeated admissions — derive_admission_episode","text":"","code":"derive_admission_episode(df, v)"},{"path":"/reference/derive_admission_episode.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create a counter in the event of repeated admissions — derive_admission_episode","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df)","code":""},{"path":"/reference/derive_admission_episode.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create a counter in the event of repeated admissions — derive_admission_episode","text":"dataframe","code":""},{"path":"/reference/derive_completed_vaccination_status.html","id":null,"dir":"Reference","previous_headings":"","what":"Derive detailed vaccination status on admission — derive_completed_vaccination_status","title":"Derive detailed vaccination status on admission — derive_completed_vaccination_status","text":"Vaccination deemed effect given > 14 days admission 1st dose >7 days admission subsequent doses. account previous infection data set.","code":""},{"path":"/reference/derive_completed_vaccination_status.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Derive detailed vaccination status on admission — derive_completed_vaccination_status","text":"","code":"derive_completed_vaccination_status(df, v, ...)"},{"path":"/reference/derive_completed_vaccination_status.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Derive detailed vaccination status on admission — derive_completed_vaccination_status","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_completed_vaccination_status.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Derive detailed vaccination status on admission — derive_completed_vaccination_status","text":"dataframe","code":""},{"path":"/reference/derive_consent_flag.html","id":null,"dir":"Reference","previous_headings":"","what":"Has a patient withheld consent or withdrawn — derive_consent_flag","title":"Has a patient withheld consent or withdrawn — derive_consent_flag","text":"patient withdrawn consent may still data fields populated","code":""},{"path":"/reference/derive_consent_flag.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Has a patient withheld consent or withdrawn — derive_consent_flag","text":"","code":"derive_consent_flag(df, v)"},{"path":"/reference/derive_consent_flag.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Has a patient withheld consent or withdrawn — derive_consent_flag","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df)","code":""},{"path":"/reference/derive_consent_flag.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Has a patient withheld consent or withdrawn — derive_consent_flag","text":"dataframe","code":""},{"path":"/reference/derive_continuous_categories.html","id":null,"dir":"Reference","previous_headings":"","what":"Categorical scores for continuous variables — derive_continuous_categories","title":"Categorical scores for continuous variables — derive_continuous_categories","text":"Typically used regression models non-linear effects splines","code":""},{"path":"/reference/derive_continuous_categories.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Categorical scores for continuous variables — derive_continuous_categories","text":"","code":"derive_continuous_categories(df, v, ...)"},{"path":"/reference/derive_continuous_categories.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Categorical scores for continuous variables — derive_continuous_categories","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_continuous_categories.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Categorical scores for continuous variables — derive_continuous_categories","text":"dataframe","code":""},{"path":"/reference/derive_continuous_categories.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Categorical scores for continuous variables — derive_continuous_categories","text":"Age category - UK demographic data ends 85, 65 key cut 5 year bands, 10 year bands age categories end 85 (N.b.) principled reason . Boundaries fall approx 0.1, 0.2, 0.4, 0.6, 0.8 quantiles. merge first two groups outcomes usually different. Covid vaccination cohorts 5 year age groups, vaccination prioirty 65+ Age pneumovax eligibility CCI - 4 bands defined https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3891119/#:~:text=Based%20on%20the%20CCI%20score,%20CCI%20scores%20%E2%89%A55.similar https://link.springer.com/article/10.1007/s10654-021-00802-z Rockwood score - independent versus dependent frailty","code":""},{"path":"/reference/derive_covid_status.html","id":null,"dir":"Reference","previous_headings":"","what":"Determine if an admission is proven SARS-CoV-2 PCR positive — derive_covid_status","title":"Determine if an admission is proven SARS-CoV-2 PCR positive — derive_covid_status","text":"SARS-CoV-2 PCR positive lab confirmed diagnosis.","code":""},{"path":"/reference/derive_covid_status.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Determine if an admission is proven SARS-CoV-2 PCR positive — derive_covid_status","text":"","code":"derive_covid_status(df, v, ...)"},{"path":"/reference/derive_covid_status.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Determine if an admission is proven SARS-CoV-2 PCR positive — derive_covid_status","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_covid_status.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Determine if an admission is proven SARS-CoV-2 PCR positive — derive_covid_status","text":"dataframe","code":""},{"path":"/reference/derive_covid_status.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Determine if an admission is proven SARS-CoV-2 PCR positive — derive_covid_status","text":"admission.covid_pcr_result: based fields: c19_adm_swab covid_19_diagnosis Patient reported, clinical diagnoses assumed PCR negative (although possible cases may done). Lateral flows done hospital counted PCR negative. negative admission swabs counted negative NA signifies test done. admission.is_covid: Binary confirmed -evidence. PCR results count confirmed, Lateral flow results count confirmed, anything else evidence (includes negatives test done)","code":""},{"path":"/reference/derive_diagnosis_categories.html","id":null,"dir":"Reference","previous_headings":"","what":"Create 4 non exclusive diagnostic categories — derive_diagnosis_categories","title":"Create 4 non exclusive diagnostic categories — derive_diagnosis_categories","text":"Pneumonia one : Standard care diagnosis CAP (radiologically clinically) Empyema abscess Admission chest X-ray shows pneumonia","code":""},{"path":"/reference/derive_diagnosis_categories.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create 4 non exclusive diagnostic categories — derive_diagnosis_categories","text":"","code":"derive_diagnosis_categories(df, v)"},{"path":"/reference/derive_diagnosis_categories.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create 4 non exclusive diagnostic categories — derive_diagnosis_categories","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df)","code":""},{"path":"/reference/derive_diagnosis_categories.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create 4 non exclusive diagnostic categories — derive_diagnosis_categories","text":"dataframe","code":""},{"path":"/reference/derive_diagnosis_categories.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Create 4 non exclusive diagnostic categories — derive_diagnosis_categories","text":"NP-LRTI : pneumonia Standard care LTRI diagnosis Exascerbation CRDE: Standard care exacerbation COPD Standard care exacerbation Non-COPD (N.B. may pneumonia NP-LRTI) Heart failure: Standard care congestive heart failure.","code":""},{"path":"/reference/derive_effective_vaccination_status.html","id":null,"dir":"Reference","previous_headings":"","what":"A simple vaccination status on admission as an ordered number of doses — derive_effective_vaccination_status","title":"A simple vaccination status on admission as an ordered number of doses — derive_effective_vaccination_status","text":"account previous infection data set.","code":""},{"path":"/reference/derive_effective_vaccination_status.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A simple vaccination status on admission as an ordered number of doses — derive_effective_vaccination_status","text":"","code":"derive_effective_vaccination_status(df, v, ...)"},{"path":"/reference/derive_effective_vaccination_status.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"A simple vaccination status on admission as an ordered number of doses — derive_effective_vaccination_status","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_effective_vaccination_status.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"A simple vaccination status on admission as an ordered number of doses — derive_effective_vaccination_status","text":"dataframe","code":""},{"path":"/reference/derive_genomic_variant.html","id":null,"dir":"Reference","previous_headings":"","what":"Give a inferred Alpha, Delta or Omicron status based on time alone. — derive_genomic_variant","title":"Give a inferred Alpha, Delta or Omicron status based on time alone. — derive_genomic_variant","text":"relies date period confidence variants circulating given type. quite conservative estimates based frequency sequenced cases bristol area (according Sanger centre cases identified hospital testing)","code":""},{"path":"/reference/derive_genomic_variant.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Give a inferred Alpha, Delta or Omicron status based on time alone. — derive_genomic_variant","text":"","code":"derive_genomic_variant(df, v, ...)"},{"path":"/reference/derive_genomic_variant.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Give a inferred Alpha, Delta or Omicron status based on time alone. — derive_genomic_variant","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_genomic_variant.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Give a inferred Alpha, Delta or Omicron status based on time alone. — derive_genomic_variant","text":"dataframe","code":""},{"path":"/reference/derive_genomic_variant.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Give a inferred Alpha, Delta or Omicron status based on time alone. — derive_genomic_variant","text":"Sanger centre data Pre-alpha 05 Dec 2020 Alpha 13 Feb 2021 15 May 2021 Delta 01 Jun 2021 07 Nov 2021 Omicron 07 Feb 2022 present","code":""},{"path":"/reference/derive_haematology_categories.html","id":null,"dir":"Reference","previous_headings":"","what":"Binary outcomes for haematology data — derive_haematology_categories","title":"Binary outcomes for haematology data — derive_haematology_categories","text":"Elevated troponin : > 18:  18ng/L simply 99th percentile value Beckman assay use quoted IFCC. elected use sex-specific 99th percentile values although also quoted incorporate analysis. sure aware 4th Universal definition MI requires rise fall 99th percentile etc.","code":""},{"path":"/reference/derive_haematology_categories.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Binary outcomes for haematology data — derive_haematology_categories","text":"","code":"derive_haematology_categories(df, v, ...)"},{"path":"/reference/derive_haematology_categories.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Binary outcomes for haematology data — derive_haematology_categories","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_haematology_categories.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Binary outcomes for haematology data — derive_haematology_categories","text":"dataframe","code":""},{"path":"/reference/derive_hospital_burden_outcomes.html","id":null,"dir":"Reference","previous_headings":"","what":"Binary outcomes for hospital burden — derive_hospital_burden_outcomes","title":"Binary outcomes for hospital burden — derive_hospital_burden_outcomes","text":"outcomes tested Delta vs Omicron severity paper sensitivity analysis. defined COVID cases.","code":""},{"path":"/reference/derive_hospital_burden_outcomes.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Binary outcomes for hospital burden — derive_hospital_burden_outcomes","text":"","code":"derive_hospital_burden_outcomes(df, v, ...)"},{"path":"/reference/derive_hospital_burden_outcomes.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Binary outcomes for hospital burden — derive_hospital_burden_outcomes","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_hospital_burden_outcomes.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Binary outcomes for hospital burden — derive_hospital_burden_outcomes","text":"dataframe","code":""},{"path":"/reference/derive_hospital_burden_outcomes.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Binary outcomes for hospital burden — derive_hospital_burden_outcomes","text":"O2 requirement within 7 days (various cut-offs) respiratory support 7 days (various cut-offs) LOS > X days first 7 days (various cut-offs)","code":""},{"path":"/reference/derive_infective_classification.html","id":null,"dir":"Reference","previous_headings":"","what":"Determine if an admission is due to an infective cause — derive_infective_classification","title":"Determine if an admission is due to an infective cause — derive_infective_classification","text":"Infective admissions defined : pneumonias NP-LRTI laboratory confirmed COVID diagnosis admission swab covid positive","code":""},{"path":"/reference/derive_infective_classification.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Determine if an admission is due to an infective cause — derive_infective_classification","text":"","code":"derive_infective_classification(df, v)"},{"path":"/reference/derive_infective_classification.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Determine if an admission is due to an infective cause — derive_infective_classification","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df)","code":""},{"path":"/reference/derive_infective_classification.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Determine if an admission is due to an infective cause — derive_infective_classification","text":"dataframe","code":""},{"path":"/reference/derive_infective_classification.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Determine if an admission is due to an infective cause — derive_infective_classification","text":"Infective admissions excluded : Standard care non-infectious process SOC non-LRTI (none categoories ) unknowns defined non-Infective","code":""},{"path":"/reference/derive_nosocomial_covid_status.html","id":null,"dir":"Reference","previous_headings":"","what":"Did the patient catch COVID in hospital — derive_nosocomial_covid_status","title":"Did the patient catch COVID in hospital — derive_nosocomial_covid_status","text":"relevant SARS-CoV-2 PCR positive patient. Timing positive test compared admission: relies knowing dates hence works identifiable data sets,","code":""},{"path":"/reference/derive_nosocomial_covid_status.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Did the patient catch COVID in hospital — derive_nosocomial_covid_status","text":"","code":"derive_nosocomial_covid_status(df, v, ...)"},{"path":"/reference/derive_nosocomial_covid_status.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Did the patient catch COVID in hospital — derive_nosocomial_covid_status","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_nosocomial_covid_status.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Did the patient catch COVID in hospital — derive_nosocomial_covid_status","text":"dataframe","code":""},{"path":"/reference/derive_nosocomial_covid_status.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Did the patient catch COVID in hospital — derive_nosocomial_covid_status","text":"Logic : Community PCR result predates admission Probably commuinity PCR result within 7 days admission Probably nosocomial 7-28 days admission Otherwise undefined.","code":""},{"path":"/reference/derive_patient_identifier.html","id":null,"dir":"Reference","previous_headings":"","what":"Create a unique patient level id if it does not already exist — derive_patient_identifier","title":"Create a unique patient level id if it does not already exist — derive_patient_identifier","text":"patient identifier ","code":""},{"path":"/reference/derive_patient_identifier.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create a unique patient level id if it does not already exist — derive_patient_identifier","text":"","code":"derive_patient_identifier(df, v)"},{"path":"/reference/derive_patient_identifier.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create a unique patient level id if it does not already exist — derive_patient_identifier","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df)","code":""},{"path":"/reference/derive_patient_identifier.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create a unique patient level id if it does not already exist — derive_patient_identifier","text":"dataframe","code":""},{"path":"/reference/derive_patient_identifier.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Create a unique patient level id if it does not already exist — derive_patient_identifier","text":"Derived record number first record number (ensuring matches) entry record number.","code":""},{"path":"/reference/derive_pcv_groupings.html","id":null,"dir":"Reference","previous_headings":"","what":"Group pneumo serotypes according to e.g. vaccine coverage — derive_pcv_groupings","title":"Group pneumo serotypes according to e.g. vaccine coverage — derive_pcv_groupings","text":"range useful serotype groups defined list uad_groups. default_pcv_map gives set mappings group headings gives overall serotype distribution vaccine.","code":""},{"path":"/reference/derive_pcv_groupings.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Group pneumo serotypes according to e.g. vaccine coverage — derive_pcv_groupings","text":"","code":"derive_pcv_groupings(   df,   ...,   pcv_map = uad_pcv_map,   not_matched = \"Other\",   col_name = \"pneumo.pcv_group\" )"},{"path":"/reference/derive_pcv_groupings.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Group pneumo serotypes according to e.g. vaccine coverage — derive_pcv_groupings","text":"df normalised urine antigen data ... ignored pcv_map 2 column data frame mapping group uad_analysis not_matched call column non-matched serotypes? Default , Non vaccine type might preferred. col_name target column name pcv grouping (defaults pneumo.pcv_group)","code":""},{"path":"/reference/derive_pcv_groupings.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Group pneumo serotypes according to e.g. vaccine coverage — derive_pcv_groupings","text":"augmented data frame additional column defined col_name","code":""},{"path":"/reference/derive_pcv_groupings.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Group pneumo serotypes according to e.g. vaccine coverage — derive_pcv_groupings","text":"logic employed combining elements : (result == \"Unknown\") ~ \"Unknown\" (result == \"Positive\") ~ \"Positive\" (result == \"Negative\") ~ \"Negative\" TRUE ~ \"\"","code":""},{"path":"/reference/derive_phe_pcv_group.html","id":null,"dir":"Reference","previous_headings":"","what":"Get vaccine coverage group for known serotype — derive_phe_pcv_group","title":"Get vaccine coverage group for known serotype — derive_phe_pcv_group","text":"longitudinal oneumocococcal data, range useful serotype groups defined list uad_groups. default_pcv_map gives set mappings group headings gives overall serotype distribution vaccine.","code":""},{"path":"/reference/derive_phe_pcv_group.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get vaccine coverage group for known serotype — derive_phe_pcv_group","text":"","code":"derive_phe_pcv_group(   df,   ...,   pcv_map = serotype_pcv_map,   not_matched = \"Other\",   col_name = \"pneumo.phe_pcv_group\" )"},{"path":"/reference/derive_phe_pcv_group.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get vaccine coverage group for known serotype — derive_phe_pcv_group","text":"df normalised longitudinal pneumococcal data ... ignored pcv_map 2 column data frame mapping group serotype not_matched call column non-matched serotypes? Default , Non vaccine type might preferred. col_name target column name pcv grouping (defaults pneumo.phe_pcv_group)","code":""},{"path":"/reference/derive_phe_pcv_group.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get vaccine coverage group for known serotype — derive_phe_pcv_group","text":"augmented data frame additional column defined col_name","code":""},{"path":"/reference/derive_pneumo_uad_panel.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate UAD panel for test — derive_pneumo_uad_panel","title":"Calculate UAD panel for test — derive_pneumo_uad_panel","text":"panels UAD1 PCV13 serotypes, UAD2 PPV23 serotypes.","code":""},{"path":"/reference/derive_pneumo_uad_panel.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate UAD panel for test — derive_pneumo_uad_panel","text":"","code":"derive_pneumo_uad_panel(df, ...)"},{"path":"/reference/derive_pneumo_uad_panel.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate UAD panel for test — derive_pneumo_uad_panel","text":"df pneumo serotype dataframe ... ignored","code":""},{"path":"/reference/derive_pneumo_uad_panel.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate UAD panel for test — derive_pneumo_uad_panel","text":"dataframe additional columns pneumo.uad1_panel_result, pneumo.uad2_panel_result, pneumo.non_uad_panel_result, pneumo.serotype_summary_result","code":""},{"path":"/reference/derive_pneumo_uad_status.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate summary status from UAD (or other serotype) panel results — derive_pneumo_uad_status","title":"Calculate summary status from UAD (or other serotype) panel results — derive_pneumo_uad_status","text":"logic defined derive_pcv_groupings().","code":""},{"path":"/reference/derive_pneumo_uad_status.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate summary status from UAD (or other serotype) panel results — derive_pneumo_uad_status","text":"","code":"derive_pneumo_uad_status(df, ...)"},{"path":"/reference/derive_pneumo_uad_status.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate summary status from UAD (or other serotype) panel results — derive_pneumo_uad_status","text":"df pneumo serotype dataframe ... ignored","code":""},{"path":"/reference/derive_pneumo_uad_status.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate summary status from UAD (or other serotype) panel results — derive_pneumo_uad_status","text":"dataframe additional columns pneumo.uad1_panel_result, pneumo.uad2_panel_result, pneumo.non_uad_panel_result, pneumo.serotype_summary_result","code":""},{"path":"/reference/derive_pneumococcal_categories.html","id":null,"dir":"Reference","previous_headings":"","what":"The pneumococcal incidence diagnostic classifications — derive_pneumococcal_categories","title":"The pneumococcal incidence diagnostic classifications — derive_pneumococcal_categories","text":"4 category disjoint classification.","code":""},{"path":"/reference/derive_pneumococcal_categories.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"The pneumococcal incidence diagnostic classifications — derive_pneumococcal_categories","text":"","code":"derive_pneumococcal_categories(df, v, ...)"},{"path":"/reference/derive_pneumococcal_categories.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"The pneumococcal incidence diagnostic classifications — derive_pneumococcal_categories","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_pneumococcal_categories.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"The pneumococcal incidence diagnostic classifications — derive_pneumococcal_categories","text":"dataframe","code":""},{"path":"/reference/derive_pneumococcal_categories.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"The pneumococcal incidence diagnostic classifications — derive_pneumococcal_categories","text":"pneumo.presentation_class: CAP+/RAD+ - radiologically proved pneumonia CAP+/RAD- - pneumonia without x-ray confirmation NP-LRTI - non-pneumonic lower respiratory tract infection evidence LRTI - believed non-infective admission, last group usually discarded analysis, however really describes people without clinical diagnosis infection admission. still undiagnosed infection .","code":""},{"path":"/reference/derive_pneumococcal_high_risk.html","id":null,"dir":"Reference","previous_headings":"","what":"Determine if patient is in a high pneumococcal risk group — derive_pneumococcal_high_risk","title":"Determine if patient is in a high pneumococcal risk group — derive_pneumococcal_high_risk","text":"High pneumococcal risk defined following: 65 years old pneumococcal risks comorbid copd interstitial lung disease cystic fibrosis hypertension CCF ischaemic heart disease chronic kidney disease chronic liver disease diabetes asthmatic immunodeficiency immunosupression","code":""},{"path":"/reference/derive_pneumococcal_high_risk.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Determine if patient is in a high pneumococcal risk group — derive_pneumococcal_high_risk","text":"","code":"derive_pneumococcal_high_risk(df, v, ...)"},{"path":"/reference/derive_pneumococcal_high_risk.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Determine if patient is in a high pneumococcal risk group — derive_pneumococcal_high_risk","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_pneumococcal_high_risk.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Determine if patient is in a high pneumococcal risk group — derive_pneumococcal_high_risk","text":"dataframe","code":""},{"path":"/reference/derive_pneumococcal_risk_category.html","id":null,"dir":"Reference","previous_headings":"","what":"Determine pneumococcal risk group — derive_pneumococcal_risk_category","title":"Determine pneumococcal risk group — derive_pneumococcal_risk_category","text":"Original algorithm B1851202 SAP defines 3 class risk group","code":""},{"path":"/reference/derive_pneumococcal_risk_category.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Determine pneumococcal risk group — derive_pneumococcal_risk_category","text":"","code":"derive_pneumococcal_risk_category(df, v, ...)"},{"path":"/reference/derive_pneumococcal_risk_category.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Determine pneumococcal risk group — derive_pneumococcal_risk_category","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_pneumococcal_risk_category.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Determine pneumococcal risk group — derive_pneumococcal_risk_category","text":"dataframe","code":""},{"path":"/reference/derive_pneumococcal_risk_category.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Determine pneumococcal risk group — derive_pneumococcal_risk_category","text":"High-risk (immunocompromised) ✗ Asplenia ✓ Cancer/Malignancy, Hematologic ✓ Cancer/Malignancy, Solid Tumor ✓ Chronic Kidney Disease ✓ Human Immunodeficiency Virus (HIV) – AIDS ✓ Human Immunodeficiency Virus (HIV) – AIDS ✓ Immunodeficiency ✓ Immunosuppressant Drug Therapy ✓ Organ Transplantation ✗ Multiple Myeloma Risk (immunocompetent) ✓ Asthma ✓ Alcoholism ✗ Celiac Disease ✓ Chronic Liver Disease without Hepatic Failure ✓ Chronic Liver Disease Hepatic Failure ✓ Chronic Obstructive Pulmonary Disease ✗ Cochlear Implant ✓ Congestive Heart Failure ✓ Coronary Artery Disease (CAD) ✓ Chronic Neurologic Diseases ✗ Coagulation factor replacement therapy ✗ CSF Leak ✓ Diabetes Treated Medication ✓ syndrome ✓ Institutionalized nursing home LTC facility (Nursing home long-term care facility disability dependency subject characteristics/risk determinants eCRF page) ✓ Occupational risk exposure metal fumes ✓ Chronic Heart Disease ✓ Chronic Lung Disease ✓ pneumococcal disease risk factors ✗ Previous Invasive Pneumococcal Disease ✓ Tobacco smoking (Tobacco/E-Cigarettes) Anything else low risk","code":""},{"path":"/reference/derive_presumed_diagnosis_categories.html","id":null,"dir":"Reference","previous_headings":"","what":"Create presumed diagnostic categories — derive_presumed_diagnosis_categories","title":"Create presumed diagnostic categories — derive_presumed_diagnosis_categories","text":"Pneumonia one : Initial diagnosis CAP (supported initial radiology clinically) Empyema abscess","code":""},{"path":"/reference/derive_presumed_diagnosis_categories.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create presumed diagnostic categories — derive_presumed_diagnosis_categories","text":"","code":"derive_presumed_diagnosis_categories(df, v)"},{"path":"/reference/derive_presumed_diagnosis_categories.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create presumed diagnostic categories — derive_presumed_diagnosis_categories","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df)","code":""},{"path":"/reference/derive_presumed_diagnosis_categories.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create presumed diagnostic categories — derive_presumed_diagnosis_categories","text":"dataframe","code":""},{"path":"/reference/derive_presumed_diagnosis_categories.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Create presumed diagnostic categories — derive_presumed_diagnosis_categories","text":"Presumed clinical presentation: Pneumonia - implies Infective NP-LRTI - implies Infective evidence LRTI (include CRDE HF)","code":""},{"path":"/reference/derive_qcovid.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate a QCOVID2 score from AvonCap data source — derive_qcovid","title":"Calculate a QCOVID2 score from AvonCap data source — derive_qcovid","text":"uses inbuilt imd_to_townsend map. implements cut version QCovid2 score depending data available.","code":""},{"path":"/reference/derive_qcovid.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate a QCOVID2 score from AvonCap data source — derive_qcovid","text":"","code":"derive_qcovid(df, v = avoncap_df %>% get_value_sets())"},{"path":"/reference/derive_qcovid.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate a QCOVID2 score from AvonCap data source — derive_qcovid","text":"df normalised avoncap data source v value set","code":""},{"path":"/reference/derive_qcovid.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate a QCOVID2 score from AvonCap data source — derive_qcovid","text":"dataframe additional columns, qcovid2.log_hazard, covid2.hazard_ratio: log hazard rate QCOVID2 score missing data substituted reference value QCOVID2 population. qcovid2.log_comorbid_hazard, qcovid2.comorbid_hazard_ratio: log hazard rate comorbid conditions including age BMI.","code":""},{"path":"/reference/derive_severe_disease_outcomes.html","id":null,"dir":"Reference","previous_headings":"","what":"Binary outcomes for severe disease — derive_severe_disease_outcomes","title":"Binary outcomes for severe disease — derive_severe_disease_outcomes","text":"Confirmed death within 30 days (subject potential censoring) Confirmed death (length follow ) ICU admission","code":""},{"path":"/reference/derive_severe_disease_outcomes.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Binary outcomes for severe disease — derive_severe_disease_outcomes","text":"","code":"derive_severe_disease_outcomes(df, v, ...)"},{"path":"/reference/derive_severe_disease_outcomes.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Binary outcomes for severe disease — derive_severe_disease_outcomes","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_severe_disease_outcomes.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Binary outcomes for severe disease — derive_severe_disease_outcomes","text":"dataframe","code":""},{"path":"/reference/derive_severe_disease_outcomes.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Binary outcomes for severe disease — derive_severe_disease_outcomes","text":"described aLRTD paper","code":""},{"path":"/reference/derive_simpler_comorbidities.html","id":null,"dir":"Reference","previous_headings":"","what":"Rationalise some of the more detailed comorbidities — derive_simpler_comorbidities","title":"Rationalise some of the more detailed comorbidities — derive_simpler_comorbidities","text":"generate summary values","code":""},{"path":"/reference/derive_simpler_comorbidities.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Rationalise some of the more detailed comorbidities — derive_simpler_comorbidities","text":"","code":"derive_simpler_comorbidities(df, v, ...)"},{"path":"/reference/derive_simpler_comorbidities.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Rationalise some of the more detailed comorbidities — derive_simpler_comorbidities","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_simpler_comorbidities.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Rationalise some of the more detailed comorbidities — derive_simpler_comorbidities","text":"dataframe","code":""},{"path":"/reference/derive_simpler_comorbidities.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Rationalise some of the more detailed comorbidities — derive_simpler_comorbidities","text":"chronic resp dx: asthma, bronchiectasis, chronic pleural disease, COPD, interstitial lung dx, cyctic fibrosis, chronic resp dx chronic heart disease: pulmonary htn, CCF, IHD, previous MI, congential heart dx, hypertension, AF, arrythmia, heart dx, heart dx","code":""},{"path":"/reference/derive_template.html","id":null,"dir":"Reference","previous_headings":"","what":"Derived data function template — derive_template","title":"Derived data function template — derive_template","text":"Derived data function template","code":""},{"path":"/reference/derive_template.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Derived data function template — derive_template","text":"","code":"derive_template(df, v, ...)"},{"path":"/reference/derive_template.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Derived data function template — derive_template","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_template.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Derived data function template — derive_template","text":"dataframe","code":""},{"path":"/reference/derive_vaccination_timings.html","id":null,"dir":"Reference","previous_headings":"","what":"Derive times from vaccination to symptom onset — derive_vaccination_timings","title":"Derive times from vaccination to symptom onset — derive_vaccination_timings","text":"symptom duration given assumed zero.","code":""},{"path":"/reference/derive_vaccination_timings.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Derive times from vaccination to symptom onset — derive_vaccination_timings","text":"","code":"derive_vaccination_timings(df, v, ...)"},{"path":"/reference/derive_vaccination_timings.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Derive times from vaccination to symptom onset — derive_vaccination_timings","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_vaccination_timings.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Derive times from vaccination to symptom onset — derive_vaccination_timings","text":"dataframe","code":""},{"path":"/reference/derive_vaccine_combinations.html","id":null,"dir":"Reference","previous_headings":"","what":"Deprecated - Vaccine combinations are less relevant now — derive_vaccine_combinations","title":"Deprecated - Vaccine combinations are less relevant now — derive_vaccine_combinations","text":"many potential combinations 4th, 5th sixth dose make useful.","code":""},{"path":"/reference/derive_vaccine_combinations.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Deprecated - Vaccine combinations are less relevant now — derive_vaccine_combinations","text":"","code":"derive_vaccine_combinations(df, v, ...)"},{"path":"/reference/derive_vaccine_combinations.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Deprecated - Vaccine combinations are less relevant now — derive_vaccine_combinations","text":"df dataframe. v value set. usually precomputed augment framework value set can explicitly supplied v = get_value_sets(df) ... ignored","code":""},{"path":"/reference/derive_vaccine_combinations.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Deprecated - Vaccine combinations are less relevant now — derive_vaccine_combinations","text":"dataframe","code":""},{"path":"/reference/dot-cache_clear.html","id":null,"dir":"Reference","previous_headings":"","what":"Clear data from the passthrough cache for complex or long running operations — .cache_clear","title":"Clear data from the passthrough cache for complex or long running operations — .cache_clear","text":"Clear data passthrough cache complex long running operations","code":""},{"path":"/reference/dot-cache_clear.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Clear data from the passthrough cache for complex or long running operations — .cache_clear","text":"","code":".cache_clear(   .cache = getOption(\"cache.dir\", rappdirs::user_cache_dir(utils::packageName())),   .prefix = \".*\",   interactive = TRUE )"},{"path":"/reference/dot-cache_clear.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Clear data from the passthrough cache for complex or long running operations — .cache_clear","text":".cache location cache directory. May get value options(\"ggrrr.cache.dir\") default value rappdirs::user_cache_dir(\"ggrrr\") .prefix regular expression matching prefix cached item, selective clean operations. defaults everything. interactive suppress sure? warning FALSE value (defaults TRUE)","code":""},{"path":"/reference/dot-cache_clear.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Clear data from the passthrough cache for complex or long running operations — .cache_clear","text":"nothing. called side effects","code":""},{"path":"/reference/dot-cache_delete_stale.html","id":null,"dir":"Reference","previous_headings":"","what":"Delete stale files in a cache — .cache_delete_stale","title":"Delete stale files in a cache — .cache_delete_stale","text":"Staleness determined number days 2am current day current time-zone. item cached one day becomes stale 2am day cached. time configurable option(cache.time_day_starts = 0) midnight. Automated analysis using caches updated data ensure analysis cross time point otherwise may end using old data.","code":""},{"path":"/reference/dot-cache_delete_stale.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Delete stale files in a cache — .cache_delete_stale","text":"","code":".cache_delete_stale(   .cache = getOption(\"cache.dir\", rappdirs::user_cache_dir(utils::packageName())),   .prefix = \".*\",   .stale = Inf )"},{"path":"/reference/dot-cache_delete_stale.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Delete stale files in a cache — .cache_delete_stale","text":".cache location cache directory. May get value options(\"cache.dir\") default value rappdirs::user_cache_dir(\"ggrrr\") .prefix name operation can namespace cached files selective clean operations .stale length time days keep cached data considering stale.","code":""},{"path":"/reference/dot-cache_delete_stale.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Delete stale files in a cache — .cache_delete_stale","text":"nothing. called side effects.","code":""},{"path":"/reference/dot-cache_download.html","id":null,"dir":"Reference","previous_headings":"","what":"Download a file into a local cache. — .cache_download","title":"Download a file into a local cache. — .cache_download","text":"function copies remote file local cache makes sure reused.","code":""},{"path":"/reference/dot-cache_download.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Download a file into a local cache. — .cache_download","text":"","code":".cache_download(   url,   ...,   .nocache = getOption(\"cache.disable\", default = FALSE),   .cache = getOption(\"cache.download\", rappdirs::user_cache_dir(utils::packageName())),   .stale = Inf,   .extn = NULL )"},{"path":"/reference/dot-cache_download.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Download a file into a local cache. — .cache_download","text":"url url download ... ignored .nocache set TRUE caching disabled .cache location downloaded files .stale long leave file replacing . .extn file name extension","code":""},{"path":"/reference/dot-cache_download.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Download a file into a local cache. — .cache_download","text":"path downloaded file","code":""},{"path":"/reference/dot-cached.html","id":null,"dir":"Reference","previous_headings":"","what":"A simple pass-through cache for complex or long running operations — .cached","title":"A simple pass-through cache for complex or long running operations — .cached","text":"executes expr saves output RDS file indexed code expr hash input variables (contain variable inputs)","code":""},{"path":"/reference/dot-cached.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A simple pass-through cache for complex or long running operations — .cached","text":"","code":".cached(   .expr,   ...,   .nocache = getOption(\"cache.disable\", default = FALSE),   .cache = getOption(\"cache.dir\", rappdirs::user_cache_dir(utils::packageName())),   .prefix = \"cached\",   .stale = Inf )"},{"path":"/reference/dot-cached.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"A simple pass-through cache for complex or long running operations — .cached","text":".expr code output requires caching. return value create side effects change global variables. ... inputs code expr depends changes require code re-running, Sys.Date() .nocache option defeat caching can set globally options(\"cache.disable\"=TRUE) .cache location cache directory. May get value options(\"cache.dir\") default value rappdirs::user_cache_dir(\"ggrrr\") .prefix name operation can namespace cached files selective clean operations .stale length time days keep cached data considering stale. can also set options(\"cache.stale\")","code":""},{"path":"/reference/dot-cached.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"A simple pass-through cache for complex or long running operations — .cached","text":"output .expr usually value","code":""},{"path":"/reference/extract_dependencies.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract the — extract_dependencies","title":"Extract the — extract_dependencies","text":"Extract ","code":""},{"path":"/reference/extract_dependencies.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract the — extract_dependencies","text":"","code":"extract_dependencies(data, col, original = TRUE)"},{"path":"/reference/extract_dependencies.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract the — extract_dependencies","text":"data dataframe col column symbol original map names original column names data. false function returns list current normalised column names.","code":""},{"path":"/reference/extract_dependencies.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract the — extract_dependencies","text":"named list dependencies original column names given column","code":""},{"path":"/reference/find_new_field_names.html","id":null,"dir":"Reference","previous_headings":"","what":"Get the transformed columns from original field names — find_new_field_names","title":"Get the transformed columns from original field names — find_new_field_names","text":"Get transformed columns original field names","code":""},{"path":"/reference/find_new_field_names.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get the transformed columns from original field names — find_new_field_names","text":"","code":"find_new_field_names(normalised, fields)"},{"path":"/reference/find_new_field_names.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get the transformed columns from original field names — find_new_field_names","text":"normalised transformed data set. fields vector field names","code":""},{"path":"/reference/find_new_field_names.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get the transformed columns from original field names — find_new_field_names","text":"named list mapping original new columns","code":""},{"path":"/reference/get_value_sets.html","id":null,"dir":"Reference","previous_headings":"","what":"Get a value set list of a dataframe — get_value_sets","title":"Get a value set list of a dataframe — get_value_sets","text":"function examines dataframe returns list columns sub-lists options factors. provides programmatic access (automcomplete) values available dataframe, throws early error try access data variable exist.","code":""},{"path":"/reference/get_value_sets.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get a value set list of a dataframe — get_value_sets","text":"","code":"get_value_sets(df)"},{"path":"/reference/get_value_sets.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get a value set list of a dataframe — get_value_sets","text":"df dataframe examine","code":""},{"path":"/reference/get_value_sets.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get a value set list of a dataframe — get_value_sets","text":"list lists column name factor levels list, checked list.","code":""},{"path":"/reference/imd_to_townsend.html","id":null,"dir":"Reference","previous_headings":"","what":"High level IMD to Townsend score map — imd_to_townsend","title":"High level IMD to Townsend score map — imd_to_townsend","text":"high level mapping IMD Townsend score inaccurate townsend score","code":""},{"path":"/reference/imd_to_townsend.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"High level IMD to Townsend score map — imd_to_townsend","text":"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/845345/File_7_-_All_IoD2019_Scores__Ranks__Deciles_and_Population_Denominators_3.csv https://s3-eu-west-1.amazonaws.com/statistics.digitalresources.jisc.ac.uk/dkan/files/Townsend_Deprivation_Scores/Scores/Scores-%202011%20UK%20LSOA.csv","code":""},{"path":"/reference/imd_to_townsend.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"High level IMD to Townsend score map — imd_to_townsend","text":"data frame 10 rows 2 columns: imd_decile IMD mean_townsend average townsend score IMD","code":""},{"path":"/reference/input.html","id":null,"dir":"Reference","previous_headings":"","what":"Locate the input directory — input","title":"Locate the input directory — input","text":"Locate input directory","code":""},{"path":"/reference/input.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Locate the input directory — input","text":"","code":"input(...)"},{"path":"/reference/input.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Locate the input directory — input","text":"... sub paths within input directory","code":""},{"path":"/reference/input.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Locate the input directory — input","text":"path input directory sub paths provided","code":""},{"path":"/reference/input.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Locate the input directory — input","text":"","code":"# devtools::load_all()  avoncap::set_input(\"~/Data/avoncap\") #> Found data directory: /home/vp22681/Data/avoncap #> /home/vp22681/Data/avoncap avoncap::input(\"nhs-extract\") #> /home/vp22681/Data/avoncap/nhs-extract  avoncap::all_files() #> # A tibble: 76 × 7 #>    filename     directory     path       date       hospital study_year filetype #>    <chr>        <chr>         <fs::path> <date>     <chr>         <int> <chr>    #>  1 central_y1   avoncap-expo… …al_y1.csv 2022-03-22 NA                1 csv      #>  2 central_y2   avoncap-expo… …al_y2.csv 2022-03-22 NA                2 csv      #>  3 central_y1   avoncap-expo… …al_y1.csv 2022-06-20 NA                1 csv      #>  4 central_y2   avoncap-expo… …al_y2.csv 2022-06-20 NA                2 csv      #>  5 central_y1   avoncap-expo… …al_y1.csv 2022-07-11 NA                1 csv      #>  6 central_y2   avoncap-expo… …al_y2.csv 2022-07-11 NA                2 csv      #>  7 central_y1   avoncap-expo… …al_y1.csv 2022-09-21 NA                1 csv      #>  8 central_y2   avoncap-expo… …al_y2.csv 2022-09-21 NA                2 csv      #>  9 uad-controls avoncap-expo… …trols.csv 2022-10-07 NA               NA csv      #> 10 central_y1   avoncap-expo… …al_y1.csv 2022-11-09 NA                1 csv      #> # ℹ 66 more rows   # exact match on filename column of all_data() avoncap::most_recent_files(\"AvonCAPLRTDCentralDa\") #> # A tibble: 0 × 7 #> # ℹ 7 variables: filename <chr>, directory <chr>, path <fs::path>, date <date>, #> #   hospital <chr>, study_year <int>, filetype <chr>   # or matches by lower case startWith on directory avoncap::most_recent_files(\"nhs-extract\",\"deltave\") #> # A tibble: 6 × 7 #>   filename       directory   path        date       hospital study_year filetype #>   <chr>          <chr>       <fs::path>  <date>     <chr>         <int> <chr>    #> 1 deltave_BRI_y1 nhs-extract …BRI_y1.csv 2022-12-07 BRI               1 csv      #> 2 deltave_BRI_y2 nhs-extract …BRI_y2.csv 2022-12-07 BRI               2 csv      #> 3 deltave_BRI_y3 nhs-extract …BRI_y3.csv 2022-12-07 BRI               3 csv      #> 4 deltave_NBT_y1 nhs-extract …NBT_y1.csv 2022-12-07 NBT               1 csv      #> 5 deltave_NBT_y2 nhs-extract …NBT_y2.csv 2022-12-07 NBT               2 csv      #> 6 deltave_NBT_y3 nhs-extract …NBT_y3.csv 2022-12-07 NBT               3 csv        avoncap::most_recent_files(\"metadata\") #> # A tibble: 5 × 7 #>   filename     directory path            date       hospital study_year filetype #>   <chr>        <chr>     <fs::path>      <date>     <chr>         <int> <chr>    #> 1 central_y1   metadata  …central_y1.csv 2022-10-24 NA                1 csv      #> 2 central_y2   metadata  …central_y2.csv 2022-10-24 NA                2 csv      #> 3 central_y3   metadata  …central_y3.csv 2022-10-24 NA                3 csv      #> 4 uad-controls metadata  …d-controls.csv 2022-10-24 NA               NA csv      #> 5 pneumococcal metadata  …eumococcal.csv 2022-11-29 NA               NA csv       avoncap::valid_inputs() #> # A tibble: 24 × 3 #> # Groups:   type [6] #>    type           subtype      file         #>    <chr>          <chr>        <chr>        #>  1 avoncap-export central      central_y1   #>  2 avoncap-export central      central_y2   #>  3 avoncap-export uad-controls uad-controls #>  4 avoncap-export central      central_y3   #>  5 avoncap-export gp           gp           #>  6 ethnicity      NA           y1           #>  7 ethnicity      NA           y2           #>  8 ethnicity      NA           y3           #>  9 metadata       central      central_y1   #> 10 metadata       central      central_y2   #> # ℹ 14 more rows"},{"path":"/reference/load_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Load data and check structure — load_data","title":"Load data and check structure — load_data","text":"Loads AvonCap data set csv files, may optionally qualified site ('BRI' 'NBT') database year ('y1', 'y2', 'y3') part file name. selects recent files earlier reproduce_at date detects whether set files.","code":""},{"path":"/reference/load_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Load data and check structure — load_data","text":"","code":"load_data(   type,   subtype = NULL,   reproduce_at = as.Date(getOption(\"reproduce.at\", default = Sys.Date())),   merge = TRUE,   ... )"},{"path":"/reference/load_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Load data and check structure — load_data","text":"type file category see valid_inputs() current list input directory subtype subtype valid_inputs() reproduce_at date cut newer data files merge setting TRUE forces multiple files merged single data frame losing mismatching columns. ... passed cached may specifically want use `.nocache=TRUE``","code":""},{"path":"/reference/load_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Load data and check structure — load_data","text":"either list dataframes single merged dataframe","code":""},{"path":"/reference/load_data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Load data and check structure — load_data","text":"files loaded csv checked files () columns, (B) type (empty) (C) major parse issues. merges files single dataframe, possible, otherwise return individually loaded files list dataframes.","code":""},{"path":"/reference/load_data.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Load data and check structure — load_data","text":"","code":"load_data(\"nhs-extract\",\"deltave\") #> using cached item: ~/.cache/avoncap/data-17eb1883a6ef139c6aff94d868955a14-efc310106a2b36fab3e67f93fe2c9461.rda #> # A tibble: 18,009 × 243 #>    record_number nhs_number admission_date gender age_at_admission   imd #>  * <chr>              <dbl> <chr>           <dbl>            <dbl> <dbl> #>  1 B02976        1829824764 17/05/2021          2             83.4     3 #>  2 B02977         572676760 17/05/2021          2             32.5     2 #>  3 B02978         427783973 17/05/2021          2             77.4     3 #>  4 B02980        1808110131 17/05/2021          1             90.6     3 #>  5 B02984         485842687 17/05/2021          2             60.2     1 #>  6 B02993         290021094 17/05/2021          2             65.6     8 #>  7 B02994         571224641 17/05/2021          1             64.1     2 #>  8 B03018         427913753 18/05/2021          1             74.7     4 #>  9 B03020        1988976150 18/05/2021          2             65.4     4 #> 10 B03024         430812585 18/05/2021          2             75.7     9 #> # ℹ 17,999 more rows #> # ℹ 237 more variables: rockwood <dbl>, symptom_days_preadmit <dbl>, #> #   fever2 <dbl>, pleurtic_cp <dbl>, cough2 <dbl>, sput_prod <dbl>, #> #   dyspnoea <dbl>, tachypnoea2 <dbl>, anosmia <dbl>, ageusia <dbl>, #> #   dysgeusia <dbl>, fever <dbl>, hypothermia <dbl>, chills <dbl>, #> #   headache <dbl>, malaise <dbl>, wheeze <dbl>, myalgia <dbl>, #> #   worse_confusion <dbl>, general_det <dbl>, hr <dbl>, systolic_bp <dbl>, …"},{"path":"/reference/map_avoncap_central.html","id":null,"dir":"Reference","previous_headings":"","what":"Core avoncap normalisation — map_avoncap_central","title":"Core avoncap normalisation — map_avoncap_central","text":"record_number -> admin.record_number (name) what_was_the_first_surveil -> admin.first_record_number (name) ac_study_number -> admin.consented_record_number (study_id) nhs_number -> admin.patient_identifier (ppi) duplicate -> admin.duplicate (yesno) enrollment_date -> admin.enrollment_date (date) study_year -> admin.study_year (name) file -> admin.data_file (name) week_number -> admin.week_number (name) c19_diagnosis -> diagnosis.standard_of_care_COVID_diagnosis (list) clinical_radio_diagnosis -> diagnosis.clinical_or_radiological_LRTI_or_pneumonia (yesno) c19_adm_swab -> diagnosis.admission_swab (list) c19_test_type -> diagnosis.test_type (list) qualifying_symptoms_signs -> diagnosis.qualifying_symptoms_signs (name) cc_critieria -> diagnosis.meets_case_control_criteria (yesno) cc_pos_date -> diagnosis.first_COVID_positive_swab_date (date) gender -> demog.gender (list) age_at_admission -> demog.age (double) age_march -> demog.age_in_march_2021 (double) imd -> demog.imd_decile (name) smoking -> demog.smoker (list) ethnicity2 -> demog.ethnicity (list) care_home -> demog.care_home_resident (yesno) drugs -> demog.no_drug_abuse, demog.alcohol_abuse, demog.ivdu_abuse, demog.marijuana_abuse, demog.other_inhaled_drug_abuse (checkboxes) vaping -> demog.vaping (list) alc_units -> demog.units_of_alcohol (name) np_swab -> admin.np_swab_taken_1 (list) adm_np_type -> admin.np_swab_site_1 (list) np_date -> admin.np_swab_date_1 (date) days_adm_npswab -> admin.np_swab_day_since_admission (double) np_swab_2 -> admin.np_swab_taken_2 (list) adm_np_type_2 -> admin.np_swab_site_2 (list) np_date_2 -> admin.np_swab_date_2 (date) np_swab_3 -> admin.np_swab_taken_3 (list) adm_np_type_3 -> admin.np_swab_site_3 (list) np_date_3 -> admin.np_swab_date_3 (date) saliva -> admin.saliva_sample_taken (list) saliva_date -> admin.saliva_sample_date (date) days_adm_saliva -> admin.saliva_sample_day_since_admission (double) sputum -> admin.sputum_sample_taken (list) sputum_date -> admin.sputum_sample_date (date) days_adm_sputum -> admin.sputum_sample_day_since_admission (double) pt_ad_ur -> admin.urine_sample_needed (yesno) adm_ur_taken -> admin.urine_sample_taken (list) nourine_reason -> admin.urine_sample_failure_reason (list) adm_np_type_2 -> admin.urine_sample_site (list) adm_ur_date -> admin.urine_sample_date (date) days_adm_urine -> admin.urine_sample_day_since_admission (double) adm_serum_tak -> admin.serum_sample_taken (list) adm_seru_date -> admin.serum_sample_date (date) days_adm_serum -> admin.serum_sample_day_since_admission (double) contraindication -> vaccination.covid_vaccine_contraindicated (yesno) covid19_vax -> vaccination.covid_vaccination (list) covidvax_date -> vaccination.first_dose_date (date) covidvax_dose_2 -> vaccination.second_dose_date (date) covidvax_dose_3 -> vaccination.third_dose_date (date) covidvax_dose_4 -> vaccination.fourth_dose_date (date) covidvax_dose_5 -> vaccination.fifth_dose_date (date) covidvax_dose_6 -> vaccination.sixth_dose_date (date) brand_of_covid19_vaccinati -> vaccination.first_dose_brand (list) covid19vax_brand_2 -> vaccination.second_dose_brand (list) covid19vax_brand_3 -> vaccination.third_dose_brand (list) covid19vax_brand_4 -> vaccination.fourth_dose_brand (list) covid19vax_brand_5 -> vaccination.fifth_dose_brand (list) covid19vax_brand_6 -> vaccination.sixth_dose_brand (list) c19vaxd1_adm -> admission.time_since_first_vaccine_dose (name) c19vaxd2_adm -> admission.time_since_second_vaccine_dose (name) c19vaxd3_adm -> admission.time_since_third_vaccine_dose (name) c19vaxd4_adm -> admission.time_since_fourth_vaccine_dose (name) c19vax5_adm -> admission.time_since_fifth_vaccine_dose (name) c19vax6_adm -> admission.time_since_sixth_vaccine_dose (name) flu_date -> vaccination.last_flu_dose_date (date) fluvax_adm_d1 -> admission.time_since_last_flu_vaccine_dose (name) ppv23_date -> vaccination.last_pneumococcal_dose_date (date) ppv23vax_adm_d -> admission.time_since_last_pneumococcal_vaccine_dose (name) c19_variant -> genomic.variant (variant) year -> admission.year (double) study_week -> admission.study_week (double) admission_date -> admission.date (date) hospital -> admin.hospital, toupper (text_to_factor) adm_diagnosis -> admission.presumed_CAP_radiologically_confirmed, admission.presumed_CAP_clinically_confirmed, admission.presumed_CAP_no_radiology, admission.presumed_LRTI, admission.presumed_Empyema_or_abscess, admission.presumed_exacerbation_COPD, admission.presumed_exacerbation_non_COPD, admission.presumed_congestive_heart_failure, admission.presumed_non_infectious_process, admission.presumed_non_LRTI (checkboxes) ics -> admission.on_inhaled_corticosteroids (yesno) immsup -> admission.on_immunosuppression (yesno) psi_class -> admission.pneumonia_severity_index_class (list) crb_test_mai -> admission.curb_65_severity_score (list) news_2_total -> admission.news2_score (name) pulse_ox -> admission.oximetry (name) rr -> admission.respiratory_rate (name) fio2 -> admission.max_oxygen (name) systolic_bp -> admission.systolic_bp (name) diastolic_bp -> admission.diastolic_bp (name) hr -> admission.heart_rate (name) temperature -> admission.temperature (list) symptom_days_preadmit -> admission.duration_symptoms (double) previous_infection -> admission.previous_covid_infection (list) previousinfection_date -> admission.previous_covid_infection_date (date) c19d_preadm -> admission.time_since_covid_diagnosis (name) rockwood -> admission.rockwood_score (name) cci_total_score -> admission.charlson_comorbidity_index (name) height -> admission.height (name) weight -> admission.weight (name) bmi -> admission.BMI (double) first_radio -> admission.cxr_normal, admission.cxr_pneumonia, admission.cxr_heart_failure, admission.cxr_pleural_effusion, admission.cxr_covid_changes, admission.cxr_other (checkboxes) c19_peep -> day_7.max_peep (name) c19_hospadm -> day_7.length_of_stay (list) c17_high -> day_7.max_care_level (list) c19icuon -> day_7.still_on_icu (yesno) c19_icudays -> day_7.icu_length_of_stay (list) c19_vent -> day_7.max_ventilation_level (list) c19_ox -> day_7.max_o2_level (list) c19_ionotropes -> day_7.ionotropes_needed (yesno) c19_complication -> day_7.PE, day_7.DVT, day_7.ARF, day_7.NSTEMI, day_7.STEMI, day_7.cardiac_failure, day_7.new_AF, day_7.new_other_arrythmia, day_7.inpatient_fall, day_7.other_complication, day_7.no_complication (checkboxes) c19_death7d -> day_7.death (yesno) c19_meds -> treatment.dexamethasone, treatment.remdesevir, treatment.tocilizumab, treatment.sarilumab, treatment.in_drug_trial, treatment.no_drug_treatment, treatment.sotrovimab (checkboxes) hospital_length_of_stay -> outcome.length_of_stay (name) survival_days -> outcome.survival_duration (double) ip_death -> outcome.inpatient_death (yesno) days_in_icu -> outcome.icu_duration (double) did_the_patient_have_respi -> outcome.respiratory_support_needed (yesno) number_of_days_of_ventilat -> outcome.ventilator_duration (double) ett_days -> outcome.endotracheal_tube_duration (double) renal_replacement_therapy -> outcome.renal_support_duration (double) complications -> outcome.acute_renal_failure, outcome.liver_dysfunction, outcome.hospital_acquired_infection, outcome.acute_respiratory_distress_syndrome, outcome.NSTEMI, outcome.STEMI, outcome.new_AF, outcome.new_other_arrhthmia, outcome.stroke, outcome.DVT, outcome.PE, outcome.heart_failure, outcome.fall_in_hospital, outcome.reduced_mobility, outcome.increasing_care_requirement, outcome.no_complications (checkboxes) ventilatory_support -> outcome.highest_level_ventilatory_support (list) did_the_patient_receive_ec -> outcome.received_ecmo (yesno) inotropic_support_required -> outcome.received_ionotropes (yesno) lrtd_30d_outcome -> outcome.functional_status (list) fever2 -> symptom.abnormal_temperature (yesno_unknown) pleurtic_cp -> symptom.pleuritic_chest_pain (yesno_unknown) cough2 -> symptom.cough (yesno_unknown) sput_prod -> symptom.productive_sputum (yesno_unknown) dyspnoea -> symptom.dyspnoea (yesno_unknown) tachypnoea2 -> symptom.tachypnoea (yesno_unknown) anosmia -> symptom.anosmia (yesno_unknown) ageusia -> symptom.ageusia (yesno_unknown) dysgeusia -> symptom.dysguesia (yesno_unknown) fever -> symptom.fever (yesno_unknown) hypothermia -> symptom.hypothermia (yesno_unknown) chills -> symptom.chills (yesno_unknown) headache -> symptom.headache (yesno_unknown) malaise -> symptom.malaise (yesno_unknown) wheeze -> symptom.wheeze (yesno_unknown) myalgia -> symptom.myalgia (yesno_unknown) worse_confusion -> symptom.worsening_confusion (yesno_unknown) general_det -> symptom.general_deterioration (yesno_unknown) ox_on_admission -> symptom.oxygen_required_on_admission (yesno_unknown) resp_disease -> comorbid.no_resp_dx, comorbid.copd, comorbid.asthma, comorbid.resp_other (checkboxes) other_respiratory_disease -> comorbid.bronchiectasis, comorbid.interstitial_lung_dx, comorbid.cystic_fibrosis, comorbid.pulmonary_hypertension, comorbid.chronic_pleural_dx, comorbid.other_chronic_resp_dx (checkboxes) chd -> comorbid.no_heart_dx, comorbid.ccf, comorbid.ihd, comorbid.hypertension, comorbid.other_heart_dx (checkboxes) mi -> comorbid.previous_mi (yesno) other_chd -> comorbid.congenital_heart_dx, comorbid.af, comorbid.other_arrythmia, comorbid.pacemaker, comorbid.valvular_heart_dx, comorbid.other_other_heart_dx (checkboxes) diabetes -> comorbid.diabetes (list) dm_meds -> comorbid.diabetes_medications (list) neurological_disease -> comorbid.neuro_other, comorbid.cva, comorbid.tia, comorbid.hemiplegia, comorbid.paraplegia, comorbid.no_neuro_dx (checkboxes) dementia -> comorbid.no_dementia, comorbid.dementia, comorbid.cognitive_impairment (checkboxes) cancer -> comorbid.solid_cancer (list) haem_malig -> comorbid.no_haemotological_cancer, comorbid.leukaemia, comorbid.lymphoma (checkboxes) ckd -> comorbid.ckd (list) liver_disease -> comorbid.liver_disease (list) gastric_ulcers -> comorbid.gastric_ulcers (yesno) pvd -> comorbid.periph_vasc_dx (yesno) ctd -> comorbid.connective_tissue_dx (yesno) immunodeficiency -> comorbid.immunodeficiency (yesno) other_pn_disease -> comorbid.other_pneumococcal_risks (yesno) transplant -> comorbid.transplant_recipient (yesno) pregnancy -> comorbid.pregnancy (list) hiv -> comorbid.no_HIV, comorbid.HIV, comorbid.AIDS (checkboxes) final_soc_lrtd_diagnosis -> diagnosis.SOC_CAP_radiologically_confirmed, diagnosis.SOC_CAP_clinically_confirmed, diagnosis.SOC_CAP_no_radiology, diagnosis.SOC_LRTI, diagnosis.SOC_Empyema_or_abscess, diagnosis.SOC_exacerbation_COPD, diagnosis.SOC_exacerbation_non_COPD, diagnosis.SOC_congestive_heart_failure, diagnosis.SOC_non_infectious_process, diagnosis.SOC_non_LRTI (checkboxes) covid_19_diagnosis -> diagnosis.covid_19_diagnosis (list) ppv23 -> vaccination.pneumovax (list) flu_vaccine -> vaccination.influenza_vaccination (list)","code":""},{"path":"/reference/map_avoncap_central.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Core avoncap normalisation — map_avoncap_central","text":"","code":"map_avoncap_central()"},{"path":"/reference/map_avoncap_central.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Core avoncap normalisation — map_avoncap_central","text":"list","code":""},{"path":"/reference/map_avoncap_consent.html","id":null,"dir":"Reference","previous_headings":"","what":"Core avoncap consent — map_avoncap_consent","title":"Core avoncap consent — map_avoncap_consent","text":"consented -> admin.consented (list) ppc -> admin.pp_consented (list) withdrawal -> admin.withdrawal (yesno) consent_urine -> admin.consent_for_urine (yesno) consent_blood -> admin.consent_for_blood (yesno) consent_resp_samples1 -> admin.consent_for_respiratory_samples (yesno)","code":""},{"path":"/reference/map_avoncap_consent.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Core avoncap consent — map_avoncap_consent","text":"","code":"map_avoncap_consent()"},{"path":"/reference/map_avoncap_consent.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Core avoncap consent — map_avoncap_consent","text":"list","code":""},{"path":"/reference/map_avoncap_haem.html","id":null,"dir":"Reference","previous_headings":"","what":"Normalise the avoncap data haematology data — map_avoncap_haem","title":"Normalise the avoncap data haematology data — map_avoncap_haem","text":"record_number -> admin.record_number (name) ac_study_number -> admin.consented_record_number (study_id) ph_7_35 -> haem.blood_gas_ph (double) glucose -> haem.glucose (double) albumin -> haem.albumin (double) wcc -> haem.white_cell_count (double) eos -> haem.eosinophils (double) hb -> haem.haemoglobin (double) haematocrit -> haem.haemotocrit (double) pmn -> haem.neutrophils (double) lymphocytes -> haem.lymphocytes (double) crp -> haem.crp (double) na_result -> haem.sodium (double) ur_result -> haem.urea (double) egfr -> haem.egfr (double) sars_cov2_antigen -> haem.sars_cov2_antigen (trunc_double) ferritin -> haem.ferritin (double) troponin -> haem.troponin (double) nt_probnp -> haem.pro_bnp (double) d_dimer -> haem.d_dimer (double) patient_blood_group -> haem.blood_group (list)","code":""},{"path":"/reference/map_avoncap_haem.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Normalise the avoncap data haematology data — map_avoncap_haem","text":"","code":"map_avoncap_haem()"},{"path":"/reference/map_avoncap_haem.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Normalise the avoncap data haematology data — map_avoncap_haem","text":"list","code":""},{"path":"/reference/map_avoncap_micro.html","id":null,"dir":"Reference","previous_headings":"","what":"Normalise the avoncap data microbiology data — map_avoncap_micro","title":"Normalise the avoncap data microbiology data — map_avoncap_micro","text":"microtest_done -> micro.test_performed (yesno) microtest_date -> micro.test_date (date) microday -> micro.test_days_from_admission (pos_integer) micro_test -> micro.test_type (list) micro_isolates -> micro.pathogen_detected (yesno_unknown) isolate_identified -> micro.pathogen, .micro_isolate_list (checkboxes_to_nested_list) pn_result -> micro.pneumo_serotype_status (list) pn_st -> micro.pneumo_serotype (pneumo_serotype) micro_lab -> micro.sent_to_central_lab (yesno_unknown) pen_susceptibility -> micro.penicillin_susceptibility (checkboxes_to_list) septrin_susceptibility -> micro.septrin_susceptibility (checkboxes_to_list) doxy_susceptibility -> micro.doxycycline_susceptibility (checkboxes_to_list) levoflox_suscept -> micro.levofloxacin_susceptibility (checkboxes_to_list) cef_susceptibility -> micro.ceftriaxone_susceptibility (checkboxes_to_list) pn_uat_result -> micro.pneumo_binax_now (list) lg_uat_result -> micro.pneumo_legionella_uat (list) micro_final_report -> micro.is_final_report (yesno)","code":""},{"path":"/reference/map_avoncap_micro.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Normalise the avoncap data microbiology data — map_avoncap_micro","text":"","code":"map_avoncap_micro(instrument)"},{"path":"/reference/map_avoncap_micro.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Normalise the avoncap data microbiology data — map_avoncap_micro","text":"instrument numeric instrument number","code":""},{"path":"/reference/map_avoncap_micro.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Normalise the avoncap data microbiology data — map_avoncap_micro","text":"list","code":""},{"path":"/reference/map_avoncap_pneumococcal.html","id":null,"dir":"Reference","previous_headings":"","what":"Normalise the avoncap pneumococcal data — map_avoncap_pneumococcal","title":"Normalise the avoncap pneumococcal data — map_avoncap_pneumococcal","text":"participant_number -> admin.record_number (name) hospital -> admin.hospital (list) nhs_number -> admin.patient_identifier (ppi) age_at_admission -> demog.age (double) sex -> demog.gender (list) test_date -> pneumo.test_date (date) test -> pneumo.test_type (list) serotype -> pneumo.phe_serotype (pneumo_serotype) smoker -> demog.smoker (list) resp_disease -> comorbid.no_resp_dx, comorbid.copd, comorbid.asthma, comorbid.bronchiectasis, comorbid.pulmonary_fibrosis, comorbid.resp_other (checkboxes) chd -> comorbid.no_heart_dx, comorbid.ccf, comorbid.ihd, comorbid.hypertension, comorbid.af, comorbid.other_heart_dx (checkboxes) mi -> comorbid.previous_mi (yesno) ckd -> comorbid.ckd (list) liver_disease -> comorbid.liver_disease (list) diabetes -> comorbid.diabetes (list) dm_meds -> comorbid.diabetes_medications (list) dementia -> comorbid.no_dementia, comorbid.dementia, comorbid.cognitive_impairment (checkboxes) neurological_disease -> comorbid.neuro_other, comorbid.cva, comorbid.tia, comorbid.hemiplegia, comorbid.paraplegia, comorbid.no_neuro_dx (checkboxes) gastric_ulcers -> comorbid.gastric_ulcers (yesno) dysphagia -> comorbid.dysphagia (yesno) pvd -> comorbid.periph_vasc_dx (yesno) ctd -> comorbid.connective_tissue_dx (yesno) immunodeficiency -> comorbid.immunodeficiency (yesno) other_pn_disease -> comorbid.other_pneumococcal_risks (yesno) hiv -> comorbid.no_HIV, comorbid.HIV, comorbid.AIDS (checkboxes) cancer -> comorbid.solid_cancer (list) haem_malig -> comorbid.no_haemotological_cancer, comorbid.leukaemia, comorbid.lymphoma (checkboxes) recent_chemo -> comorbid.recent_chemotherapy (yesno) recent_radiotherapy -> comorbid.recent_radiotherapy (yesno) transplant -> comorbid.transplant_recipient (yesno) pregnancy -> comorbid.pregnancy (list) drugs -> demog.no_drug_abuse, demog.alcohol_abuse, demog.ivdu_abuse, demog.marijuana_abuse, demog.other_inhaled_drug_abuse (checkboxes) immsup -> admission.on_immunosuppression (yesno) weight_problem -> comorbid.bmi_status (list) concomittant_flu -> comorbid.influenza_infection (yesno) hcv -> comorbid.hepatitis_c (yesno) ppv23 -> vaccination.ppv23_vaccination (list) flu_vaccine -> vaccination.flu (list) cci_total_score -> admission.charlson_comorbidity_index (name) los_days -> outcome.length_of_stay (double) amts -> admission.triage_score (list) resp_rate -> admission.respiratory_rate (double) sats_ra -> admission.saturations_on_room_air (double) systolic_bp -> admission.systolic_bp (double) diastolic_bp -> admission.diastolic_bp (double) crb65_score -> admission.crb65 (double) curb65_score -> admission.curb65 (double) antibiotic_route -> outcome.antibiotic_route (list) antibiotic_days -> outcome.antibiotic_duration (double) infection_site -> admission.infection_site (list) deranged_lfts -> outcome.abnormal_lft (yesno) aki -> outcome.acute_kidney_injury (yesno) pleural_effusion -> outcome.pleural_effusion (yesno) empyema -> outcome.empyema (yesno) discharge_destination -> outcome.discharge_to (list) icu -> outcome.admitted_icu (yesno) niv -> outcome.non_invasive_ventilation (yesno) intubation -> outcome.intubation (yesno) recurrent_pneumonia -> outcome.recurrent_pneumonia (yesno) ecmo -> outcome.received_ecmo (yesno) inotropes -> outcome.received_ionotropes (yesno) trachy -> outcome.tracheostomy (yesno) inpatient_death -> outcome.inpatient_death (yesno) death_30days -> outcome.death_within_30_days (yesno) death_1year -> outcome.death_within_1_year (yesno) survival_days -> outcome.survival_duration (name) albumin -> haem.albumin (double) wcc -> haem.white_cell_count (double) hb -> haem.haemoglobin (double) pmn -> haem.neutrophils (double) lymphocytes -> haem.lymphocytes (double) crp -> haem.crp (double) na_result -> haem.sodium (double) ur_result -> haem.urea (double) egfr -> haem.egfr (double) creatinine -> haem.creatinine (double) cxr_sides -> radio.cxr_infection (list) cxr_lobes -> radio.cxr_lobar_changes (list) death_5year -> outcome.death_within_5_years (yesno) survival_days_2 -> outcome.5_yr_survival_duration (name) imd_decile -> demog.imd_decile (name)","code":""},{"path":"/reference/map_avoncap_pneumococcal.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Normalise the avoncap pneumococcal data — map_avoncap_pneumococcal","text":"","code":"map_avoncap_pneumococcal()"},{"path":"/reference/map_avoncap_pneumococcal.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Normalise the avoncap pneumococcal data — map_avoncap_pneumococcal","text":"list","code":""},{"path":"/reference/map_avoncap_radio.html","id":null,"dir":"Reference","previous_headings":"","what":"Normalise the avoncap data radiology data — map_avoncap_radio","title":"Normalise the avoncap data radiology data — map_avoncap_radio","text":"radio_exam -> radio.test_performed (yesno) radiology_date -> radio.test_date (date) radiodays -> radio.test_days_from_admission (pos_integer) radio_test -> radio.test_type (list) radiology_result -> radio.alrtd_finding (checkboxes_to_nested_list) radiology_other_result -> radio.non_alrtd_finding (checkboxes_to_nested_list)","code":""},{"path":"/reference/map_avoncap_radio.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Normalise the avoncap data radiology data — map_avoncap_radio","text":"","code":"map_avoncap_radio(instrument)"},{"path":"/reference/map_avoncap_radio.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Normalise the avoncap data radiology data — map_avoncap_radio","text":"instrument numeric instrument number","code":""},{"path":"/reference/map_avoncap_radio.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Normalise the avoncap data radiology data — map_avoncap_radio","text":"list","code":""},{"path":"/reference/map_avoncap_virol.html","id":null,"dir":"Reference","previous_headings":"","what":"Normalise the avoncap data virology data — map_avoncap_virol","title":"Normalise the avoncap data virology data — map_avoncap_virol","text":"viral_testing_performed -> virol.test_performed (yesno) virology_date_of_asst -> virol.test_date (date) viroldays -> virol.test_days_from_admission (pos_integer) specimen_type -> virol.test_type (list) virus_isolated -> virol.pathogen_detected (yesno) test_type -> virol.test_type (list) virus_pathogen -> virol.pathogen, .virol_isolate_list (checkboxes_to_nested_list) virol_patient_lab -> virol.test_provenance (list)","code":""},{"path":"/reference/map_avoncap_virol.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Normalise the avoncap data virology data — map_avoncap_virol","text":"","code":"map_avoncap_virol(instrument)"},{"path":"/reference/map_avoncap_virol.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Normalise the avoncap data virology data — map_avoncap_virol","text":"instrument numeric instrument number","code":""},{"path":"/reference/map_avoncap_virol.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Normalise the avoncap data virology data — map_avoncap_virol","text":"list","code":""},{"path":"/reference/map_urine_antigens.html","id":null,"dir":"Reference","previous_headings":"","what":"Normalise the urinary antigen data — map_urine_antigens","title":"Normalise the urinary antigen data — map_urine_antigens","text":"RESULT -> pneumo.urine_antigen_result, .x (text) EVENT_DATE -> pneumo.test_date (date) ANALYSIS -> pneumo.urine_antigen_test (name) SUBJECT -> admin.consented_record_number (study_id) BARCODE -> pneumo.urine_antigen_sample_id (name)","code":""},{"path":"/reference/map_urine_antigens.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Normalise the urinary antigen data — map_urine_antigens","text":"","code":"map_urine_antigens()"},{"path":"/reference/map_urine_antigens.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Normalise the urinary antigen data — map_urine_antigens","text":"list","code":""},{"path":"/reference/map_urine_binax.html","id":null,"dir":"Reference","previous_headings":"","what":"Normalise the urinary antigen data (binax results) — map_urine_binax","title":"Normalise the urinary antigen data (binax results) — map_urine_binax","text":"RESULT -> pneumo.binax_result, .x (text) EVENT_DATE -> pneumo.test_date (date) SUBJECT -> admin.consented_record_number (study_id) BARCODE -> pneumo.urine_antigen_sample_id (name)","code":""},{"path":"/reference/map_urine_binax.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Normalise the urinary antigen data (binax results) — map_urine_binax","text":"","code":"map_urine_binax()"},{"path":"/reference/map_urine_binax.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Normalise the urinary antigen data (binax results) — map_urine_binax","text":"list","code":""},{"path":"/reference/most_recent_files.html","id":null,"dir":"Reference","previous_headings":"","what":"find most recent files of a specific type — most_recent_files","title":"find most recent files of a specific type — most_recent_files","text":"find recent files specific type","code":""},{"path":"/reference/most_recent_files.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"find most recent files of a specific type — most_recent_files","text":"","code":"most_recent_files(   type = \"\",   subtype = NULL,   reproduce_at = as.Date(getOption(\"reproduce.at\", default = Sys.Date())) )"},{"path":"/reference/most_recent_files.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"find most recent files of a specific type — most_recent_files","text":"type see valid_inputs() current list supported types input directory subtype see valid_inputs() list supported filenames reproduce_at date new files ignored. enforces specific version data.","code":""},{"path":"/reference/most_recent_files.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"find most recent files of a specific type — most_recent_files","text":"list file paths date files given type relevant site study year","code":""},{"path":"/reference/most_recent_files.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"find most recent files of a specific type — most_recent_files","text":"","code":"# devtools::load_all()  avoncap::set_input(\"~/Data/avoncap\") #> Found data directory: /home/vp22681/Data/avoncap #> /home/vp22681/Data/avoncap avoncap::input(\"nhs-extract\") #> /home/vp22681/Data/avoncap/nhs-extract  avoncap::all_files() #> # A tibble: 76 × 7 #>    filename     directory     path       date       hospital study_year filetype #>    <chr>        <chr>         <fs::path> <date>     <chr>         <int> <chr>    #>  1 central_y1   avoncap-expo… …al_y1.csv 2022-03-22 NA                1 csv      #>  2 central_y2   avoncap-expo… …al_y2.csv 2022-03-22 NA                2 csv      #>  3 central_y1   avoncap-expo… …al_y1.csv 2022-06-20 NA                1 csv      #>  4 central_y2   avoncap-expo… …al_y2.csv 2022-06-20 NA                2 csv      #>  5 central_y1   avoncap-expo… …al_y1.csv 2022-07-11 NA                1 csv      #>  6 central_y2   avoncap-expo… …al_y2.csv 2022-07-11 NA                2 csv      #>  7 central_y1   avoncap-expo… …al_y1.csv 2022-09-21 NA                1 csv      #>  8 central_y2   avoncap-expo… …al_y2.csv 2022-09-21 NA                2 csv      #>  9 uad-controls avoncap-expo… …trols.csv 2022-10-07 NA               NA csv      #> 10 central_y1   avoncap-expo… …al_y1.csv 2022-11-09 NA                1 csv      #> # ℹ 66 more rows   # exact match on filename column of all_data() avoncap::most_recent_files(\"AvonCAPLRTDCentralDa\") #> # A tibble: 0 × 7 #> # ℹ 7 variables: filename <chr>, directory <chr>, path <fs::path>, date <date>, #> #   hospital <chr>, study_year <int>, filetype <chr>   # or matches by lower case startWith on directory avoncap::most_recent_files(\"nhs-extract\",\"deltave\") #> # A tibble: 6 × 7 #>   filename       directory   path        date       hospital study_year filetype #>   <chr>          <chr>       <fs::path>  <date>     <chr>         <int> <chr>    #> 1 deltave_BRI_y1 nhs-extract …BRI_y1.csv 2022-12-07 BRI               1 csv      #> 2 deltave_BRI_y2 nhs-extract …BRI_y2.csv 2022-12-07 BRI               2 csv      #> 3 deltave_BRI_y3 nhs-extract …BRI_y3.csv 2022-12-07 BRI               3 csv      #> 4 deltave_NBT_y1 nhs-extract …NBT_y1.csv 2022-12-07 NBT               1 csv      #> 5 deltave_NBT_y2 nhs-extract …NBT_y2.csv 2022-12-07 NBT               2 csv      #> 6 deltave_NBT_y3 nhs-extract …NBT_y3.csv 2022-12-07 NBT               3 csv        avoncap::most_recent_files(\"metadata\") #> # A tibble: 5 × 7 #>   filename     directory path            date       hospital study_year filetype #>   <chr>        <chr>     <fs::path>      <date>     <chr>         <int> <chr>    #> 1 central_y1   metadata  …central_y1.csv 2022-10-24 NA                1 csv      #> 2 central_y2   metadata  …central_y2.csv 2022-10-24 NA                2 csv      #> 3 central_y3   metadata  …central_y3.csv 2022-10-24 NA                3 csv      #> 4 uad-controls metadata  …d-controls.csv 2022-10-24 NA               NA csv      #> 5 pneumococcal metadata  …eumococcal.csv 2022-11-29 NA               NA csv       avoncap::valid_inputs() #> # A tibble: 24 × 3 #> # Groups:   type [6] #>    type           subtype      file         #>    <chr>          <chr>        <chr>        #>  1 avoncap-export central      central_y1   #>  2 avoncap-export central      central_y2   #>  3 avoncap-export uad-controls uad-controls #>  4 avoncap-export central      central_y3   #>  5 avoncap-export gp           gp           #>  6 ethnicity      NA           y1           #>  7 ethnicity      NA           y2           #>  8 ethnicity      NA           y3           #>  9 metadata       central      central_y1   #> 10 metadata       central      central_y2   #> # ℹ 14 more rows"},{"path":"/reference/normalise_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Sanitise AvonCap data columns — normalise_data","title":"Sanitise AvonCap data columns — normalise_data","text":"AvonCap data lots columns named difficult remember fashion, composed data items enumerated values semantics. makes displaying difficult filtering done raw data inscrutable. Depending source data different columns may present due differences NHS UoB data sets. redcap database options may checklists radio buttons, end mysterious names data.","code":""},{"path":"/reference/normalise_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sanitise AvonCap data columns — normalise_data","text":"","code":"normalise_data(rawData, instrument = NULL, ...)"},{"path":"/reference/normalise_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Sanitise AvonCap data columns — normalise_data","text":"rawData raw data load_data() instrument numeric instrument number applicable ... Arguments passed normalise_generic remove_mapped gets rid original columns mapping (leaving new versions) remove_unmapped gets rid columns mapping mappings set mappings (see zzz-avoncap-mappings.R) messages set dtrackr glue specs populate first box fo flow chart. (can use {files}, {reproduce_at}, {date}, {.total}) data_source_info null filename, function write file details input files used.","code":""},{"path":"/reference/normalise_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Sanitise AvonCap data columns — normalise_data","text":"tracked dataframe ","code":""},{"path":"/reference/normalise_data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Sanitise AvonCap data columns — normalise_data","text":"function maps data tidy dataframe consistently named columns, named factors appropriate. present data ethnicity files sanitisation code held zzz-avoncap-mappings.R file.","code":""},{"path":"/reference/normalise_generic.html","id":null,"dir":"Reference","previous_headings":"","what":"Sanitise RedCap data columns — normalise_generic","title":"Sanitise RedCap data columns — normalise_generic","text":"redcap database options may checklists radio buttons, end mysterious names data.","code":""},{"path":"/reference/normalise_generic.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sanitise RedCap data columns — normalise_generic","text":"","code":"normalise_generic(   rawData,   mappings,   remove_mapped = TRUE,   remove_unmapped = TRUE,   messages = c(\"files: {files}\", \"{.total} rows\", \"files from: {date}\"),   data_source_info = NULL,   ... )"},{"path":"/reference/normalise_generic.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Sanitise RedCap data columns — normalise_generic","text":"rawData raw data load_data() mappings set mappings (see zzz-avoncap-mappings.R) remove_mapped gets rid original columns mapping (leaving new versions) remove_unmapped gets rid columns mapping messages set dtrackr glue specs populate first box fo flow chart. (can use {files}, {reproduce_at}, {date}, {.total}) data_source_info null filename, function write file details input files used. ... passed onto .cached(...). e.g. nocache = TRUE can used defeat caching.","code":""},{"path":"/reference/normalise_generic.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Sanitise RedCap data columns — normalise_generic","text":"tracked dataframe ","code":""},{"path":"/reference/normalise_generic.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Sanitise RedCap data columns — normalise_generic","text":"function maps data tidy dataframe consistently named columns, named factors appropriate. present data ethnicity","code":""},{"path":"/reference/original_field_names.html","id":null,"dir":"Reference","previous_headings":"","what":"Get the mapping of transformed columns back to original — original_field_names","title":"Get the mapping of transformed columns back to original — original_field_names","text":"Get mapping transformed columns back original","code":""},{"path":"/reference/original_field_names.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get the mapping of transformed columns back to original — original_field_names","text":"","code":"original_field_names(data, inverse = TRUE)"},{"path":"/reference/original_field_names.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get the mapping of transformed columns back to original — original_field_names","text":"data transformed data set. inverse give data old -> new mapping finding normalised names original columns. false gives new->old finding original names normalised columns","code":""},{"path":"/reference/original_field_names.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get the mapping of transformed columns back to original — original_field_names","text":"named list mapping original new columns","code":""},{"path":"/reference/pipe.html","id":null,"dir":"Reference","previous_headings":"","what":"Pipe operator — %>%","title":"Pipe operator — %>%","text":"See magrittr::%>% details.","code":""},{"path":"/reference/pipe.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Pipe operator — %>%","text":"","code":"lhs %>% rhs"},{"path":"/reference/pipe.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Pipe operator — %>%","text":"lhs value magrittr placeholder. rhs function call using magrittr semantics.","code":""},{"path":"/reference/pipe.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Pipe operator — %>%","text":"result calling rhs(lhs).","code":""},{"path":"/reference/readable_label.html","id":null,"dir":"Reference","previous_headings":"","what":"Get a label for a column — readable_label","title":"Get a label for a column — readable_label","text":"Get label column","code":""},{"path":"/reference/readable_label.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get a label for a column — readable_label","text":"","code":"readable_label(columnVar, colNames = default_column_names())"},{"path":"/reference/readable_label.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get a label for a column — readable_label","text":"columnVar column name string colNames bespoke column names mapping (see default_column_names(...))","code":""},{"path":"/reference/readable_label.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get a label for a column — readable_label","text":"mapped column name","code":""},{"path":"/reference/readable_label_mapping.html","id":null,"dir":"Reference","previous_headings":"","what":"Get a readable label for the AvonCap data as a named list (for ggplot) — readable_label_mapping","title":"Get a readable label for the AvonCap data as a named list (for ggplot) — readable_label_mapping","text":"Get readable label AvonCap data named list (ggplot)","code":""},{"path":"/reference/readable_label_mapping.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get a readable label for the AvonCap data as a named list (for ggplot) — readable_label_mapping","text":"","code":"readable_label_mapping(x, ...)  # S3 method for data.frame readable_label_mapping(x, colNames = default_column_names(...), ...)  # S3 method for list readable_label_mapping(x, colNames = default_column_names(...), ...)  # S3 method for character readable_label_mapping(x, colNames = default_column_names(...), ...)  # S3 method for default readable_label_mapping(x, colNames = default_column_names(...), ...)"},{"path":"/reference/readable_label_mapping.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get a readable label for the AvonCap data as a named list (for ggplot) — readable_label_mapping","text":"x either column names strings, dataframe ... ignored colNames mapping convert column name (string) readable label","code":""},{"path":"/reference/readable_label_mapping.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get a readable label for the AvonCap data as a named list (for ggplot) — readable_label_mapping","text":"named list labels columns","code":""},{"path":"/reference/readable_label_mapping.html","id":"methods-by-class-","dir":"Reference","previous_headings":"","what":"Methods (by class)","title":"Get a readable label for the AvonCap data as a named list (for ggplot) — readable_label_mapping","text":"readable_label_mapping(data.frame): data frames readable_label_mapping(list): lists readable_label_mapping(character): character vectors readable_label_mapping(default): defaults","code":""},{"path":"/reference/save_data_source_info.html","id":null,"dir":"Reference","previous_headings":"","what":"Write file source information out to a text files — save_data_source_info","title":"Write file source information out to a text files — save_data_source_info","text":"Write file source information text files","code":""},{"path":"/reference/save_data_source_info.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Write file source information out to a text files — save_data_source_info","text":"","code":"save_data_source_info(..., .file)"},{"path":"/reference/save_data_source_info.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Write file source information out to a text files — save_data_source_info","text":"... list data frames loaded load_data(...) call .file output file location","code":""},{"path":"/reference/save_data_source_info.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Write file source information out to a text files — save_data_source_info","text":"file name written (invisibly)","code":""},{"path":"/reference/serotype_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Pneumococcal UAD serotype groups and crossmaps — serotype_data","title":"Pneumococcal UAD serotype groups and crossmaps — serotype_data","text":"list pneumococcal serotype / UAD cross mappings","code":""},{"path":"/reference/serotype_pcv_map.html","id":null,"dir":"Reference","previous_headings":"","what":"Pneumococcal serotype PCV groups — serotype_pcv_map","title":"Pneumococcal serotype PCV groups — serotype_pcv_map","text":"Pneumococcal serotype PCV groups","code":""},{"path":"/reference/serotype_uad_map.html","id":null,"dir":"Reference","previous_headings":"","what":"Serotype UAD mappings — serotype_uad_map","title":"Serotype UAD mappings — serotype_uad_map","text":"Serotype UAD mappings","code":""},{"path":"/reference/set_input.html","id":null,"dir":"Reference","previous_headings":"","what":"Sets the location of data for an analysis — set_input","title":"Sets the location of data for an analysis — set_input","text":"Also performs structure checks makes sure README files place.","code":""},{"path":"/reference/set_input.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sets the location of data for an analysis — set_input","text":"","code":"set_input(path)"},{"path":"/reference/set_input.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Sets the location of data for an analysis — set_input","text":"path path input directory","code":""},{"path":"/reference/set_input.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Sets the location of data for an analysis — set_input","text":"full path directory","code":""},{"path":"/reference/stacked_barplot.html","id":null,"dir":"Reference","previous_headings":"","what":"Stacked bar plot — stacked_barplot","title":"Stacked bar plot — stacked_barplot","text":"function plots stacked bar proportions input set data","code":""},{"path":"/reference/stacked_barplot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Stacked bar plot — stacked_barplot","text":"","code":"stacked_barplot(data, mapping, ...)"},{"path":"/reference/stacked_barplot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Stacked bar plot — stacked_barplot","text":"data data mapping aes mapping least x fill. facetting group must contain facet variable ... passed geom_bar","code":""},{"path":"/reference/stacked_barplot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Stacked bar plot — stacked_barplot","text":"ggplot","code":""},{"path":"/reference/stacked_barplot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Stacked bar plot — stacked_barplot","text":"","code":"stacked_barplot(     ggplot2::diamonds,     ggplot2::aes(x=cut, fill=clarity, group=color)   )+   ggplot2::facet_wrap(dplyr::vars(color))"},{"path":"/reference/start_date_of_week.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert a study week back into a date — start_date_of_week","title":"Convert a study week back into a date — start_date_of_week","text":"poorly named give start date input integer","code":""},{"path":"/reference/start_date_of_week.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert a study week back into a date — start_date_of_week","text":"","code":"start_date_of_week(study_week)"},{"path":"/reference/start_date_of_week.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert a study week back into a date — start_date_of_week","text":"study_week accept decimals returns nearest whole date value","code":""},{"path":"/reference/start_date_of_week.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert a study week back into a date — start_date_of_week","text":"vector sudy_week numbers","code":""},{"path":"/reference/study_week.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert a date to a study week — study_week","title":"Convert a date to a study week — study_week","text":"Convert date study week","code":""},{"path":"/reference/study_week.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert a date to a study week — study_week","text":"","code":"study_week(dates)"},{"path":"/reference/study_week.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert a date to a study week — study_week","text":"dates list date objects","code":""},{"path":"/reference/study_week.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert a date to a study week — study_week","text":"integer number weeks since 2019-12-30","code":""},{"path":"/reference/uad_groups.html","id":null,"dir":"Reference","previous_headings":"","what":"UAD serotype groups — uad_groups","title":"UAD serotype groups — uad_groups","text":"UAD serotype groups","code":""},{"path":"/reference/uad_pcv_map.html","id":null,"dir":"Reference","previous_headings":"","what":"UAD PCV map — uad_pcv_map","title":"UAD PCV map — uad_pcv_map","text":"UAD PCV map","code":""},{"path":"/reference/upset_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"Upset plot with counts stratified by a categorical column — upset_plot","title":"Upset plot with counts stratified by a categorical column — upset_plot","text":"Upset plot counts stratified categorical column","code":""},{"path":"/reference/upset_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Upset plot with counts stratified by a categorical column — upset_plot","text":"","code":"upset_plot(df, boolean_cols, categorical_col, lbl_size = 5)"},{"path":"/reference/upset_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Upset plot with counts stratified by a categorical column — upset_plot","text":"df data boolean_cols tidyselect specification selecting columns used binary one-hot encoded classes categorical_col column containing disjoint category factor lbl_size font sise label","code":""},{"path":"/reference/upset_plot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Upset plot with counts stratified by a categorical column — upset_plot","text":"ggplot","code":""},{"path":"/reference/valid_inputs.html","id":null,"dir":"Reference","previous_headings":"","what":"A valid set of types of file that can be loaded by load_data(...) — valid_inputs","title":"A valid set of types of file that can be loaded by load_data(...) — valid_inputs","text":"valid set types file can loaded load_data(...)","code":""},{"path":"/reference/valid_inputs.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A valid set of types of file that can be loaded by load_data(...) — valid_inputs","text":"","code":"valid_inputs()"},{"path":"/reference/valid_inputs.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"A valid set of types of file that can be loaded by load_data(...) — valid_inputs","text":"dataframe type, subtype","code":""},{"path":"/reference/valid_inputs.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"A valid set of types of file that can be loaded by load_data(...) — valid_inputs","text":"","code":"# devtools::load_all()  avoncap::set_input(\"~/Data/avoncap\") #> Found data directory: /home/vp22681/Data/avoncap #> /home/vp22681/Data/avoncap avoncap::input(\"nhs-extract\") #> /home/vp22681/Data/avoncap/nhs-extract  avoncap::all_files() #> # A tibble: 76 × 7 #>    filename     directory     path       date       hospital study_year filetype #>    <chr>        <chr>         <fs::path> <date>     <chr>         <int> <chr>    #>  1 central_y1   avoncap-expo… …al_y1.csv 2022-03-22 NA                1 csv      #>  2 central_y2   avoncap-expo… …al_y2.csv 2022-03-22 NA                2 csv      #>  3 central_y1   avoncap-expo… …al_y1.csv 2022-06-20 NA                1 csv      #>  4 central_y2   avoncap-expo… …al_y2.csv 2022-06-20 NA                2 csv      #>  5 central_y1   avoncap-expo… …al_y1.csv 2022-07-11 NA                1 csv      #>  6 central_y2   avoncap-expo… …al_y2.csv 2022-07-11 NA                2 csv      #>  7 central_y1   avoncap-expo… …al_y1.csv 2022-09-21 NA                1 csv      #>  8 central_y2   avoncap-expo… …al_y2.csv 2022-09-21 NA                2 csv      #>  9 uad-controls avoncap-expo… …trols.csv 2022-10-07 NA               NA csv      #> 10 central_y1   avoncap-expo… …al_y1.csv 2022-11-09 NA                1 csv      #> # ℹ 66 more rows   # exact match on filename column of all_data() avoncap::most_recent_files(\"AvonCAPLRTDCentralDa\") #> # A tibble: 0 × 7 #> # ℹ 7 variables: filename <chr>, directory <chr>, path <fs::path>, date <date>, #> #   hospital <chr>, study_year <int>, filetype <chr>   # or matches by lower case startWith on directory avoncap::most_recent_files(\"nhs-extract\",\"deltave\") #> # A tibble: 6 × 7 #>   filename       directory   path        date       hospital study_year filetype #>   <chr>          <chr>       <fs::path>  <date>     <chr>         <int> <chr>    #> 1 deltave_BRI_y1 nhs-extract …BRI_y1.csv 2022-12-07 BRI               1 csv      #> 2 deltave_BRI_y2 nhs-extract …BRI_y2.csv 2022-12-07 BRI               2 csv      #> 3 deltave_BRI_y3 nhs-extract …BRI_y3.csv 2022-12-07 BRI               3 csv      #> 4 deltave_NBT_y1 nhs-extract …NBT_y1.csv 2022-12-07 NBT               1 csv      #> 5 deltave_NBT_y2 nhs-extract …NBT_y2.csv 2022-12-07 NBT               2 csv      #> 6 deltave_NBT_y3 nhs-extract …NBT_y3.csv 2022-12-07 NBT               3 csv        avoncap::most_recent_files(\"metadata\") #> # A tibble: 5 × 7 #>   filename     directory path            date       hospital study_year filetype #>   <chr>        <chr>     <fs::path>      <date>     <chr>         <int> <chr>    #> 1 central_y1   metadata  …central_y1.csv 2022-10-24 NA                1 csv      #> 2 central_y2   metadata  …central_y2.csv 2022-10-24 NA                2 csv      #> 3 central_y3   metadata  …central_y3.csv 2022-10-24 NA                3 csv      #> 4 uad-controls metadata  …d-controls.csv 2022-10-24 NA               NA csv      #> 5 pneumococcal metadata  …eumococcal.csv 2022-11-29 NA               NA csv       avoncap::valid_inputs() #> # A tibble: 24 × 3 #> # Groups:   type [6] #>    type           subtype      file         #>    <chr>          <chr>        <chr>        #>  1 avoncap-export central      central_y1   #>  2 avoncap-export central      central_y2   #>  3 avoncap-export uad-controls uad-controls #>  4 avoncap-export central      central_y3   #>  5 avoncap-export gp           gp           #>  6 ethnicity      NA           y1           #>  7 ethnicity      NA           y2           #>  8 ethnicity      NA           y3           #>  9 metadata       central      central_y1   #> 10 metadata       central      central_y2   #> # ℹ 14 more rows"},{"path":"/reference/validate_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Validate AvonCap raw data — validate_data","title":"Validate AvonCap raw data — validate_data","text":"Runs set QA checks","code":""},{"path":"/reference/validate_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Validate AvonCap raw data — validate_data","text":"","code":"validate_data(rawData, ...)"},{"path":"/reference/validate_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Validate AvonCap raw data — validate_data","text":"rawData raw data load_data() ... Arguments passed normalise_generic remove_mapped gets rid original columns mapping (leaving new versions) remove_unmapped gets rid columns mapping mappings set mappings (see zzz-avoncap-mappings.R) messages set dtrackr glue specs populate first box fo flow chart. (can use {files}, {reproduce_at}, {date}, {.total}) data_source_info null filename, function write file details input files used.","code":""},{"path":"/reference/validate_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Validate AvonCap raw data — validate_data","text":"tracked dataframe ","code":""},{"path":"/reference/validate_data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Validate AvonCap raw data — validate_data","text":"files sanitisation code held zzz-avoncap-mappings.R file.","code":""},{"path":"/reference/write_issues.html","id":null,"dir":"Reference","previous_headings":"","what":"Write out data quality issues — write_issues","title":"Write out data quality issues — write_issues","text":"Write data quality issues","code":""},{"path":"/reference/write_issues.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Write out data quality issues — write_issues","text":"","code":"write_issues(df, file)"},{"path":"/reference/write_issues.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Write out data quality issues — write_issues","text":"df raw data frame file output data quality file","code":""},{"path":"/reference/write_issues.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Write out data quality issues — write_issues","text":"list failures dataframe","code":""},{"path":"/reference/xglimpse.html","id":null,"dir":"Reference","previous_headings":"","what":"Wrapper around table — xglimpse","title":"Wrapper around table — xglimpse","text":"Wrapper around table","code":""},{"path":"/reference/xglimpse.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Wrapper around table — xglimpse","text":"","code":"xglimpse(data, ...)"},{"path":"/reference/xglimpse.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Wrapper around table — xglimpse","text":"data dataframe ... columns cross-tabulate","code":""},{"path":"/reference/xglimpse.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Wrapper around table — xglimpse","text":"cross-tabulation","code":""}]
