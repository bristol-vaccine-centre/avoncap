<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="avoncap">
<title>Getting started • avoncap</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started">
<meta property="og:description" content="avoncap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">avoncap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/avoncap.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/longitudinal-pneumo.html">Pneumococcus longitudinal serotype data</a>
    <a class="dropdown-item" href="../articles/uad-data.html">Pneumococcus urinary antigen data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting started</h1>
            
      
      
      <div class="d-none name"><code>avoncap.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># library(avoncap)</span></span>
<span><span class="co"># devtools::load_all()</span></span></code></pre></div>
<div class="section level2">
<h2 id="input-data-location">Input data location<a class="anchor" aria-label="anchor" href="#input-data-location"></a>
</h2>
<ul>
<li>first level directories.</li>
<li>Filenames need some indication of database year (either as
20-21,21-22,… or as y1,y2,…)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The data input directory on my development machine:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"avoncap.input"</span> <span class="op">=</span> <span class="st">"~/Data/avoncap/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The directory structure:</span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/input.html">input</a></span><span class="op">(</span><span class="op">)</span>,glob<span class="op">=</span><span class="st">"*/cache/*"</span>,invert<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">/home/vp22681/Data/avoncap</span></span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">avoncap-export</span></span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-03-22</span></span></span>
<span><span class="co">#&gt; │   │   ├── central_y1.csv</span></span>
<span><span class="co">#&gt; │   │   └── central_y2.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-06-20</span></span></span>
<span><span class="co">#&gt; │   │   ├── central_y1.csv</span></span>
<span><span class="co">#&gt; │   │   └── central_y2.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-07-11</span></span></span>
<span><span class="co">#&gt; │   │   ├── central_y1.csv</span></span>
<span><span class="co">#&gt; │   │   └── central_y2.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-09-21</span></span></span>
<span><span class="co">#&gt; │   │   ├── central_y1.csv</span></span>
<span><span class="co">#&gt; │   │   └── central_y2.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-10-07</span></span></span>
<span><span class="co">#&gt; │   │   └── uad-controls.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-11-09</span></span></span>
<span><span class="co">#&gt; │   │   ├── central_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── central_y2.csv</span></span>
<span><span class="co">#&gt; │   │   └── uad-controls.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2023-03-02</span></span></span>
<span><span class="co">#&gt; │   │   ├── central_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── central_y2.csv</span></span>
<span><span class="co">#&gt; │   │   └── central_y3.csv</span></span>
<span><span class="co">#&gt; │   ├── 22-23 codebook NBT.pdf</span></span>
<span><span class="co">#&gt; │   ├── 22-23 codebook UHBW.pdf</span></span>
<span><span class="co">#&gt; │   ├── Avon CAP - LRTD Patients 21-22 _ REDCap codebook.pdf</span></span>
<span><span class="co">#&gt; │   ├── Avon CAP - LRTD central database 20-21 _ REDCap.pdf</span></span>
<span><span class="co">#&gt; │   ├── AvonCAP Pneumococcus Codebook.pdf</span></span>
<span><span class="co">#&gt; │   ├── AvonCAP field validity.xlsx</span></span>
<span><span class="co">#&gt; │   └── README.md</span></span>
<span><span class="co">#&gt; ├── avoncap.yaml</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">cache</span></span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">downloads</span></span></span>
<span><span class="co">#&gt; │   └── README.md</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">ethnicity</span></span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-07-12</span></span></span>
<span><span class="co">#&gt; │   │   ├── y1.csv</span></span>
<span><span class="co">#&gt; │   │   └── y2.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-10-27</span></span></span>
<span><span class="co">#&gt; │   │   ├── y1.csv</span></span>
<span><span class="co">#&gt; │   │   └── y2.csv</span></span>
<span><span class="co">#&gt; │   └── README.md</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">google-mobility</span></span></span>
<span><span class="co">#&gt; │   └── Global_Mobility_Report.csv</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">ltla-incidence</span></span></span>
<span><span class="co">#&gt; │   ├── ltla_2022-02-28.csv</span></span>
<span><span class="co">#&gt; │   └── ltla_2022-03-18.csv</span></span>
<span><span class="co">#&gt; ├── <span style="color: #BB0000; font-weight: bold;">maybe_some_useful_files_data.zip</span></span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">metadata</span></span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-10-24</span></span></span>
<span><span class="co">#&gt; │   │   ├── central_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── central_y2.csv</span></span>
<span><span class="co">#&gt; │   │   ├── central_y3.csv</span></span>
<span><span class="co">#&gt; │   │   └── uad-controls.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-11-29</span></span></span>
<span><span class="co">#&gt; │   │   └── pneumococcal.csv</span></span>
<span><span class="co">#&gt; │   └── README.md</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">metadata-review</span></span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-10-25</span></span></span>
<span><span class="co">#&gt; │   │   └── metadata-review.csv</span></span>
<span><span class="co">#&gt; │   ├── AvonCAP 21-22 markred.xlsx</span></span>
<span><span class="co">#&gt; │   └── AvonCAP data dictionary - fields.csv</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">nhs-extract</span></span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-07-11</span></span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y2.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_NBT_y1.csv</span></span>
<span><span class="co">#&gt; │   │   └── deltave_NBT_y2.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-09-20</span></span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y2.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y3.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_NBT_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_NBT_y2.csv</span></span>
<span><span class="co">#&gt; │   │   └── deltave_NBT_y3.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-11-16</span></span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y2.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y3.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_NBT_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_NBT_y2.csv</span></span>
<span><span class="co">#&gt; │   │   └── deltave_NBT_y3.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-11-29</span></span></span>
<span><span class="co">#&gt; │   │   └── pneumococcal.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-11-30</span></span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y2.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y3.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_NBT_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_NBT_y2.csv</span></span>
<span><span class="co">#&gt; │   │   └── deltave_NBT_y3.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-12-07</span></span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y2.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_BRI_y3.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_NBT_y1.csv</span></span>
<span><span class="co">#&gt; │   │   ├── deltave_NBT_y2.csv</span></span>
<span><span class="co">#&gt; │   │   └── deltave_NBT_y3.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2022-12-20</span></span></span>
<span><span class="co">#&gt; │   │   └── ipd_avoncap_linkage.csv</span></span>
<span><span class="co">#&gt; │   ├── <span style="color: #0000BB; font-weight: bold;">2023-02-07</span></span></span>
<span><span class="co">#&gt; │   │   └── pneumococcal.csv</span></span>
<span><span class="co">#&gt; │   ├── README.md</span></span>
<span><span class="co">#&gt; │   └── <span style="color: #0000BB; font-weight: bold;">old</span></span></span>
<span><span class="co">#&gt; │       ├── AdmissionDateByStudyNumber_2022-07-12.csv</span></span>
<span><span class="co">#&gt; │       └── DeltaVE_04042022.csv</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">spim-seroprevalence</span></span></span>
<span><span class="co">#&gt; │   └── week15_2022_seroprev_modellers.csv</span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">urine-antigens</span></span></span>
<span><span class="co">#&gt;     ├── <span style="color: #0000BB; font-weight: bold;">2022-09-15</span></span></span>
<span><span class="co">#&gt;     │   └── uad-cases.csv</span></span>
<span><span class="co">#&gt;     ├── B1851202_SAP V1.0-27Sep2021_Final.pdf</span></span>
<span><span class="co">#&gt;     ├── README.md</span></span>
<span><span class="co">#&gt;     └── Table Template Serotype Distribution Scientific Affairs Proposal_FINAL.docx</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the most recent files</span></span>
<span><span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/most_recent_files.html">most_recent_files</a></span><span class="op">(</span><span class="st">"ethnicity"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">#&gt;   filename directory path                date       hospital study_year filetype</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fs::path&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> y1       ethnicity …/2022-10-27/y1.csv 2022-10-27 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span> csv     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> y2       ethnicity …/2022-10-27/y2.csv 2022-10-27 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span> csv</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::load_all()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/load_data.html">load_data</a></span><span class="op">(</span><span class="st">"missing"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; No suitable files matching "missing", before date: 2023-03-28. Try one of: </span></span>
<span><span class="co">#&gt; as an input to 'type'</span></span>
<span><span class="co">#&gt; Error in avoncap::load_data("missing") : aborting.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-data-sources-and-recording-provenance">Load data sources and recording provenance<a class="anchor" aria-label="anchor" href="#load-data-sources-and-recording-provenance"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ethn</span> <span class="op">=</span> <span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/load_data.html">load_data</a></span><span class="op">(</span><span class="st">"ethnicity"</span><span class="op">)</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/data-969416e3870a1ceaa091ca0c1e17ce42-ff72608b64773903d114b82c59072820.rda</span></span>
<span><span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/most_recent_files.html">most_recent_files</a></span><span class="op">(</span><span class="st">"nhs-extract"</span>,<span class="st">"deltave"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   filename       directory   path        date       hospital study_year filetype</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fs::path&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> deltave_BRI_y1 nhs-extract …BRI_y1.csv 2022-12-07 BRI               1 csv     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> deltave_BRI_y2 nhs-extract …BRI_y2.csv 2022-12-07 BRI               2 csv     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> deltave_BRI_y3 nhs-extract …BRI_y3.csv 2022-12-07 BRI               3 csv     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> deltave_NBT_y1 nhs-extract …NBT_y1.csv 2022-12-07 NBT               1 csv     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> deltave_NBT_y2 nhs-extract …NBT_y2.csv 2022-12-07 NBT               2 csv     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> deltave_NBT_y3 nhs-extract …NBT_y3.csv 2022-12-07 NBT               3 csv</span></span>
<span><span class="va">rawData</span> <span class="op">=</span> <span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/load_data.html">load_data</a></span><span class="op">(</span><span class="st">"nhs-extract"</span>,<span class="st">"deltave"</span><span class="op">)</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/data-969416e3870a1ceaa091ca0c1e17ce42-2455e2e169f1b657eeece521d9a79582.rda</span></span>
<span><span class="co"># rawData = avoncap::load_data("nhs-extract","deltave",merge = FALSE)</span></span>
<span><span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/save_data_source_info.html">save_data_source_info</a></span><span class="op">(</span><span class="va">ethn</span>, <span class="va">rawData</span>, .file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"file-info"</span>,fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   path                                                                 md5      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> /home/vp22681/Data/avoncap/ethnicity/2022-10-27/y1.csv               c3ad7992…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> /home/vp22681/Data/avoncap/ethnicity/2022-10-27/y2.csv               ce23f5ae…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_BRI_y1.csv 66825a94…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_BRI_y2.csv cbd04cf3…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_BRI_y3.csv b2fd0723…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_NBT_y1.csv f61195e9…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_NBT_y2.csv be0456bb…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> /home/vp22681/Data/avoncap/nhs-extract/2022-12-07/deltave_NBT_y3.csv 49d5d4ed…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="normalising-data">Normalising data<a class="anchor" aria-label="anchor" href="#normalising-data"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::install_local(force=TRUE)</span></span>
<span><span class="va">normData</span> <span class="op">=</span> <span class="va">rawData</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/normalise_data.html">normalise_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Normalising data using: normalise.nhs_extract.deltave</span></span>
<span><span class="co">#&gt; Some columns expected in the mappings were not present: what_was_the_first_surveil</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-d67101ca02e4cd75528f3cf3f5934e6d.rda</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mapping-columns">Mapping columns<a class="anchor" aria-label="anchor" href="#mapping-columns"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Successfully mapped columns</span></span>
<span><span class="co"># attr(normData,"mapped")</span></span>
<span></span>
<span><span class="co"># Columns that are present in the normData but not mapped</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">normData</span>,<span class="st">"unmapped"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] ".spec_other_resp"    ".spec_other_cardiac" ".c19_compother"</span></span>
<span></span>
<span><span class="co"># Columns not present in the normData for which mapping rules were supplied</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">normData</span>,<span class="st">"missing"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "what_was_the_first_surveil"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="original-field-names-and-labels-">Original field names, and labels.<a class="anchor" aria-label="anchor" href="#original-field-names-and-labels-"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::load_all()</span></span>
<span></span>
<span><span class="co"># generate a set of readable label mappings from column to printable name for the whole normData set</span></span>
<span><span class="co"># overriding a particular label</span></span>
<span><span class="co"># readable_label_mapping(normData, demog.age="TEST")</span></span>
<span></span>
<span><span class="co"># Map a single column name as a string to a readable label</span></span>
<span><span class="fu"><a href="../reference/readable_label.html">readable_label</a></span><span class="op">(</span><span class="st">"comorbid.previous_MI"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Previous MI"</span></span>
<span></span>
<span><span class="co"># get mapping from original field names pre-normalisation to</span></span>
<span><span class="co"># post normalisation fields</span></span>
<span><span class="fu"><a href="../reference/original_field_names.html">original_field_names</a></span><span class="op">(</span><span class="va">normData</span><span class="op">)</span></span>
<span><span class="co">#&gt;                       consented                             ppc </span></span>
<span><span class="co">#&gt;               "admin.consented"            "admin.pp_consented" </span></span>
<span><span class="co">#&gt;                      withdrawal                   record_number </span></span>
<span><span class="co">#&gt;              "admin.withdrawal"           "admin.record_number" </span></span>
<span><span class="co">#&gt;                 ac_study_number                      nhs_number </span></span>
<span><span class="co">#&gt; "admin.consented_record_number"      "admin.patient_identifier" </span></span>
<span><span class="co">#&gt;                       duplicate                 enrollment_date </span></span>
<span><span class="co">#&gt;               "admin.duplicate"         "admin.enrollment_date" </span></span>
<span><span class="co">#&gt;                      study_year                            file </span></span>
<span><span class="co">#&gt;              "admin.study_year"               "admin.data_file" </span></span>
<span><span class="co">#&gt;                     week_number                     c19_variant </span></span>
<span><span class="co">#&gt;             "admin.week_number"               "genomic.variant" </span></span>
<span><span class="co">#&gt;                        hospital </span></span>
<span><span class="co">#&gt;                "admin.hospital"</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># unname(readable_label_mapping(normData))</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="augmenting-the-ve-extract-data">Augmenting the VE extract data<a class="anchor" aria-label="anchor" href="#augmenting-the-ve-extract-data"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::load_all()</span></span>
<span><span class="va">augData</span> <span class="op">=</span> <span class="va">normData</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/augment_data.html">augment_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Augmenting data using: augment.nhs_extract.deltave</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-b0be4b6b924799b0643f6ccebe7bfe19.rda</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="loading-and-normalising-the-central-database">loading and normalising the central database<a class="anchor" aria-label="anchor" href="#loading-and-normalising-the-central-database"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rawData2</span> <span class="op">=</span> <span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/load_data.html">load_data</a></span><span class="op">(</span><span class="st">"avoncap-export"</span>,<span class="st">"central"</span>, merge<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/data-969416e3870a1ceaa091ca0c1e17ce42-992b0616f696b5e874a446c6e2dc6e5b.rda</span></span>
<span><span class="co"># without merge: currently: INCONSISTENT COLUMN(S) IN FILES: sars_cov2_antigen</span></span>
<span><span class="co"># due to the fact it is mostly a numeric but some values "&gt;250"</span></span>
<span></span>
<span><span class="co"># devtools::load_all()</span></span>
<span><span class="va">normData2</span> <span class="op">=</span> <span class="va">rawData2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/normalise_data.html">normalise_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Normalising data using: normalise.avoncap_export.central</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/data-969416e3870a1ceaa091ca0c1e17ce42-ff72608b64773903d114b82c59072820.rda</span></span>
<span><span class="co">#&gt; Admission date is derived from study week and hence approximate.</span></span>
<span><span class="co">#&gt; Some columns expected in the mappings were not present: nhs_number, covidvax_date, covidvax_dose_2, covidvax_dose_3, covidvax_dose_4, covidvax_dose_5, covidvax_dose_6, flu_date, ppv23_date, previousinfection_date</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-8235b1ebaa9d52b2c05047c0edc09571.rda</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normMicro</span> <span class="op">=</span> <span class="va">rawData2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/normalise_data.html">normalise_data</a></span><span class="op">(</span>instrument <span class="op">=</span> <span class="st">"micro"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Normalising data using: normalise.avoncap_export.central.micro</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/norm-bac5833d60cfe1af3d53143364ade99c-0754bc13643cf7c16405ee29679c8d4c.rda</span></span>
<span></span>
<span><span class="va">normMicro</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">micro.test_performed</span><span class="op">==</span><span class="st">"yes"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="va">micro.pathogen</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">unnest</span><span class="op">(</span><span class="va">micro.pathogen</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">pathogen</span>,<span class="va">detected</span>,  useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                   detected</span></span>
<span><span class="co">#&gt; pathogen                              no   yes  &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   Aspergillus                      20773    17     0</span></span>
<span><span class="co">#&gt;   Streptococcus Agalactiae         20780    10     0</span></span>
<span><span class="co">#&gt;   Candida                          20261   529     0</span></span>
<span><span class="co">#&gt;   Achromobacter Xylosoxidans       20779    11     0</span></span>
<span><span class="co">#&gt;   Bacteroides                      20787     3     0</span></span>
<span><span class="co">#&gt;   Bacteroides fragilis             20784     6     0</span></span>
<span><span class="co">#&gt;   Bacteroides ovatus               20790     0     0</span></span>
<span><span class="co">#&gt;   Bacteroides uniformis            20790     0     0</span></span>
<span><span class="co">#&gt;   Burholderia cepacia              20787     3     0</span></span>
<span><span class="co">#&gt;   Citrobacter freundii complex     20767    23     0</span></span>
<span><span class="co">#&gt;   Citrobacter koseri               20756    34     0</span></span>
<span><span class="co">#&gt;   Clostridium perfringens          20782     8     0</span></span>
<span><span class="co">#&gt;   Eggerthella lenta                20790     0     0</span></span>
<span><span class="co">#&gt;   Enterobacter aerogenes           20785     5     0</span></span>
<span><span class="co">#&gt;   Enterobacter cloacae             20698    92     0</span></span>
<span><span class="co">#&gt;   Enterococcus faecalis            20735    55     0</span></span>
<span><span class="co">#&gt;   Enterococcus faecium             20762    28     0</span></span>
<span><span class="co">#&gt;   Escherichia coli                 20407   383     0</span></span>
<span><span class="co">#&gt;   Haemophilus influenzae           20599   191     0</span></span>
<span><span class="co">#&gt;   Haemophilus parainfluenzae       20788     2     0</span></span>
<span><span class="co">#&gt;   Klebsiella oxytoca               20735    55     0</span></span>
<span><span class="co">#&gt;   Klebsiella pneumoniae            20644   146     0</span></span>
<span><span class="co">#&gt;   Morganella morganii              20785     5     0</span></span>
<span><span class="co">#&gt;   Peptostreptococcus anaerobius    20790     0     0</span></span>
<span><span class="co">#&gt;   Proteus mirabilis                20744    46     0</span></span>
<span><span class="co">#&gt;   Pseudomonas aeruginosa           20481   309     0</span></span>
<span><span class="co">#&gt;   Serratia marcescens              20753    37     0</span></span>
<span><span class="co">#&gt;   Staphylcoccus aureus             20476   314     0</span></span>
<span><span class="co">#&gt;   Streptococcus anginosus          20784     6     0</span></span>
<span><span class="co">#&gt;   Streptococcus pneumoniae         20694    96     0</span></span>
<span><span class="co">#&gt;   Streptococcus salivarius group   20785     5     0</span></span>
<span><span class="co">#&gt;   Stenotrophomonas maltophilia     20744    46     0</span></span>
<span><span class="co">#&gt;   Acinetobacter                    20776    14     0</span></span>
<span><span class="co">#&gt;   Aspergillus niger                20790     0     0</span></span>
<span><span class="co">#&gt;   Bacillus                         20784     6     0</span></span>
<span><span class="co">#&gt;   Candida albicans                 20765    25     0</span></span>
<span><span class="co">#&gt;   Candida glabrata                 20784     6     0</span></span>
<span><span class="co">#&gt;   Candida tropicalis               20787     3     0</span></span>
<span><span class="co">#&gt;   Coagulase negative staphylcoccus 20781     9     0</span></span>
<span><span class="co">#&gt;   Corynebacterium                  20771    19     0</span></span>
<span><span class="co">#&gt;   Enterococcus                     20785     5     0</span></span>
<span><span class="co">#&gt;   Gram positive coccus             20787     3     0</span></span>
<span><span class="co">#&gt;   Klebsiella                       20769    21     0</span></span>
<span><span class="co">#&gt;   Legionella pneumoniae            20788     2     0</span></span>
<span><span class="co">#&gt;   MRSA                             20784     6     0</span></span>
<span><span class="co">#&gt;   MSSA                             20789     1     0</span></span>
<span><span class="co">#&gt;   Moraxella catarrhalis            20747    43     0</span></span>
<span><span class="co">#&gt;   Mycobacterium tuberculosis       20785     5     0</span></span>
<span><span class="co">#&gt;   Pneumocytis jirovecii            20788     2     0</span></span>
<span><span class="co">#&gt;   Pseudomonas                      20729    61     0</span></span>
<span><span class="co">#&gt;   Pseudomonas fluorescens          20789     1     0</span></span>
<span><span class="co">#&gt;   Staphylcoccus                    20771    19     0</span></span>
<span><span class="co">#&gt;   Staphylococcus capitis           20752    38     0</span></span>
<span><span class="co">#&gt;   Staphylococcus epidermidis       20566   224     0</span></span>
<span><span class="co">#&gt;   Staphylococcus hominis           20661   129     0</span></span>
<span><span class="co">#&gt;   Streptococcus                    20771    19     0</span></span>
<span><span class="co">#&gt;   Streptococcus beta-hemolytic     20736    54     0</span></span>
<span><span class="co">#&gt;   Streptococcus pyogenes           20782     8     0</span></span>
<span><span class="co">#&gt;   Streptococcus viridans           20790     0     0</span></span>
<span><span class="co">#&gt;   Yeast                            20758    32     0</span></span>
<span><span class="co">#&gt;   Other                            20315   475     0</span></span>
<span><span class="co">#&gt;   &lt;NA&gt;                                 0     0     0</span></span>
<span><span class="va">normMicro</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">micro.test_performed</span><span class="op">==</span><span class="st">"yes"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="va">micro.test_type</span>, <span class="va">micro.pathogen</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">unnest</span><span class="op">(</span><span class="va">micro.pathogen</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">detected</span><span class="op">==</span><span class="st">"yes"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">group_by</span><span class="op">(</span><span class="va">pathogen</span>, <span class="va">micro.test_type</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 186 × 3</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   pathogen, micro.test_type [186]</span></span></span>
<span><span class="co">#&gt;    pathogen                   micro.test_type      n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Candida                    Sputum             318</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Escherichia coli           Blood culture      271</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Other                      Blood culture      252</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Staphylococcus epidermidis Blood culture      215</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Pseudomonas aeruginosa     Sputum             186</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Other                      Sputum             143</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Staphylcoccus aureus       Blood culture      139</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Haemophilus influenzae     Sputum             138</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Staphylococcus hominis     Blood culture      128</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Candida                    Respiratory swab   121</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 176 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normVirol</span> <span class="op">=</span> <span class="va">rawData2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/normalise_data.html">normalise_data</a></span><span class="op">(</span>instrument <span class="op">=</span> <span class="st">"virol"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Normalising data using: normalise.avoncap_export.central.virol</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/norm-cfb2b3e08feee844479143a926465613-0754bc13643cf7c16405ee29679c8d4c.rda</span></span>
<span></span>
<span><span class="va">normVirol</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">virol.test_performed</span><span class="op">==</span><span class="st">"yes"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="va">virol.pathogen</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">unnest</span><span class="op">(</span><span class="va">virol.pathogen</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">pathogen</span>,<span class="va">detected</span>,  useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                          detected</span></span>
<span><span class="co">#&gt; pathogen                                     no   yes  &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   Influenza A                             55254   151     0</span></span>
<span><span class="co">#&gt;   Influenza B                             55404     1     0</span></span>
<span><span class="co">#&gt;   RSV                                     55350    55     0</span></span>
<span><span class="co">#&gt;   Adenovirus                              55397     8     0</span></span>
<span><span class="co">#&gt;   Human Metapneumovirus                   55353    52     0</span></span>
<span><span class="co">#&gt;   Human Rhinovirus/Enterovirus            55261   144     0</span></span>
<span><span class="co">#&gt;   Parainfluenza Type 1                    55402     3     0</span></span>
<span><span class="co">#&gt;   Parainfluenza Type 2                    55399     6     0</span></span>
<span><span class="co">#&gt;   Parainfluenza Type 3                    55371    34     0</span></span>
<span><span class="co">#&gt;   Parainfluenza Type 4                    55399     6     0</span></span>
<span><span class="co">#&gt;   Covid-19                                43385 12020     0</span></span>
<span><span class="co">#&gt;   Other                                   55391    14     0</span></span>
<span><span class="co">#&gt;   Coronavirus 229E                        55404     1     0</span></span>
<span><span class="co">#&gt;   Coronavirus HKU1                        55404     1     0</span></span>
<span><span class="co">#&gt;   Coronavirus NL63                        55405     0     0</span></span>
<span><span class="co">#&gt;   Coronavirus OC43                        55405     0     0</span></span>
<span><span class="co">#&gt;   Middle East Respiratory Syndrome (MERS) 55405     0     0</span></span>
<span><span class="co">#&gt;   Bordetella parapertussis (IS1001)       55403     2     0</span></span>
<span><span class="co">#&gt;   Bordetella pertussis (ptxP)             55405     0     0</span></span>
<span><span class="co">#&gt;   Chlamydia pneumoniae                    55403     2     0</span></span>
<span><span class="co">#&gt;   Mycoplasma pneumoniae                   55405     0     0</span></span>
<span><span class="co">#&gt;   &lt;NA&gt;                                        0     0     0</span></span>
<span><span class="va">normVirol</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">virol.test_performed</span><span class="op">==</span><span class="st">"yes"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="va">virol.test_type</span>, <span class="va">virol.pathogen</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">unnest</span><span class="op">(</span><span class="va">virol.pathogen</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">detected</span><span class="op">==</span><span class="st">"yes"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># with(table(pathogen, virol.test_type,  useNA = "always")) %&gt;% </span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">pathogen</span>, <span class="va">virol.test_type</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 38 × 3</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   pathogen, virol.test_type [38]</span></span></span>
<span><span class="co">#&gt;    pathogen                     virol.test_type               n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Covid-19                     PCR - COVID only           <span style="text-decoration: underline;">8</span>485</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Covid-19                     POCT Test (Abbott)         <span style="text-decoration: underline;">2</span>839</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Covid-19                     Lateral Flow - COVID only   516</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Covid-19                     Viral Culture               118</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Influenza A                  Lateral Flow - COVID only   111</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Human Rhinovirus/Enterovirus PCR - Respiratory panel     108</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Covid-19                     PCR - Respiratory panel      60</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Influenza A                  PCR - Respiratory panel      37</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Human Metapneumovirus        PCR - Respiratory panel      34</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> RSV                          Lateral Flow - COVID only    30</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 28 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normRadio</span> <span class="op">=</span> <span class="va">rawData2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/normalise_data.html">normalise_data</a></span><span class="op">(</span>instrument <span class="op">=</span> <span class="st">"radio"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Normalising data using: normalise.avoncap_export.central.radio</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/norm-54ff4a71f9ddec1dbf62dbffb5e8513b-0754bc13643cf7c16405ee29679c8d4c.rda</span></span>
<span></span>
<span><span class="co"># old format tmp3  %&gt;% filter(radio.test_performed=="yes") %&gt;% with(table(radio.test_type, radio.lung_malignancy))</span></span>
<span><span class="va">normRadio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">radio.test_performed</span><span class="op">==</span><span class="st">"yes"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="va">radio.alrtd_finding</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">unnest</span><span class="op">(</span><span class="va">radio.alrtd_finding</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">finding</span>,<span class="va">present</span>,  useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                   present</span></span>
<span><span class="co">#&gt; finding                               no   yes  &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   Normal                           24871 17933     4</span></span>
<span><span class="co">#&gt;   Consistent with pneumonia        29455 13349     4</span></span>
<span><span class="co">#&gt;   Consistent with heart failure    39040  3764     4</span></span>
<span><span class="co">#&gt;   Consistent with pleural effusion 34631  8173     4</span></span>
<span><span class="co">#&gt;   Consistent with COVID-19         36778  6026     4</span></span>
<span><span class="co">#&gt;   Other abnormal finding           39828  2976     4</span></span>
<span><span class="co">#&gt;   &lt;NA&gt;                                 0     0     0</span></span>
<span><span class="va">normRadio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">radio.test_performed</span><span class="op">==</span><span class="st">"yes"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="va">radio.test_type</span>, <span class="va">radio.non_alrtd_finding</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">unnest</span><span class="op">(</span><span class="va">radio.non_alrtd_finding</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">present</span><span class="op">==</span><span class="st">"yes"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">finding</span>, <span class="va">radio.test_type</span>,  useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                        radio.test_type</span></span>
<span><span class="co">#&gt; finding                                 CXR CT scan (CT thorax, CTPA, HRCT)</span></span>
<span><span class="co">#&gt;   Pulmonary embolus                     146                             648</span></span>
<span><span class="co">#&gt;   Pneumothorax and/or pneumomediastinum 804                             149</span></span>
<span><span class="co">#&gt;   Cavity including abscesses             27                              23</span></span>
<span><span class="co">#&gt;   Aspergillioma                           1                               1</span></span>
<span><span class="co">#&gt;   Lung malignancy                       314                             272</span></span>
<span><span class="co">#&gt;   Lung nodules                          276                             337</span></span>
<span><span class="co">#&gt;   Tuberculosis (old or new)               8                               1</span></span>
<span><span class="co">#&gt;   Empyema                               108                              93</span></span>
<span><span class="co">#&gt;   &lt;NA&gt;                                    0                               0</span></span>
<span><span class="co">#&gt;                                        radio.test_type</span></span>
<span><span class="co">#&gt; finding                                 US thorax MRI Other &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   Pulmonary embolus                             3   0    13    1</span></span>
<span><span class="co">#&gt;   Pneumothorax and/or pneumomediastinum         2   0     0    0</span></span>
<span><span class="co">#&gt;   Cavity including abscesses                    3   0     0    0</span></span>
<span><span class="co">#&gt;   Aspergillioma                                 0   0     0    0</span></span>
<span><span class="co">#&gt;   Lung malignancy                               0   0     2    0</span></span>
<span><span class="co">#&gt;   Lung nodules                                  2   0     1    0</span></span>
<span><span class="co">#&gt;   Tuberculosis (old or new)                     0   0     0    0</span></span>
<span><span class="co">#&gt;   Empyema                                       2   0     3    0</span></span>
<span><span class="co">#&gt;   &lt;NA&gt;                                          0   0     0    0</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normHaem</span> <span class="op">=</span> <span class="va">rawData2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/normalise_data.html">normalise_data</a></span><span class="op">(</span>instrument <span class="op">=</span> <span class="st">"haem"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Normalising data using: normalise.avoncap_export.central.haem</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/norm-0ef4812a2d1bc751062531c384a2b89e-9cb57dcd94c534f5744f4226eaeae412.rda</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="va">normHaem</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                                                </span></span>
<span><span class="co">#&gt;         admin.consented       Not approached  :13749   Yes             :10702  </span></span>
<span><span class="co">#&gt;        admin.pp_consented     Not approached  :23465   Yes             :  986  </span></span>
<span><span class="co">#&gt; admin.withdrawal              no  :13351               yes :    0              </span></span>
<span><span class="co">#&gt; admin.record_number           Length:24457             Class :character        </span></span>
<span><span class="co">#&gt; admin.consented_record_number Length:24457             Class :character        </span></span>
<span><span class="co">#&gt; haem.blood_gas_ph             Min.   :   4.60          1st Qu.:   7.36         </span></span>
<span><span class="co">#&gt;  haem.glucose                 Min.   :   0.20          1st Qu.:   5.70         </span></span>
<span><span class="co">#&gt;  haem.albumin                 Min.   :  10.00          1st Qu.:  29.00         </span></span>
<span><span class="co">#&gt; haem.white_cell_count         Min.   :  0.11           1st Qu.:  7.00          </span></span>
<span><span class="co">#&gt; haem.haemoglobin              Min.   : 30.0            1st Qu.:116.0           </span></span>
<span><span class="co">#&gt; haem.haemotocrit              Min.   :0.1000           1st Qu.:0.3570          </span></span>
<span><span class="co">#&gt; haem.neutrophils              Min.   :  0.010          1st Qu.:  4.850         </span></span>
<span><span class="co">#&gt; haem.lymphocytes              Min.   :  0.020          1st Qu.:  0.740         </span></span>
<span><span class="co">#&gt;    haem.crp                   Min.   :  0.39           1st Qu.:  9.00          </span></span>
<span><span class="co">#&gt;  haem.sodium                  Min.   :102.0            1st Qu.:134.0           </span></span>
<span><span class="co">#&gt;   haem.urea                   Min.   :  0.500          1st Qu.:  4.400         </span></span>
<span><span class="co">#&gt;   haem.egfr                   Min.   : 2.00            1st Qu.:52.00           </span></span>
<span><span class="co">#&gt; haem.ferritin                 Min.   :    4.00         1st Qu.:   94.55        </span></span>
<span><span class="co">#&gt;  haem.pro_bnp                 Min.   :    0.0          1st Qu.:  440.8         </span></span>
<span><span class="co">#&gt;  haem.d_dimer                 Min.   :    0.00         1st Qu.:    0.58        </span></span>
<span><span class="co">#&gt; haem.blood_group              Unknown:14232            O+     : 3807           </span></span>
<span><span class="co">#&gt;  key.admit                    Length:24457             Class :character        </span></span>
<span><span class="co">#&gt; key.consent                   Length:24457             Class :character        </span></span>
<span><span class="co">#&gt; admin.consent_withheld        no :24457                yes:    0               </span></span>
<span><span class="co">#&gt;                                                                                </span></span>
<span><span class="co">#&gt;         admin.consented       Declined consent:    0   NA's            :    6  </span></span>
<span><span class="co">#&gt;        admin.pp_consented     Declined consent:    0   NA's            :    6  </span></span>
<span><span class="co">#&gt; admin.withdrawal              NA's:11106                                       </span></span>
<span><span class="co">#&gt; admin.record_number           Mode  :character                                 </span></span>
<span><span class="co">#&gt; admin.consented_record_number Mode  :character                                 </span></span>
<span><span class="co">#&gt; haem.blood_gas_ph             Median :   7.40          Mean   :  12.81         </span></span>
<span><span class="co">#&gt;  haem.glucose                 Median :   6.70          Mean   :  12.39         </span></span>
<span><span class="co">#&gt;  haem.albumin                 Median :  33.00          Mean   :  32.98         </span></span>
<span><span class="co">#&gt; haem.white_cell_count         Median :  9.49           Mean   : 10.87          </span></span>
<span><span class="co">#&gt; haem.haemoglobin              Median :131.0            Mean   :129.2           </span></span>
<span><span class="co">#&gt; haem.haemotocrit              Median :0.3990           Mean   :0.3951          </span></span>
<span><span class="co">#&gt; haem.neutrophils              Median :  7.080          Mean   :  8.362         </span></span>
<span><span class="co">#&gt; haem.lymphocytes              Median :  1.140          Mean   :  1.508         </span></span>
<span><span class="co">#&gt;    haem.crp                   Median : 33.00           Mean   : 66.63          </span></span>
<span><span class="co">#&gt;  haem.sodium                  Median :137.0            Mean   :136.9           </span></span>
<span><span class="co">#&gt;   haem.urea                   Median :  6.200          Mean   :  7.959         </span></span>
<span><span class="co">#&gt;   haem.egfr                   Median :77.00            Mean   :68.53           </span></span>
<span><span class="co">#&gt; haem.ferritin                 Median :  290.40         Mean   : 1528.77        </span></span>
<span><span class="co">#&gt;  haem.pro_bnp                 Median : 1944.5          Mean   : 5043.4         </span></span>
<span><span class="co">#&gt;  haem.d_dimer                 Median :    1.70         Mean   : 1033.45        </span></span>
<span><span class="co">#&gt; haem.blood_group              A+     : 3621            B+     :  820           </span></span>
<span><span class="co">#&gt;  key.admit                    Mode  :character                                 </span></span>
<span><span class="co">#&gt; key.consent                   Mode  :character                                 </span></span>
<span><span class="co">#&gt; admin.consent_withheld                                                         </span></span>
<span><span class="co">#&gt;                                                                    </span></span>
<span><span class="co">#&gt;         admin.consented                                            </span></span>
<span><span class="co">#&gt;        admin.pp_consented                                          </span></span>
<span><span class="co">#&gt; admin.withdrawal                                                   </span></span>
<span><span class="co">#&gt; admin.record_number                                                </span></span>
<span><span class="co">#&gt; admin.consented_record_number                                      </span></span>
<span><span class="co">#&gt; haem.blood_gas_ph             3rd Qu.:   7.43    Max.   :9999.00   </span></span>
<span><span class="co">#&gt;  haem.glucose                 3rd Qu.:   8.40    Max.   :9999.00   </span></span>
<span><span class="co">#&gt;  haem.albumin                 3rd Qu.:  36.00    Max.   :9999.00   </span></span>
<span><span class="co">#&gt; haem.white_cell_count         3rd Qu.: 13.04     Max.   :394.99    </span></span>
<span><span class="co">#&gt; haem.haemoglobin              3rd Qu.:144.0      Max.   :246.0     </span></span>
<span><span class="co">#&gt; haem.haemotocrit              3rd Qu.:0.4360     Max.   :0.7120    </span></span>
<span><span class="co">#&gt; haem.neutrophils              3rd Qu.: 10.440    Max.   :122.750   </span></span>
<span><span class="co">#&gt; haem.lymphocytes              3rd Qu.:  1.710    Max.   :500.000   </span></span>
<span><span class="co">#&gt;    haem.crp                   3rd Qu.: 93.00     Max.   :873.00    </span></span>
<span><span class="co">#&gt;  haem.sodium                  3rd Qu.:140.0      Max.   :180.0     </span></span>
<span><span class="co">#&gt;   haem.urea                   3rd Qu.:  9.300    Max.   :606.000   </span></span>
<span><span class="co">#&gt;   haem.egfr                   3rd Qu.:90.00      Max.   :90.00     </span></span>
<span><span class="co">#&gt; haem.ferritin                 3rd Qu.: 1003.50   Max.   :76878.00  </span></span>
<span><span class="co">#&gt;  haem.pro_bnp                 3rd Qu.: 6242.0    Max.   :58184.0   </span></span>
<span><span class="co">#&gt;  haem.d_dimer                 3rd Qu.:  552.00   Max.   :80000.00  </span></span>
<span><span class="co">#&gt; haem.blood_group              A-     :  732      (Other): 1240     </span></span>
<span><span class="co">#&gt;  key.admit                                                         </span></span>
<span><span class="co">#&gt; key.consent                                                        </span></span>
<span><span class="co">#&gt; admin.consent_withheld                                             </span></span>
<span><span class="co">#&gt;                                              </span></span>
<span><span class="co">#&gt;         admin.consented                      </span></span>
<span><span class="co">#&gt;        admin.pp_consented                    </span></span>
<span><span class="co">#&gt; admin.withdrawal                             </span></span>
<span><span class="co">#&gt; admin.record_number                          </span></span>
<span><span class="co">#&gt; admin.consented_record_number                </span></span>
<span><span class="co">#&gt; haem.blood_gas_ph             NA's   :6014   </span></span>
<span><span class="co">#&gt;  haem.glucose                 NA's   :3956   </span></span>
<span><span class="co">#&gt;  haem.albumin                 NA's   :822    </span></span>
<span><span class="co">#&gt; haem.white_cell_count         NA's   :246    </span></span>
<span><span class="co">#&gt; haem.haemoglobin              NA's   :245    </span></span>
<span><span class="co">#&gt; haem.haemotocrit              NA's   :249    </span></span>
<span><span class="co">#&gt; haem.neutrophils              NA's   :246    </span></span>
<span><span class="co">#&gt; haem.lymphocytes              NA's   :246    </span></span>
<span><span class="co">#&gt;    haem.crp                   NA's   :552    </span></span>
<span><span class="co">#&gt;  haem.sodium                  NA's   :266    </span></span>
<span><span class="co">#&gt;   haem.urea                   NA's   :321    </span></span>
<span><span class="co">#&gt;   haem.egfr                   NA's   :290    </span></span>
<span><span class="co">#&gt; haem.ferritin                 NA's   :23094  </span></span>
<span><span class="co">#&gt;  haem.pro_bnp                 NA's   :20085  </span></span>
<span><span class="co">#&gt;  haem.d_dimer                 NA's   :21026  </span></span>
<span><span class="co">#&gt; haem.blood_group              NA's   :    5  </span></span>
<span><span class="co">#&gt;  key.admit                                   </span></span>
<span><span class="co">#&gt; key.consent                                  </span></span>
<span><span class="co">#&gt; admin.consent_withheld</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="augmenting-the-central-database">Augmenting the central database<a class="anchor" aria-label="anchor" href="#augmenting-the-central-database"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::load_all()</span></span>
<span><span class="va">augData2</span> <span class="op">=</span> <span class="va">normData2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">avoncap</span><span class="fu">::</span><span class="fu"><a href="../reference/augment_data.html">augment_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Augmenting data using: augment.avoncap_export.central</span></span>
<span><span class="co">#&gt; using cached item: ~/.cache/avoncap/augment-c0a6188e8e5ceeed5c7f302b593a85fd-b0c47226602a5f65b0afaeede5ffcc37.rda</span></span>
<span></span>
<span><span class="va">augData2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/xglimpse.html">xglimpse</a></span><span class="op">(</span><span class="va">admission.category</span>,  <span class="va">admission.presentation_3_class</span><span class="op">)</span></span>
<span><span class="co">#&gt;                               admission.category</span></span>
<span><span class="co">#&gt; admission.presentation_3_class Confirmed SARS-CoV-2 No evidence SARS-CoV-2</span></span>
<span><span class="co">#&gt;               Pneumonia                        4601                   7171</span></span>
<span><span class="co">#&gt;               NP-LRTI                          3480                   5011</span></span>
<span><span class="co">#&gt;               No evidence LRTI                   54                      0</span></span>
<span><span class="co">#&gt;               &lt;NA&gt;                                0                      0</span></span>
<span><span class="co">#&gt;                               admission.category</span></span>
<span><span class="co">#&gt; admission.presentation_3_class Non-infective &lt;NA&gt;</span></span>
<span><span class="co">#&gt;               Pneumonia                    0    0</span></span>
<span><span class="co">#&gt;               NP-LRTI                      0    0</span></span>
<span><span class="co">#&gt;               No evidence LRTI          4140    0</span></span>
<span><span class="co">#&gt;               &lt;NA&gt;                         0  804</span></span>
<span><span class="va">augData2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/xglimpse.html">xglimpse</a></span><span class="op">(</span><span class="va">admission.covid_pcr_result</span>,  <span class="va">admission.presentation_3_class</span><span class="op">)</span></span>
<span><span class="co">#&gt;                               admission.covid_pcr_result</span></span>
<span><span class="co">#&gt; admission.presentation_3_class SARS-CoV-2 PCR negative SARS-CoV-2 PCR positive</span></span>
<span><span class="co">#&gt;               Pneumonia                           6803                    4554</span></span>
<span><span class="co">#&gt;               NP-LRTI                             4596                    3426</span></span>
<span><span class="co">#&gt;               No evidence LRTI                    3663                      39</span></span>
<span><span class="co">#&gt;               &lt;NA&gt;                                   0                       0</span></span>
<span><span class="co">#&gt;                               admission.covid_pcr_result</span></span>
<span><span class="co">#&gt; admission.presentation_3_class &lt;NA&gt;</span></span>
<span><span class="co">#&gt;               Pneumonia         415</span></span>
<span><span class="co">#&gt;               NP-LRTI           469</span></span>
<span><span class="co">#&gt;               No evidence LRTI  492</span></span>
<span><span class="co">#&gt;               &lt;NA&gt;              804</span></span>
<span><span class="va">augData2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/xglimpse.html">xglimpse</a></span><span class="op">(</span><span class="va">admission.infective_cause</span>,  <span class="va">admission.presentation_3_class</span><span class="op">)</span></span>
<span><span class="co">#&gt;                               admission.infective_cause</span></span>
<span><span class="co">#&gt; admission.presentation_3_class Non-infective Infective  &lt;NA&gt;</span></span>
<span><span class="co">#&gt;               Pneumonia                    0     11772     0</span></span>
<span><span class="co">#&gt;               NP-LRTI                      0      8491     0</span></span>
<span><span class="co">#&gt;               No evidence LRTI          4140        54     0</span></span>
<span><span class="co">#&gt;               &lt;NA&gt;                         0         0   804</span></span>
<span><span class="va">augData2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/xglimpse.html">xglimpse</a></span><span class="op">(</span><span class="va">admission.infective_cause</span>,  <span class="va">admission.is_covid</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         admission.infective_cause</span></span>
<span><span class="co">#&gt; admission.is_covid       Non-infective Infective  &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   Confirmed SARS-CoV-2               0      8135     0</span></span>
<span><span class="co">#&gt;   No evidence SARS-CoV-2          4140     12182     0</span></span>
<span><span class="co">#&gt;   &lt;NA&gt;                               0         0   804</span></span>
<span></span>
<span><span class="va">augData2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/xglimpse.html">xglimpse</a></span><span class="op">(</span><span class="va">admin.consent_withheld</span>, <span class="va">admission.presentation_3_class</span><span class="op">)</span></span>
<span><span class="co">#&gt;                               admin.consent_withheld</span></span>
<span><span class="co">#&gt; admission.presentation_3_class    no   yes</span></span>
<span><span class="co">#&gt;               Pneumonia        11772     0</span></span>
<span><span class="co">#&gt;               NP-LRTI           8491     0</span></span>
<span><span class="co">#&gt;               No evidence LRTI  4194     0</span></span>
<span><span class="co">#&gt;               &lt;NA&gt;                 0   804</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rob Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
